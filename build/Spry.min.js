/*! spry 2013-05-19 */
function xpathLog(){}function xsltLog(){}function xsltLogXml(){}function assert(t){if(!t)throw"Assertion failed"}function stringSplit(t,e){var r=t.indexOf(e);if(-1==r)return[t];var a=[];for(a.push(t.substr(0,r));-1!=r;){var n=t.indexOf(e,r+1);-1!=n?a.push(t.substr(r+1,n-r-1)):a.push(t.substr(r+1)),r=n}return a}function mapExec(t,e){for(var r=0;t.length>r;++r)e.call(this,t[r],r)}function mapExpr(t,e){for(var r=[],a=0;t.length>a;++a)r.push(e(t[a]));return r}function reverseInplace(t){for(var e=0;t.length/2>e;++e){var r=t[e],a=t.length-e-1;t[e]=t[a],t[a]=r}}function removeFromArray(t,e,r){for(var a=0,n=0;t.length>n;++n)(t[n]===e||r&&t[n]==e)&&(t.splice(n--,1),a++);return a}function copyArray(t,e){for(var r=0;e.length>r;++r)t.push(e[r])}function xmlValue(t){if(!t)return"";var e="";if(t.nodeType==DOM_TEXT_NODE||t.nodeType==DOM_CDATA_SECTION_NODE||t.nodeType==DOM_ATTRIBUTE_NODE)e+=t.nodeValue;else if(t.nodeType==DOM_ELEMENT_NODE||t.nodeType==DOM_DOCUMENT_NODE||t.nodeType==DOM_DOCUMENT_FRAGMENT_NODE)for(var r=0;t.childNodes.length>r;++r)e+=arguments.callee(t.childNodes[r]);return e}function xpathParse(t){xpathLog("parse "+t),xpathParseInit();var e=xpathCacheLookup(t);if(e)return xpathLog(" ... cached"),e;if(t.match(/^(\$|@)?\w+$/i)){var r=makeSimpleExpr(t);return xpathParseCache[t]=r,xpathLog(" ... simple"),r}if(t.match(/^\w+(\/\w+)*$/i)){var r=makeSimpleExpr2(t);return xpathParseCache[t]=r,xpathLog(" ... simple 2"),r}for(var a=t,n=[],i=null,s=null,o=!1,p=0,l=0,u=0;!o;){p++,t=t.replace(/^\s*/,""),s=i,i=null;for(var h=null,c="",f=0;xpathTokenRules.length>f;++f){var d=xpathTokenRules[f].re.exec(t);if(l++,d&&d.length>0&&d[0].length>c.length){h=xpathTokenRules[f],c=d[0];break}}for(!h||h!=TOK_DIV&&h!=TOK_MOD&&h!=TOK_AND&&h!=TOK_OR||s&&s.tag!=TOK_AT&&s.tag!=TOK_DSLASH&&s.tag!=TOK_SLASH&&s.tag!=TOK_AXIS&&s.tag!=TOK_DOLLAR||(h=TOK_QNAME),h?(t=t.substr(c.length),xpathLog("token: "+c+" -- "+h.label),i={tag:h,match:c,prec:h.prec?h.prec:0,expr:makeTokenExpr(c)}):(xpathLog("DONE"),o=!0);xpathReduce(n,i);)u++,xpathLog("stack: "+stackToString(n))}if(xpathLog("stack: "+stackToString(n)),1!=n.length)throw"XPath parse error "+a+":\n"+stackToString(n);var d=n[0].expr;return xpathParseCache[a]=d,xpathLog("XPath parse: "+p+" / "+l+" / "+u),d}function xpathCacheLookup(t){return xpathParseCache[t]}function xpathReduce(t,e){var r=null;if(t.length>0){var a=t[t.length-1],n=xpathRules[a.tag.key];if(n)for(var i=0;n.length>i;++i){var s=n[i],o=xpathMatchStack(t,s[1]);if(o.length){r={tag:s[0],rule:s,match:o},r.prec=xpathGrammarPrecedence(r);break}}}var p;if(r&&(!e||r.prec>e.prec||e.tag.left&&r.prec>=e.prec)){for(var i=0;r.match.matchlength>i;++i)t.pop();xpathLog("reduce "+r.tag.label+" "+r.prec+" ahead "+(e?e.tag.label+" "+e.prec+(e.tag.left?" left":""):" none "));var l=mapExpr(r.match,function(t){return t.expr});r.expr=r.rule[3].apply(null,l),t.push(r),p=!0}else e&&(xpathLog("shift "+e.tag.label+" "+e.prec+(e.tag.left?" left":"")+" over "+(r?r.tag.label+" "+r.prec:" none")),t.push(e)),p=!1;return p}function xpathMatchStack(t,e){var r,a,n=t.length,i=e.length,s=[];s.matchlength=0;var o=0;for(r=i-1,a=n-1;r>=0&&a>=0;--r,a-=o){o=0;var p=[];if(e[r]==Q_MM)for(r-=1,s.push(p);a-o>=0&&t[a-o].tag==e[r];)p.push(t[a-o]),o+=1,s.matchlength+=1;else if(e[r]==Q_01)for(r-=1,s.push(p);a-o>=0&&2>o&&t[a-o].tag==e[r];)p.push(t[a-o]),o+=1,s.matchlength+=1;else if(e[r]==Q_1M){if(r-=1,s.push(p),t[a].tag!=e[r])return[];for(;a-o>=0&&t[a-o].tag==e[r];)p.push(t[a-o]),o+=1,s.matchlength+=1}else{if(t[a].tag!=e[r])return[];s.push(t[a]),o+=1,s.matchlength+=1}reverseInplace(p),p.expr=mapExpr(p,function(t){return t.expr})}return reverseInplace(s),-1==r?s:[]}function xpathTokenPrecedence(t){return t.prec||2}function xpathGrammarPrecedence(t){var e=0;if(t.rule)if(t.rule.length>=3&&t.rule[2]>=0)e=t.rule[2];else for(var r=0;t.rule[1].length>r;++r){var a=xpathTokenPrecedence(t.rule[1][r]);e=Math.max(e,a)}else if(t.tag)e=xpathTokenPrecedence(t.tag);else if(t.length)for(var n=0;t.length>n;++n){var a=xpathGrammarPrecedence(t[n]);e=Math.max(e,a)}return e}function stackToString(t){for(var e="",r=0;t.length>r;++r)e&&(e+="\n"),e+=t[r].tag.label;return e}function ExprContext(t,e,r,a){this.node=t,this.position=e||0,this.nodelist=r||[t],this.variables={},this.parent=a||null,this.root=a?a.root:this.node.nodeType==DOM_DOCUMENT_NODE?t:t.ownerDocument}function StringValue(t){this.value=t,this.type="string"}function BooleanValue(t){this.value=t,this.type="boolean"}function NumberValue(t){this.value=t,this.type="number"}function NodeSetValue(t){this.value=t,this.type="node-set"}function TokenExpr(t){this.value=t}function LocationExpr(){this.absolute=!1,this.steps=[]}function xPathStep(t,e,r,a,n){for(var i=e[r],s=n.clone(a),o=i.evaluate(s).nodeSetValue(),p=0;o.length>p;++p)r==e.length-1?t.push(o[p]):xPathStep(t,e,r+1,o[p],n)}function StepExpr(t,e,r){this.axis=t,this.nodetest=e,this.predicate=r||[]}function NodeTestAny(){this.value=new BooleanValue(!0)}function NodeTestElementOrAttribute(){}function NodeTestText(){}function NodeTestComment(){}function NodeTestPI(t){this.target=t}function NodeTestNC(t){this.regex=RegExp("^"+t+":"),this.nsprefix=t}function NodeTestName(t){this.name=t}function PredicateExpr(t){this.expr=t}function FunctionCallExpr(t){this.name=t,this.args=[]}function UnionExpr(t,e){this.expr1=t,this.expr2=e}function PathExpr(t,e){this.filter=t,this.rel=e}function FilterExpr(t,e){this.expr=t,this.predicate=e}function UnaryMinusExpr(t){this.expr=t}function BinaryExpr(t,e,r){this.expr1=t,this.expr2=r,this.op=e}function LiteralExpr(t){this.value=t}function NumberExpr(t){this.value=t}function VariableExpr(t){this.name=t}function makeTokenExpr(t){return new TokenExpr(t)}function passExpr(t){return t}function makeLocationExpr1(t,e){return e.absolute=!0,e}function makeLocationExpr2(t,e){return e.absolute=!0,e.prependStep(makeAbbrevStep(t.value)),e}function makeLocationExpr3(){var t=new LocationExpr;return t.appendStep(makeAbbrevStep(".")),t.absolute=!0,t}function makeLocationExpr4(t){var e=new LocationExpr;return e.absolute=!0,e.appendStep(makeAbbrevStep(t.value)),e}function makeLocationExpr5(t){var e=new LocationExpr;return e.appendStep(t),e}function makeLocationExpr6(t,e,r){return t.appendStep(r),t}function makeLocationExpr7(t,e){return t.appendStep(makeAbbrevStep(e.value)),t}function makeStepExpr1(t){return makeAbbrevStep(t.value)}function makeStepExpr2(t){return makeAbbrevStep(t.value)}function makeStepExpr3(t,e,r){return new StepExpr(t.value,r)}function makeStepExpr4(t,e){return new StepExpr("attribute",e)}function makeStepExpr5(t){return new StepExpr("child",t)}function makeStepExpr6(t,e){return t.appendPredicate(e),t}function makeAbbrevStep(t){switch(t){case"//":return new StepExpr("descendant-or-self",new NodeTestAny);case".":return new StepExpr("self",new NodeTestAny);case"..":return new StepExpr("parent",new NodeTestAny)}}function makeNodeTestExpr1(){return new NodeTestElementOrAttribute}function makeNodeTestExpr2(t){return new NodeTestNC(t.value)}function makeNodeTestExpr3(t){return new NodeTestName(t.value)}function makeNodeTestExpr4(t){var e=t.value.replace(/\s*\($/,"");switch(e){case"node":return new NodeTestAny;case"text":return new NodeTestText;case"comment":return new NodeTestComment;case"processing-instruction":return new NodeTestPI("")}}function makeNodeTestExpr5(t,e){var r=t.replace(/\s*\($/,"");if("processing-instruction"!=r)throw r;return new NodeTestPI(e.value)}function makePredicateExpr(t,e){return new PredicateExpr(e)}function makePrimaryExpr(t,e){return e}function makeFunctionCallExpr1(t){return new FunctionCallExpr(t)}function makeFunctionCallExpr2(t,e,r,a){var n=new FunctionCallExpr(t);n.appendArg(r);for(var i=0;a.length>i;++i)n.appendArg(a[i]);return n}function makeArgumentExpr(t,e){return e}function makeUnionExpr(t,e,r){return new UnionExpr(t,r)}function makePathExpr1(t,e,r){return new PathExpr(t,r)}function makePathExpr2(t,e,r){return r.prependStep(makeAbbrevStep(e.value)),new PathExpr(t,r)}function makeFilterExpr(t,e){return e.length>0?new FilterExpr(t,e):t}function makeUnaryMinusExpr(t,e){return new UnaryMinusExpr(e)}function makeBinaryExpr(t,e,r){return new BinaryExpr(t,e,r)}function makeLiteralExpr(t){var e=t.value.substring(1,t.value.length-1);return new LiteralExpr(e)}function makeNumberExpr(t){return new NumberExpr(t.value)}function makeVariableReference(t,e){return new VariableExpr(e.value)}function makeSimpleExpr(t){if("$"==t.charAt(0))return new VariableExpr(t.substr(1));if("@"==t.charAt(0)){var e=new NodeTestName(t.substr(1)),r=new StepExpr("attribute",e),a=new LocationExpr;return a.appendStep(r),a}if(t.match(/^[0-9]+$/))return new NumberExpr(t);var e=new NodeTestName(t),r=new StepExpr("child",e),a=new LocationExpr;return a.appendStep(r),a}function makeSimpleExpr2(t){for(var e=stringSplit(t,"/"),r=new LocationExpr,a=0;e.length>a;++a){var n=new NodeTestName(e[a]),i=new StepExpr("child",n);r.appendStep(i)}return r}function xpathParseInit(){function t(t,e,r){t[e]||(t[e]=[]),t[e].push(r)}if(!xpathRules.length){xpathGrammarRules.sort(function(t,e){var r=t[1].length,a=e[1].length;return a>r?1:r>a?-1:0});for(var e=1,r=0;xpathNonTerminals.length>r;++r)xpathNonTerminals[r].key=e++;for(r=0;xpathTokenRules.length>r;++r)xpathTokenRules[r].key=e++;for(xpathLog("XPath parse INIT: "+e+" rules"),r=0;xpathGrammarRules.length>r;++r)for(var a=xpathGrammarRules[r],n=a[1],i=n.length-1;i>=0;--i){if(n[i]==Q_1M){t(xpathRules,n[i-1].key,a);break}if(n[i]!=Q_MM&&n[i]!=Q_01){t(xpathRules,n[i].key,a);break}t(xpathRules,n[i-1].key,a),--i}xpathLog("XPath parse INIT: "+xpathRules.length+" rule bins");var s=0;mapExec(xpathRules,function(t){t&&(s+=t.length)}),xpathLog("XPath parse INIT: "+s/xpathRules.length+" average bin size")}}function xpathCollectDescendants(t,e){for(var r=e.firstChild;r;r=r.nextSibling)t.push(r),arguments.callee(t,r)}function xpathCollectDescendantsReverse(t,e){for(var r=e.lastChild;r;r=r.previousSibling)t.push(r),arguments.callee(t,r)}function xpathDomEval(t,e){var r=xpathParse(t),a=r.evaluate(new ExprContext(e));return a}function xpathSort(t,e){if(0!=e.length){for(var r=[],a=0;t.contextSize()>a;++a){for(var n=t.nodelist[a],i={node:n,key:[]},s=t.clone(n,0,[n]),o=0;e.length>o;++o){var p,l=e[o],u=l.expr.evaluate(s);"text"==l.type?p=u.stringValue():"number"==l.type&&(p=u.numberValue()),i.key.push({value:p,order:l.order})}i.key.push({value:a,order:"ascending"}),r.push(i)}r.sort(xpathSortByKey);for(var h=[],a=0;r.length>a;++a)h.push(r[a].node);t.nodelist=h,t.setNode(0)}}function xpathSortByKey(t,e){for(var r=0;t.key.length>r;++r){var a="descending"==t.key[r].order?-1:1;if(t.key[r].value>e.key[r].value)return 1*a;if(t.key[r].value<e.key[r].value)return-1*a}return 0}function xpathEval(t,e){var r=xpathParse(t),a=r.evaluate(e);return a}Spry.Data.CSVDataSet=function(t,e){Spry.Data.HTTPSourceDataSet.call(this,t,e),this.firstRowAsHeaders=!0,this.columnNames=[],Spry.Utils.setOptions(this,e)},Spry.Data.CSVDataSet.prototype=new Spry.Data.HTTPSourceDataSet,Spry.Data.CSVDataSet.prototype.constructor=Spry.Data.CSVDataSet,Spry.Data.CSVDataSet.prototype.getDataRefStrings=function(){var t=[];return this.url&&t.push(this.url),t},Spry.Data.CSVDataSet.prototype.getDocument=function(){return this.doc},Spry.Data.CSVDataSet.cleanFieldString=function(t){return t=t.replace(/\s*(\r\n)\s*/g,"$1"),t=t.replace(/^[ \t]*"?|"?\s*,?\s*$/g,""),t.replace(/""/g,'"')},Spry.Data.CSVDataSet.prototype.columnNumberToColumnName=function(t){var e=this.columnNames[t];return e||(e="column"+t),e},Spry.Data.CSVDataSet.prototype.loadDataIntoDataSet=function(t){var e=[],r={},a=t?t:"";a.length;for(var n=this.firstRowAsHeaders,i=0,s=/([ \t]*"([^"]|"")*"[ \t]*,?)|([ \t]*[^",\r\n]+[ \t]*,?)|[ \t]*(\r\n|\r|\n)/gm,o=s.exec(a),p=null,l=-1,u=0;o&&o[0];){var h=Spry.Data.CSVDataSet.cleanFieldString(o[0]);"\r\n"==h||"\r"==h||"\n"==h?(n||(p.ds_RowID=u++,e.push(p),r[p.ds_RowID]=p,p=null),n=!1,l=-1):n?this.columnNames[++l]=h:(0==++l&&(p={}),p[this.columnNumberToColumnName(l)]=h),i=s.lastIndex,o=s.exec(a)}this.doc=t,this.data=e,this.dataHash=r,this.dataWasLoaded=null!=this.doc};var Spry;Spry||(Spry={}),Spry.Utils||(Spry.Utils={}),Spry.$=function(t){if(arguments.length>1){for(var e=0,r=[],a=arguments.length;a>e;e++)r.push(Spry.$(arguments[e]));return r}return"string"==typeof t&&(t=document.getElementById(t)),t},Spry.Utils.setAttribute=function(t,e,r){t=Spry.$(t),t&&e&&("class"==e?t.className=r:t.setAttribute(e,r))},Spry.Utils.removeAttribute=function(t,e){if(t=Spry.$(t),t&&e)try{t.removeAttribute(e),"class"==e&&t.removeAttribute("className")}catch(r){}},Spry.Utils.addClassName=function(t,e){t=Spry.$(t),!t||!e||t.className&&-1!=t.className.search(RegExp("\\b"+e+"\\b"))||(t.className+=(t.className?" ":"")+e)},Spry.Utils.removeClassName=function(t,e){t=Spry.$(t),Spry.Utils.hasClassName(t,e)&&(t.className=t.className.replace(RegExp("\\s*\\b"+e+"\\b","g"),""))},Spry.Utils.toggleClassName=function(t,e){Spry.Utils.hasClassName(t,e)?Spry.Utils.removeClassName(t,e):Spry.Utils.addClassName(t,e)},Spry.Utils.hasClassName=function(t,e){return t=Spry.$(t),t&&e&&t.className&&-1!=t.className.search(RegExp("\\b"+e+"\\b"))?!0:!1},Spry.Utils.camelizeString=function(t){for(var e="",r=t.split("-"),a=0;r.length>a;a++){var n=r[a];n&&(e=e?e+n.charAt(0).toUpperCase()+n.substring(1):n)}return e},Spry.Utils.styleStringToObject=function(t){var e={};if(t){pvA=t.split(";");for(var r=0;pvA.length>r;r++){var a=pvA[r];if(a&&-1!=a.indexOf(":")){var n=a.split(":"),i=n[0].replace(/^\s*|\s*$/g,""),s=n[1].replace(/^\s*|\s*$/g,"");i&&s&&(e[Spry.Utils.camelizeString(i)]=s)}}}return e},Spry.Utils.addEventListener=function(t,e,r,a){try{Spry.Utils.eventListenerIsBoundToElement(t,e,r,a)||(t=Spry.$(t),r=Spry.Utils.bindEventListenerToElement(t,e,r,a),t.addEventListener?t.addEventListener(e,r,a):t.attachEvent&&t.attachEvent("on"+e,r))}catch(n){}},Spry.Utils.removeEventListener=function(t,e,r,a){try{t=Spry.$(t),r=Spry.Utils.unbindEventListenerFromElement(t,e,r,a),t.removeEventListener?t.removeEventListener(e,r,a):t.detachEvent&&t.detachEvent("on"+e,r)}catch(n){}},Spry.Utils.eventListenerHash={},Spry.Utils.nextEventListenerID=1,Spry.Utils.getHashForElementAndHandler=function(t,e,r,a){var n=null;return t=Spry.$(t),t&&(t.spryEventListenerID===void 0&&(t.spryEventListenerID="e"+Spry.Utils.nextEventListenerID++),r.spryEventHandlerID===void 0&&(r.spryEventHandlerID="h"+Spry.Utils.nextEventListenerID++),n=t.spryEventListenerID+"-"+r.spryEventHandlerID+"-"+e+(a?"-capture":"")),n},Spry.Utils.eventListenerIsBoundToElement=function(t,e,r,a){t=Spry.$(t);var n=Spry.Utils.getHashForElementAndHandler(t,e,r,a);return void 0!=Spry.Utils.eventListenerHash[n]},Spry.Utils.bindEventListenerToElement=function(t,e,r,a){t=Spry.$(t);var n=Spry.Utils.getHashForElementAndHandler(t,e,r,a);return Spry.Utils.eventListenerHash[n]?Spry.Utils.eventListenerHash[n]:Spry.Utils.eventListenerHash[n]=function(e){e=e||window.event,e.preventDefault||(e.preventDefault=function(){this.returnValue=!1}),e.stopPropagation||(e.stopPropagation=function(){this.cancelBubble=!0});var a=r.call(t,e);return 0==a&&(e.preventDefault(),e.stopPropagation()),a}},Spry.Utils.unbindEventListenerFromElement=function(t,e,r,a){t=Spry.$(t);var n=Spry.Utils.getHashForElementAndHandler(t,e,r,a);return Spry.Utils.eventListenerHash[n]&&(r=Spry.Utils.eventListenerHash[n],Spry.Utils.eventListenerHash[n]=void 0),r},Spry.Utils.addLoadListener=function(t){window.addEventListener!==void 0?window.addEventListener("load",t,!1):document.addEventListener!==void 0?document.addEventListener("load",t,!1):window.attachEvent!==void 0&&window.attachEvent("onload",t)},Spry.Utils.getAncestor=function(t,e){if(t=Spry.$(t)){var r=Spry.$$.tokenizeSequence(e?e:"*")[0],a=r?r[0]:null;if(a)for(var n=t.parentNode;n;){if(a.match(n))return n;n=n.parentNode}}return null},Spry.$$=function(t,e){e=e?Spry.$(e):document;var r=Spry.$$.tokenizeSequence(t),a=[];Spry.$$.addExtensions(a),++Spry.$$.queryID;for(var n=0,i=r.length,s=0;i>s;s++)for(var o=Spry.$$.processTokens(r[s],e),p=o.length,l=0;p>l;l++){var u=o[l];u.spry$$ID||(u.spry$$ID=++n,a.push(u))}var p=a.length;for(s=0;p>s;s++)a[s].spry$$ID=void 0;return a},Spry.$$.cache={},Spry.$$.queryID=0,Spry.$$.Token=function(){this.type=Spry.$$.Token.SELECTOR,this.name="*",this.id="",this.classes=[],this.attrs=[],this.pseudos=[]},Spry.$$.Token.Attr=function(t,e){this.name=t,this.value=e?RegExp(e):void 0},Spry.$$.Token.PseudoClass=function(t){this.name=t.replace(/\(.*/,""),this.arg=t.replace(/^[^\(\)]*\(?\s*|\)\s*$/g,""),this.func=Spry.$$.pseudoFuncs[this.name]},Spry.$$.Token.SELECTOR=0,Spry.$$.Token.COMBINATOR=1,Spry.$$.Token.prototype.match=function(t,e){if(this.type==Spry.$$.Token.COMBINATOR)return!1;if(!e&&"*"!=this.name&&this.name!=t.nodeName.toLowerCase())return!1;if(this.id&&this.id!=t.id)return!1;for(var r=this.classes,a=r.length,n=0;a>n;n++)if(!t.className||!r[n].value.test(t.className))return!1;var i=this.attrs;a=i.length;for(var n=0;a>n;n++){var s=i[n],o=t.attributes.getNamedItem(s.name);if(!o||!s.value&&void 0==o.nodeValue||s.value&&!s.value.test(o.nodeValue))return!1}for(var p=this.pseudos,a=p.length,n=0;a>n;n++){var l=p[n];if(l&&l.func&&!l.func(l.arg,t,this))return!1}return!0},Spry.$$.Token.prototype.getNodeNameIfTypeMatches=function(t){var e=t.nodeName.toLowerCase();return"*"!=this.name?this.name!=e?null:this.name:e},Spry.$$.escapeRegExpCharsRE=/\/|\.|\*|\+|\(|\)|\[|\]|\{|\}|\\|\|/g,Spry.$$.tokenizeSequence=function(t){var e=Spry.$$.cache[t];if(e)return e;var r=/(\[[^\"'~\^\$\*\|\]=]+([~\^\$\*\|]?=\s*('[^']*'|"[^"]*"|[^"'\]]+))?\s*\])|((:[^\.#:\s,>~\+\[\]]+\(([^\(\)]+|\([^\(\)]*\))*\))|[\.#:]?[^\.#:\s,>~\+\[\]]+)|(\s*[\s,>~\+]\s*)/g,a=new Spry.$$.Token,n=[];n.push(a);var i=[];i.push(n),t=t.replace(/^\s*|\s*$/,"");for(var s=r.exec(t);s;){var o=s[0],p=o.charAt(0);switch(p){case".":a.classes.push(new Spry.$$.Token.Attr("class","\\b"+o.substr(1)+"\\b"));break;case"#":a.id=o.substr(1);break;case":":a.pseudos.push(new Spry.$$.Token.PseudoClass(o));break;case"[":var l=o.match(/\[([^\"'~\^\$\*\|\]=]+)(([~\^\$\*\|]?=)\s*('[^']*'|"[^"]*"|[^"'\]]+))?\s*\]/),u=l[1],h=l[3],c=l[4];c&&(c=c.replace(/^['"]|['"]$/g,""),c=c.replace(Spry.$$.escapeRegExpCharsRE,"\\$&"));var f=void 0;switch(h){case"=":f="^"+c+"$";break;case"^=":f="^"+c;break;case"$=":f=c+"$";break;case"~=":case"|=":f="\\b"+c+"\\b";break;case"*=":f=c}a.attrs.push(new Spry.$$.Token.Attr(u,f));break;default:var d=o.match(/^\s*([\s,~>\+])\s*$/);d?","==d[1]?(n=[],i.push(n),a=new Spry.$$.Token,n.push(a)):(a=new Spry.$$.Token,a.type=Spry.$$.Token.COMBINATOR,a.name=d[1],n.push(a),a=new Spry.$$.Token,n.push(a)):a.name=o.toLowerCase()}s=r.exec(t)}return Spry.$$.cache[t]=i,i},Spry.$$.combinatorFuncs={" ":function(t,e){for(var r=++Spry.$$.uniqueID,a=[],n=t.length,i=0;n>i;i++){var s=t[i];if(r!=s.spry$$uid)for(var o=t[i].getElementsByTagName(e.name),p=o.length,l=0;p>l;l++){var u=o[l];e.match(u,!0)&&a.push(u),u.spry$$uid=r}}return a},">":function(t,e){for(var r=[],a=t.length,n=0;a>n;n++)for(var i=t[n].firstChild;i;)1==i.nodeType&&e.match(i)&&r.push(i),i=i.nextSibling;return r},"+":function(t,e){for(var r=[],a=t.length,n=0;a>n;n++){for(var i=t[n].nextSibling;i&&1!=i.nodeType;)i=i.nextSibling;i&&e.match(i)&&r.push(i)}return r},"~":function(t,e){for(var r=++Spry.$$.uniqueID,a=[],n=t.length,i=0;n>i;i++)for(var s=t[i].nextSibling;s;){if(1==s.nodeType){if(r==s.spry$$uid)break;e.match(s)&&(a.push(s),s.spry$$uid=r)}s=s.nextSibling}return a}},Spry.$$.uniqueID=0,Spry.$$.pseudoFuncs={":first-child":function(t,e){for(var r=e.previousSibling;r;){if(1==r.nodeType)return!1;r=r.previousSibling}return!0},":last-child":function(t,e){for(var r=e.nextSibling;r;){if(1==r.nodeType)return!1;r=r.nextSibling}return!0},":empty":function(t,e){for(var r=e.firstChild;r;){switch(r.nodeType){case 1:case 3:case 4:case 5:return!1}r=r.nextSibling}return!0},":nth-child":function(t,e,r){return Spry.$$.nthChild(t,e,r)},":nth-last-child":function(t,e,r){return Spry.$$.nthChild(t,e,r,!0)},":nth-of-type":function(t,e,r){return Spry.$$.nthChild(t,e,r,!1,!0)},":nth-last-of-type":function(t,e,r){return Spry.$$.nthChild(t,e,r,!0,!0)},":first-of-type":function(t,e,r){var a=r.getNodeNameIfTypeMatches(e);if(!a)return!1;for(var n=e.previousSibling;n;){if(1==n.nodeType&&a==n.nodeName.toLowerCase())return!1;n=n.previousSibling}return!0},":last-of-type":function(t,e,r){var a=r.getNodeNameIfTypeMatches(e);if(!a)return!1;for(var n=e.nextSibling;n;){if(1==n.nodeType&&a==n.nodeName.toLowerCase())return!1;n=n.nextSibling}return!0},":only-child":function(t,e,r){var a=Spry.$$.pseudoFuncs;return a[":first-child"](t,e,r)&&a[":last-child"](t,e,r)},":only-of-type":function(t,e,r){var a=Spry.$$.pseudoFuncs;return a[":first-of-type"](t,e,r)&&a[":last-of-type"](t,e,r)},":not":function(t,e){var r=Spry.$$.tokenizeSequence(t)[0],a=r?r[0]:null;return!a||!a.match(e)},":enabled":function(t,e){return!e.disabled},":disabled":function(t,e){return e.disabled},":checked":function(t,e){return e.checked},":root":function(t,e){return e.parentNode&&e.ownerDocument&&e.parentNode==e.ownerDocument}},Spry.$$.nthRegExp=/((-|[0-9]+)?n)?([+-]?[0-9]*)/,Spry.$$.nthCache={even:{a:2,b:0,mode:1,invalid:!1},odd:{a:2,b:1,mode:1,invalid:!1},"2n":{a:2,b:0,mode:1,invalid:!1},"2n+1":{a:2,b:1,mode:1,invalid:!1}},Spry.$$.parseNthChildString=function(t){var e=Spry.$$.nthCache[t];if(!e){var r=t.match(Spry.$$.nthRegExp),a=r[1],n=r[2],i=r[3];n=n?"-"==n?-1:parseInt(n,10):a?1:0,i=i?parseInt(i,10):0;var s=0==n?0:n>0?1:-1,o=!1;n>0&&0>i?(i%=n,i=0>(i%=n)?n+i:i):0>n&&(0>i?o=!0:n=Math.abs(n)),e={},e.a=n,e.b=i,e.mode=s,e.invalid=o,Spry.$$.nthCache[t]=e}return e},Spry.$$.nthChild=function(t,e,r,a,n){if(n){var i=r.getNodeNameIfTypeMatches(e);if(!i)return!1}var s=Spry.$$.parseNthChildString(t);if(s.invalid)return!1;var o="spry$$ncQueryID",p="spry$$ncPos",l="spry$$ncCount";n&&(o+=i,p+=i,l+=i);var u=e.parentNode;if(u[o]!=Spry.$$.queryID){var h=0;u[o]=Spry.$$.queryID;for(var c=u.firstChild;c;)1!=c.nodeType||n&&i!=c.nodeName.toLowerCase()||(c[p]=++h),c=c.nextSibling;u[l]=h}return h=e[p],a&&(h=u[l]-h+1),0==s.mode?h==s.b:s.mode>0?s.b>h?!1:!((h-s.b)%s.a):h>s.b?!1:!((s.b-h)%s.a)},Spry.$$.processTokens=function(t,e){for(var r=t.length,a=[e],n=null,i=0;r>i&&a.length>0;i++){var s=t[i];s.type==Spry.$$.Token.SELECTOR?n?(a=n(a,s),n=null):a=Spry.$$.getMatchingElements(a,s):n=Spry.$$.combinatorFuncs[s.name]}return a},Spry.$$.getMatchingElements=function(t,e){var r=[];if(e.id&&(s=t[0],s&&s.ownerDocument)){var a=s.ownerDocument.getElementById(e.id);return a&&e.match(a)&&r.push(a),r}for(var n=t.length,i=0;n>i;i++)for(var s=t[i],o=s.getElementsByTagName(e.name),p=o.length,l=0;p>l;l++){var a=o[l];e.match(a,!0)&&r.push(a)}return r},Spry.$$.addExtensions=function(t){for(var e in Spry.$$.Results)t[e]=Spry.$$.Results[e]},Spry.$$.Results={},Spry.$$.Results.forEach=function(t){for(var e=this.length,r=0;e>r;r++)t(this[r]);return this},Spry.$$.Results.setAttribute=function(t,e){return this.forEach(function(r){Spry.Utils.setAttribute(r,t,e)})},Spry.$$.Results.removeAttribute=function(t){return this.forEach(function(e){Spry.Utils.removeAttribute(e,t)})},Spry.$$.Results.addClassName=function(t){return this.forEach(function(e){Spry.Utils.addClassName(e,t)})},Spry.$$.Results.removeClassName=function(t){return this.forEach(function(e){Spry.Utils.removeClassName(e,t)})},Spry.$$.Results.toggleClassName=function(t){return this.forEach(function(e){Spry.Utils.toggleClassName(e,t)})},Spry.$$.Results.addEventListener=function(t,e,r,a){return this.forEach(function(n){Spry.Utils.addEventListener(n,t,e,r,a)})},Spry.$$.Results.removeEventListener=function(t,e,r){return this.forEach(function(a){Spry.Utils.removeEventListener(a,t,e,r)})},Spry.$$.Results.setStyle=function(t){return t&&(t=Spry.Utils.styleStringToObject(t),this.forEach(function(e){for(var r in t)try{e.style[r]=t[r]}catch(a){}})),this},Spry.$$.Results.setProperty=function(t,e){if(t){if("string"==typeof t){var r={};r[t]=e,t=r}this.forEach(function(e){for(var r in t)try{e[r]=t[r]}catch(a){}})}return this};var Spry;Spry||(Spry={}),Spry.Utils||(Spry.Utils={}),Spry.Utils.msProgIDs=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0"],Spry.Utils.createXMLHttpRequest=function(){var t=null;try{if(window.ActiveXObject)for(;!t&&Spry.Utils.msProgIDs.length;){try{t=new ActiveXObject(Spry.Utils.msProgIDs[0])}catch(e){t=null}t||Spry.Utils.msProgIDs.splice(0,1)}!t&&window.XMLHttpRequest&&(t=new XMLHttpRequest)}catch(e){t=null}return t||Spry.Debug.reportError("Failed to create an XMLHttpRequest object!"),t},Spry.Utils.loadURL=function(t,e,r,a,n){var i=new Spry.Utils.loadURL.Request;i.method=t,i.url=e,i.async=r,i.successCallback=a,Spry.Utils.setOptions(i,n);try{if(i.xhRequest=Spry.Utils.createXMLHttpRequest(),!i.xhRequest)return null;if(i.async&&(i.xhRequest.onreadystatechange=function(){Spry.Utils.loadURL.callback(i)}),i.xhRequest.open(i.method,i.url,i.async,i.username,i.password),i.headers)for(var s in i.headers)i.xhRequest.setRequestHeader(s,i.headers[s]);i.xhRequest.send(i.postData),i.async||Spry.Utils.loadURL.callback(i)}catch(o){i.errorCallback?i.errorCallback(i):Spry.Debug.reportError("Exception caught while loading "+e+": "+o),i=null}return i},Spry.Utils.loadURL.callback=function(t){t&&4==t.xhRequest.readyState&&(!t.successCallback||200!=t.xhRequest.status&&0!=t.xhRequest.status?t.errorCallback&&t.errorCallback(t):t.successCallback(t))},Spry.Utils.loadURL.Request=function(){for(var t=Spry.Utils.loadURL.Request.props,e=t.length,r=0;e>r;r++)this[t[r]]=null;this.method="GET",this.async=!0,this.headers={}},Spry.Utils.loadURL.Request.props=["method","url","async","username","password","postData","successCallback","errorCallback","headers","userData","xhRequest"],Spry.Utils.loadURL.Request.prototype.extractRequestOptions=function(t,e){if(t)for(var r=Spry.Utils.loadURL.Request.props,a=r.length,n=0;a>n;n++){var i=r[n];void 0!=t[i]&&(this[i]=t[i],e&&(t[i]=void 0))}},Spry.Utils.loadURL.Request.prototype.clone=function(){for(var t=Spry.Utils.loadURL.Request.props,e=t.length,r=new Spry.Utils.loadURL.Request,a=0;e>a;a++)r[t[a]]=this[t[a]];return this.headers&&(r.headers={},Spry.Utils.setOptions(r.headers,this.headers)),r},Spry.Utils.setInnerHTML=function(t,e,r){if(t){t=Spry.$(t);var a="<script[^>]*>(.|s|\n|\r)*?</script>";if(t.innerHTML=e.replace(RegExp(a,"img"),""),!r){var n=e.match(RegExp(a,"img"));if(n)for(var i=n.length,s=0;i>s;s++){var o=n[s].replace(/<script[^>]*>[\s\r\n]*(<\!--)?|(-->)?[\s\r\n]*<\/script>/gim,"");Spry.Utils.eval(o)}}}},Spry.Utils.updateContent=function(t,e,r,a){Spry.Utils.loadURL("GET",e,!0,function(a){Spry.Utils.setInnerHTML(t,a.xhRequest.responseText),r&&r(t,e)},a)},Spry.$$||(Spry.Utils.addEventListener=function(t,e,r,a){try{t=Spry.$(t),t.addEventListener?t.addEventListener(e,r,a):t.attachEvent&&t.attachEvent("on"+e,r)}catch(n){}},Spry.Utils.removeEventListener=function(t,e,r,a){try{t=Spry.$(t),t.removeEventListener?t.removeEventListener(e,r,a):t.detachEvent&&t.detachEvent("on"+e,r)}catch(n){}},Spry.Utils.addLoadListener=function(t){window.addEventListener!==void 0?window.addEventListener("load",t,!1):document.addEventListener!==void 0?document.addEventListener("load",t,!1):window.attachEvent!==void 0&&window.attachEvent("onload",t)},Spry.Utils.addClassName=function(t,e){t=Spry.$(t),!t||!e||t.className&&-1!=t.className.search(RegExp("\\b"+e+"\\b"))||(t.className+=(t.className?" ":"")+e)},Spry.Utils.removeClassName=function(t,e){t=Spry.$(t),!t||!e||t.className&&-1==t.className.search(RegExp("\\b"+e+"\\b"))||(t.className=t.className.replace(RegExp("\\s*\\b"+e+"\\b","g"),""))},Spry.Utils.getObjectByName=function(t){var e=null;if(t)for(var r=window,a=t.split("."),n=0;r&&a.length>n;n++)e=r[a[n]],r=e;return e},Spry.$=function(t){if(arguments.length>1){for(var e=0,r=[],a=arguments.length;a>e;e++)r.push(Spry.$(arguments[e]));return r}return"string"==typeof t&&(t=document.getElementById(t)),t}),Spry.Utils.eval=function(str){return eval(str)},Spry.Utils.escapeQuotesAndLineBreaks=function(t){return t&&(t=t.replace(/\\/g,"\\\\"),t=t.replace(/["']/g,"\\$&"),t=t.replace(/\n/g,"\\n"),t=t.replace(/\r/g,"\\r")),t},Spry.Utils.encodeEntities=function(t){return t&&-1!=t.search(/[&<>"]/)&&(t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=t.replace(/"/g,"&quot;")),t},Spry.Utils.decodeEntities=function(t){var e=Spry.Utils.decodeEntities.div;return e||(e=document.createElement("div"),Spry.Utils.decodeEntities.div=e,e)?(e.innerHTML=t,1==e.childNodes.length&&3==e.firstChild.nodeType&&null==e.firstChild.nextSibling?t=e.firstChild.data:(t=t.replace(/&lt;/gi,"<"),t=t.replace(/&gt;/gi,">"),t=t.replace(/&quot;/gi,'"'),t=t.replace(/&amp;/gi,"&")),t):t},Spry.Utils.fixupIETagAttributes=function(t){var e="",r=t.match(/^<[^\s>]+\s*/)[0],a=t.match(/\s*\/?>$/)[0],n=t.replace(/^<[^\s>]+\s*|\s*\/?>/g,"");if(e+=r,n)for(var i=0,s=0;n.length>i;){for(;"="!=n.charAt(s)&&n.length>s;)++s;if(s>=n.length){e+=n.substring(i,s);break}if(++s,e+=n.substring(i,s),i=s,'"'==n.charAt(s)||"'"==n.charAt(s)){for(var o=s++;n.length>s;){if(n.charAt(s)==n.charAt(o)){s++;break}"\\"==n.charAt(s)&&s++,s++}e+=n.substring(i,s),i=s}else{e+='"';var p=n.slice(s).search(/\s/);s=-1!=p?s+p:n.length,e+=n.slice(i,s),e+='"',i=s}}return e+=a},Spry.Utils.fixUpIEInnerHTML=function(t){for(var e="",r=RegExp("<\\!--|<\\!\\[CDATA\\[|<\\w+[^<>]*>|-->|\\]\\](>|&gt;)","g"),a=0,n=0;t.length;){var i=r.exec(t);if(!i||!i[0]){e+=t.substr(a,t.length-a);break}i.index!=a&&(e+=t.substr(a,i.index-a)),"<!--"==i[0]||"<![CDATA["==i[0]?(++n,e+=i[0]):"-->"==i[0]||"]]>"==i[0]||n&&"]]&gt;"==i[0]?(--n,e+=i[0]):e+=n||"<"!=i[0].charAt(0)?i[0]:Spry.Utils.fixupIETagAttributes(i[0]),a=r.lastIndex}return e},Spry.Utils.stringToXMLDoc=function(t){var e=null;try{var r=new ActiveXObject("Microsoft.XMLDOM");r.async=!1,r.loadXML(t),e=r}catch(a){try{var n=new DOMParser;e=n.parseFromString(t,"text/xml")}catch(a){Spry.Debug.reportError("Caught exception in Spry.Utils.stringToXMLDoc(): "+a+"\n"),e=null}}return e},Spry.Utils.serializeObject=function(t){var e="",r=!0;if(null==t||void 0==t)return e+t;var a=typeof t;if("number"==a||"boolean"==a)e+=t;else if("string"==a)e+='"'+Spry.Utils.escapeQuotesAndLineBreaks(t)+'"';else if(t.constructor==Array){e+="[";for(var n=0;t.length>n;n++)r||(e+=", "),e+=Spry.Utils.serializeObject(t[n]),r=!1;e+="]"}else if("object"==a){e+="{";for(var i in t)r||(e+=", "),e+='"'+i+'": '+Spry.Utils.serializeObject(t[i]),r=!1;e+="}"}return e},Spry.Utils.getNodesByFunc=function(t,e){for(var r=[],a=[],n=t;n;){if(e(n)&&a.push(n),n.hasChildNodes())r.push(n),n=n.firstChild;else if(n==t)n=null;else try{n=n.nextSibling}catch(i){n=null}for(;!n&&r.length>0;)if(n=r.pop(),n==t)n=null;else try{n=n.nextSibling}catch(i){n=null}}return r&&r.length>0&&Spry.Debug.trace("-- WARNING: Spry.Utils.getNodesByFunc() failed to traverse all nodes!\n"),a},Spry.Utils.getFirstChildWithNodeName=function(t,e){for(var r=t.firstChild;r;){if(r.nodeName==e)return r;r=r.nextSibling}return null},Spry.Utils.setOptions=function(t,e,r){if(e)for(var a in e)r&&void 0==e[a]||(t[a]=e[a])},Spry.Utils.SelectionManager={},Spry.Utils.SelectionManager.selectionGroups={},Spry.Utils.SelectionManager.SelectionGroup=function(){this.selectedElements=[]},Spry.Utils.SelectionManager.SelectionGroup.prototype.select=function(t,e,r){var a=null;if(r){for(var n=0;this.selectedElements.length>n;n++)if(a=this.selectedElements[n].element,a.element==t)return a.className!=e&&(Spry.Utils.removeClassName(t,a.className),Spry.Utils.addClassName(t,e)),void 0}else this.clearSelection();a={},a.element=t,a.className=e,this.selectedElements.push(a),Spry.Utils.addClassName(t,e)},Spry.Utils.SelectionManager.SelectionGroup.prototype.unSelect=function(t){for(var e=0;this.selectedElements.length>e;e++){var r=this.selectedElements[e].element;if(r.element==t)return Spry.Utils.removeClassName(r.element,r.className),void 0}},Spry.Utils.SelectionManager.SelectionGroup.prototype.clearSelection=function(){var t=null;do t=this.selectedElements.shift(),t&&Spry.Utils.removeClassName(t.element,t.className);while(t)},Spry.Utils.SelectionManager.getSelectionGroup=function(t){if(!t)return null;
var e=Spry.Utils.SelectionManager.selectionGroups[t];return e||(e=new Spry.Utils.SelectionManager.SelectionGroup,Spry.Utils.SelectionManager.selectionGroups[t]=e),e},Spry.Utils.SelectionManager.select=function(t,e,r,a){var n=Spry.Utils.SelectionManager.getSelectionGroup(t);n&&n.select(e,r,a)},Spry.Utils.SelectionManager.unSelect=function(t,e){var r=Spry.Utils.SelectionManager.getSelectionGroup(t);r&&r.unSelect(e,className)},Spry.Utils.SelectionManager.clearSelection=function(t){var e=Spry.Utils.SelectionManager.getSelectionGroup(t);e&&e.clearSelection()},Spry.Utils.Notifier=function(){this.observers=[],this.suppressNotifications=0},Spry.Utils.Notifier.prototype.addObserver=function(t){if(t){for(var e=this.observers.length,r=0;e>r;r++)if(this.observers[r]==t)return;this.observers[e]=t}},Spry.Utils.Notifier.prototype.removeObserver=function(t){if(t)for(var e=0;this.observers.length>e;e++)if(this.observers[e]==t){this.observers.splice(e,1);break}},Spry.Utils.Notifier.prototype.notifyObservers=function(t,e){if(t&&!this.suppressNotifications)for(var r=this.observers.length,a=0;r>a;a++){var n=this.observers[a];n&&("function"==typeof n?n(t,this,e):n[t]&&n[t](this,e))}},Spry.Utils.Notifier.prototype.enableNotifications=function(){0>--this.suppressNotifications&&(this.suppressNotifications=0,Spry.Debug.reportError("Unbalanced enableNotifications() call!\n"))},Spry.Utils.Notifier.prototype.disableNotifications=function(){++this.suppressNotifications},Spry.Debug={},Spry.Debug.enableTrace=!0,Spry.Debug.debugWindow=null,Spry.Debug.onloadDidFire=!1,Spry.Utils.addLoadListener(function(){Spry.Debug.onloadDidFire=!0,Spry.Debug.flushQueuedMessages()}),Spry.Debug.flushQueuedMessages=function(){if(Spry.Debug.flushQueuedMessages.msgs){for(var t=Spry.Debug.flushQueuedMessages.msgs,e=0;t.length>e;e++)Spry.Debug.debugOut(t[e].msg,t[e].color);Spry.Debug.flushQueuedMessages.msgs=null}},Spry.Debug.createDebugWindow=function(){if(Spry.Debug.enableTrace&&!Spry.Debug.debugWindow&&Spry.Debug.onloadDidFire)try{Spry.Debug.debugWindow=document.createElement("div");var t=Spry.Debug.debugWindow;t.style.fontSize="12px",t.style.fontFamily="console",t.style.position="absolute",t.style.width="400px",t.style.height="300px",t.style.overflow="auto",t.style.border="solid 1px black",t.style.backgroundColor="white",t.style.color="black",t.style.bottom="0px",t.style.right="0px",t.setAttribute("id","SpryDebugWindow"),document.body.appendChild(Spry.Debug.debugWindow)}catch(e){}},Spry.Debug.debugOut=function(t,e){if(!Spry.Debug.debugWindow&&(Spry.Debug.createDebugWindow(),!Spry.Debug.debugWindow))return Spry.Debug.flushQueuedMessages.msgs||(Spry.Debug.flushQueuedMessages.msgs=[]),Spry.Debug.flushQueuedMessages.msgs.push({msg:t,color:e}),void 0;var r=document.createElement("div");e&&(r.style.backgroundColor=e),r.innerHTML=t,Spry.Debug.debugWindow.appendChild(r)},Spry.Debug.trace=function(t){Spry.Debug.debugOut(t)},Spry.Debug.reportError=function(t){Spry.Debug.debugOut(t,"red")},Spry.Data={},Spry.Data.regionsArray={},Spry.Data.initRegionsOnLoad=!0,Spry.Data.initRegions=function(t){t=t?Spry.$(t):document.body;var e,r,a,n=null,i=Spry.Utils.getNodesByFunc(t,function(t){try{if(1!=t.nodeType)return!1;var e="spry:region",r=t.attributes.getNamedItem(e);if(r||(e="spry:detailregion",r=t.attributes.getNamedItem(e)),r){if(n)for(var a=t.parentNode;a;){if(a==n)return Spry.Debug.reportError("Found a nested "+e+" in the following markup. Nested regions are currently not supported.<br/><pre>"+Spry.Utils.encodeEntities(a.innerHTML)+"</pre>"),!1;a=a.parentNode}if(r.value)return r=t.attributes.getNamedItem("id"),r&&r.value||t.setAttribute("id","spryregion"+ ++Spry.Data.initRegions.nextUniqueRegionID),n=t,!0;Spry.Debug.reportError(e+" attributes require one or more data set names as values!")}}catch(i){}return!1}),s=[];for(a=0;i.length>a;a++){var o=i[a],p=!1;if(e=o.attributes.getNamedItem("id").value,attr=o.attributes.getNamedItem("spry:region"),attr||(attr=o.attributes.getNamedItem("spry:detailregion"),p=!0),attr.value)if(o.attributes.removeNamedItem(attr.nodeName),Spry.Utils.removeClassName(o,Spry.Data.Region.hiddenRegionClassName),r=Spry.Data.Region.strToDataSetsArray(attr.value),r.length){var l=!1,u=!1,h="",c={},f={};attr=o.attributes.getNamedItem("spry:readystate"),attr&&attr.value&&(f.ready=attr.value),attr=o.attributes.getNamedItem("spry:errorstate"),attr&&attr.value&&(f.error=attr.value),attr=o.attributes.getNamedItem("spry:loadingstate"),attr&&attr.value&&(f.loading=attr.value),attr=o.attributes.getNamedItem("spry:expiredstate"),attr&&attr.value&&(f.expired=attr.value),Spry.Utils.getNodesByFunc(o,function(t){try{if(1==t.nodeType){for(var e=t.attributes,r=Spry.Data.Region.PI.orderedInstructions.length,a=null,n=null,i=0;r>i;i++){var s=Spry.Data.Region.PI.orderedInstructions[i],p=e.getNamedItem(s);if(p){var u=Spry.Data.Region.PI.instructions[s],h=t==o?!0:u.childrenOnly,f=u.getOpenTag(t,s),d=u.getCloseTag(t,s);if(h){var S=document.createComment(f),y=document.createComment(d);a?t.insertBefore(S,a.nextSibling):t.insertBefore(S,t.firstChild),a=S,n?t.insertBefore(y,n):t.appendChild(y),n=y}else{var g=t.parentNode;g.insertBefore(document.createComment(f),t),g.insertBefore(document.createComment(d),t.nextSibling)}"spry:state"==s&&(c[p.value]=!0),t.removeAttribute(s)}}if(Spry.Data.Region.enableBehaviorAttributes){var D=Spry.Data.Region.behaviorAttrs;for(var v in D){var m=e.getNamedItem(v);m&&(l=!0,D[v].setup&&D[v].setup(t,m.value))}}}}catch(E){}return!1}),h=o.innerHTML,window.ActiveXObject&&!Spry.Data.Region.disableIEInnerHTMLFixUp&&-1!=h.search(/=\{/)&&(Spry.Data.Region.debug&&Spry.Debug.trace("<hr />Performing IE innerHTML fix up of Region: "+e+"<br /><br />"+Spry.Utils.encodeEntities(h)),h=Spry.Utils.fixUpIEInnerHTML(h)),Spry.Data.Region.debug&&Spry.Debug.trace("<hr />Region template markup for '"+e+"':<br /><br />"+Spry.Utils.encodeEntities(h)),u||(o.innerHTML="");var d=new Spry.Data.Region(o,e,p,h,r,c,f,l);Spry.Data.regionsArray[d.name]=d,s.push(d)}else Spry.Debug.reportError("spry:region or spry:detailregion attribute has no data set!");else Spry.Debug.reportError("spry:region and spry:detailregion attributes require one or more data set names as values!")}for(var a=0;s.length>a;a++)s[a].updateContent()},Spry.Data.initRegions.nextUniqueRegionID=0,Spry.Data.updateRegion=function(t){if(t&&Spry.Data.regionsArray&&Spry.Data.regionsArray[t])try{Spry.Data.regionsArray[t].updateContent()}catch(e){Spry.Debug.reportError("Spry.Data.updateRegion("+t+") caught an exception: "+e+"\n")}},Spry.Data.getRegion=function(t){return Spry.Data.regionsArray[t]},Spry.Data.updateAllRegions=function(){if(Spry.Data.regionsArray)for(var t in Spry.Data.regionsArray)Spry.Data.updateRegion(t)},Spry.Data.getDataSetByName=function(t){var e=window[t];return"object"==typeof e&&e.getData&&e.filter?e:null},Spry.Data.DataSet=function(t){Spry.Utils.Notifier.call(this),this.name="",this.internalID=Spry.Data.DataSet.nextDataSetID++,this.curRowID=0,this.data=[],this.unfilteredData=null,this.dataHash={},this.columnTypes={},this.filterFunc=null,this.filterDataFunc=null,this.distinctOnLoad=!1,this.distinctFieldsOnLoad=null,this.sortOnLoad=null,this.sortOrderOnLoad="ascending",this.keepSorted=!1,this.dataWasLoaded=!1,this.pendingRequest=null,this.lastSortColumns=[],this.lastSortOrder="",this.loadIntervalID=0,Spry.Utils.setOptions(this,t)},Spry.Data.DataSet.prototype=new Spry.Utils.Notifier,Spry.Data.DataSet.prototype.constructor=Spry.Data.DataSet,Spry.Data.DataSet.prototype.getData=function(t){return t&&this.unfilteredData?this.unfilteredData:this.data},Spry.Data.DataSet.prototype.getUnfilteredData=function(){return this.getData(!0)},Spry.Data.DataSet.prototype.getLoadDataRequestIsPending=function(){return null!=this.pendingRequest},Spry.Data.DataSet.prototype.getDataWasLoaded=function(){return this.dataWasLoaded},Spry.Data.DataSet.prototype.getValue=function(t,e){var r=void 0;switch(e||(e=this.getCurrentRow()),t){case"ds_RowNumber":r=this.getRowNumber(e);break;case"ds_RowNumberPlus1":r=this.getRowNumber(e)+1;break;case"ds_RowCount":r=this.getRowCount();break;case"ds_UnfilteredRowCount":r=this.getRowCount(!0);break;case"ds_CurrentRowNumber":r=this.getCurrentRowNumber();break;case"ds_CurrentRowID":r=this.getCurrentRowID();break;case"ds_EvenOddRow":r=this.getRowNumber(e)%2?Spry.Data.Region.evenRowClassName:Spry.Data.Region.oddRowClassName;break;case"ds_SortOrder":r=this.getSortOrder();break;case"ds_SortColumn":r=this.getSortColumn();break;default:e&&(r=e[t])}return r},Spry.Data.DataSet.prototype.setDataFromArray=function(t,e){this.notifyObservers("onPreLoad"),this.unfilteredData=null,this.filteredData=null,this.data=[],this.dataHash={};for(var r=t.length,a=0;r>a;a++){var n=t[a];void 0==n.ds_RowID&&(n.ds_RowID=a),this.dataHash[n.ds_RowID]=n,this.data.push(n)}this.loadData(e)},Spry.Data.DataSet.prototype.loadData=function(t){var e=this;this.pendingRequest={},this.dataWasLoaded=!1;var r=function(){e.pendingRequest=null,e.dataWasLoaded=!0,e.applyColumnTypes(),e.disableNotifications(),e.filterAndSortData(),e.enableNotifications(),e.notifyObservers("onPostLoad"),e.notifyObservers("onDataChanged")};t?r():this.pendingRequest.timer=setTimeout(r,0)},Spry.Data.DataSet.prototype.filterAndSortData=function(){this.filterDataFunc&&this.filterData(this.filterDataFunc,!0),this.distinctOnLoad&&this.distinct(this.distinctFieldsOnLoad),this.keepSorted&&this.getSortColumn()?this.sort(this.lastSortColumns,this.lastSortOrder):this.sortOnLoad&&this.sort(this.sortOnLoad,this.sortOrderOnLoad),this.filterFunc&&this.filter(this.filterFunc,!0),this.curRowID=this.data&&this.data.length>0?this.data[0].ds_RowID:0},Spry.Data.DataSet.prototype.cancelLoadData=function(){this.pendingRequest&&this.pendingRequest.timer&&clearTimeout(this.pendingRequest.timer),this.pendingRequest=null},Spry.Data.DataSet.prototype.getRowCount=function(t){var e=this.getData(t);return e?e.length:0},Spry.Data.DataSet.prototype.getRowByID=function(t){return this.data?this.dataHash[t]:null},Spry.Data.DataSet.prototype.getRowByRowNumber=function(t,e){var r=this.getData(e);return r&&t>=0&&r.length>t?r[t]:null},Spry.Data.DataSet.prototype.getCurrentRow=function(){return this.getRowByID(this.curRowID)},Spry.Data.DataSet.prototype.setCurrentRow=function(t){if(this.curRowID!=t){var e={oldRowID:this.curRowID,newRowID:t};this.curRowID=t,this.notifyObservers("onCurrentRowChanged",e)}},Spry.Data.DataSet.prototype.getRowNumber=function(t,e){if(t){var r=this.getData(e);if(r&&r.length)for(var a=r.length,n=0;a>n;n++)if(r[n]==t)return n}return-1},Spry.Data.DataSet.prototype.getCurrentRowNumber=function(){return this.getRowNumber(this.getCurrentRow())},Spry.Data.DataSet.prototype.getCurrentRowID=function(){return this.curRowID},Spry.Data.DataSet.prototype.setCurrentRowNumber=function(t){if(!this.data||t>=this.data.length)return Spry.Debug.trace("Invalid row number: "+t+"\n"),void 0;var e=this.data[t].ds_RowID;void 0!=e&&this.curRowID!=e&&this.setCurrentRow(e)},Spry.Data.DataSet.prototype.findRowsWithColumnValues=function(t,e,r){var a=[],n=this.getData(r);if(n)for(var i=n.length,s=0;i>s;s++){var o=n[s],p=!0;for(var l in t)if(t[l]!=o[l]){p=!1;break}if(p){if(e)return o;a.push(o)}}return e?null:a},Spry.Data.DataSet.prototype.setColumnType=function(t,e){if(t){"string"==typeof t&&(t=[t]);for(var r=0;t.length>r;r++)this.columnTypes[t[r]]=e}},Spry.Data.DataSet.prototype.getColumnType=function(t){return this.columnTypes[t]?this.columnTypes[t]:"string"},Spry.Data.DataSet.prototype.applyColumnTypes=function(){var t=this.getData(!0),e=t.length;if(!(1>e))for(var r in this.columnTypes){var a=this.columnTypes[r];if("string"!=a)for(var n=0;e>n;n++){var i=t[n],s=i[r];void 0!=s&&("number"==a?i[r]=new Number(s):"html"==a&&(i[r]=Spry.Utils.decodeEntities(s)))}}},Spry.Data.DataSet.prototype.distinct=function(t){if(this.data){var e=this.data;this.data=[],this.dataHash={};var r=!1,a={},n=0,i=[];if("string"==typeof t)i=[t];else if(t)i=t;else for(var s in e[0])i[n++]=s;for(var n=0;e.length>n;n++){for(var o=e[n],p="",l=0;i.length>l;l++)s=i[l],"ds_RowID"!=s&&(p&&(p+=","),p+=s+":"+'"'+o[s]+'"');a[p]?r=!0:(this.data.push(o),this.dataHash[o.ds_RowID]=o,a[p]=!0)}r&&this.notifyObservers("onDataChanged")}},Spry.Data.DataSet.prototype.getSortColumn=function(){return this.lastSortColumns&&this.lastSortColumns.length>0?this.lastSortColumns[0]:""},Spry.Data.DataSet.prototype.getSortOrder=function(){return this.lastSortOrder?this.lastSortOrder:""},Spry.Data.DataSet.prototype.sort=function(t,e){if(t){if("string"==typeof t?t=[t,"ds_RowID"]:2>t.length&&"ds_RowID"!=t[0]&&t.push("ds_RowID"),e||(e="toggle"),"toggle"==e&&(e=this.lastSortColumns.length>0&&this.lastSortColumns[0]==t[0]&&"ascending"==this.lastSortOrder?"descending":"ascending"),"ascending"!=e&&"descending"!=e)return Spry.Debug.reportError("Invalid sort order type specified: "+e+"\n"),void 0;var r={oldSortColumns:this.lastSortColumns,oldSortOrder:this.lastSortOrder,newSortColumns:t,newSortOrder:e};this.notifyObservers("onPreSort",r);for(var a=t[t.length-1],n=Spry.Data.DataSet.prototype.sort.getSortFunc(a,this.getColumnType(a),e),i=t.length-2;i>=0;i--)a=t[i],n=Spry.Data.DataSet.prototype.sort.buildSecondarySortFunc(Spry.Data.DataSet.prototype.sort.getSortFunc(a,this.getColumnType(a),e),n);this.unfilteredData?(this.unfilteredData.sort(n),this.filterFunc&&this.filter(this.filterFunc,!0)):this.data.sort(n),this.lastSortColumns=t.slice(0),this.lastSortOrder=e,this.notifyObservers("onPostSort",r)}},Spry.Data.DataSet.prototype.sort.getSortFunc=function(t,e,r){var a=null;return a="number"==e?"ascending"==r?function(e,r){return e=e[t],r=r[t],void 0==e||void 0==r?e==r?0:e?1:-1:e-r}:function(e,r){return e=e[t],r=r[t],void 0==e||void 0==r?e==r?0:e?-1:1:r-e}:"date"==e?"ascending"==r?function(e,r){var a=e[t],n=r[t];return a=a?new Date(a):0,n=n?new Date(n):0,a-n}:function(e,r){var a=e[t],n=r[t];return a=a?new Date(a):0,n=n?new Date(n):0,n-a}:"ascending"==r?function(e,r){if(e=e[t],r=r[t],void 0==e||void 0==r)return e==r?0:e?1:-1;for(var a=""+e,n=""+r,i=a.toLowerCase(),s=n.toLowerCase(),o=a.length>n.length?n.length:a.length,p=0;o>p;p++){var l=i.charAt(p),u=s.charAt(p),h=a.charAt(p),c=n.charAt(p);if(l>u)return 1;if(u>l)return-1;if(h>c)return 1;if(c>h)return-1}return a.length==n.length?0:a.length>n.length?1:-1}:function(e,r){if(e=e[t],r=r[t],void 0==e||void 0==r)return e==r?0:e?-1:1;for(var a=""+e,n=""+r,i=a.toLowerCase(),s=n.toLowerCase(),o=a.length>n.length?n.length:a.length,p=0;o>p;p++){var l=i.charAt(p),u=s.charAt(p),h=a.charAt(p),c=n.charAt(p);if(l>u)return-1;if(u>l)return 1;if(h>c)return-1;if(c>h)return 1}return a.length==n.length?0:a.length>n.length?-1:1}},Spry.Data.DataSet.prototype.sort.buildSecondarySortFunc=function(t,e){return function(r,a){var n=t(r,a);return 0==n&&(n=e(r,a)),n}},Spry.Data.DataSet.prototype.filterData=function(t,e){var r=!1;if(t){if(this.filterDataFunc=t,this.dataWasLoaded&&(this.unfilteredData&&this.unfilteredData.length||this.data&&this.data.length)){this.unfilteredData&&(this.data=this.unfilteredData,this.unfilteredData=null);var a=this.data;this.data=[],this.dataHash={};for(var n=0;a.length>n;n++){var i=t(this,a[n],n);i&&(this.data.push(i),this.dataHash[i.ds_RowID]=i)}r=!0}}else this.filterDataFunc=null,r=!0;r&&(e||(this.disableNotifications(),this.filterFunc&&this.filter(this.filterFunc,!0),this.enableNotifications()),this.notifyObservers("onDataChanged"))},Spry.Data.DataSet.prototype.filter=function(t){var e=!1;if(t){if(this.filterFunc=t,this.dataWasLoaded&&(this.unfilteredData||this.data&&this.data.length)){this.unfilteredData||(this.unfilteredData=this.data);var r=this.unfilteredData;this.data=[];for(var a=0;r.length>a;a++){var n=t(this,r[a],a);n&&this.data.push(n)}e=!0}}else this.filterFunc&&this.unfilteredData&&(this.data=this.unfilteredData,this.unfilteredData=null,this.filterFunc=null,e=!0);e&&this.notifyObservers("onDataChanged")},Spry.Data.DataSet.prototype.startLoadInterval=function(t){if(this.stopLoadInterval(),t>0){var e=this;this.loadInterval=t,this.loadIntervalID=setInterval(function(){e.loadData()},t)}},Spry.Data.DataSet.prototype.stopLoadInterval=function(){this.loadIntervalID&&clearInterval(this.loadIntervalID),this.loadInterval=0,this.loadIntervalID=null},Spry.Data.DataSet.nextDataSetID=0,Spry.Data.HTTPSourceDataSet=function(t,e){Spry.Data.DataSet.call(this),this.url=t,this.dataSetsForDataRefStrings=[],this.hasDataRefStrings=!1,this.useCache=!0,this.setRequestInfo(e,!0),Spry.Utils.setOptions(this,e,!0),this.recalculateDataSetDependencies(),this.loadInterval>0&&this.startLoadInterval(this.loadInterval)},Spry.Data.HTTPSourceDataSet.prototype=new Spry.Data.DataSet,Spry.Data.HTTPSourceDataSet.prototype.constructor=Spry.Data.HTTPSourceDataSet,Spry.Data.HTTPSourceDataSet.prototype.setRequestInfo=function(t,e){this.requestInfo=new Spry.Utils.loadURL.Request,this.requestInfo.extractRequestOptions(t,e),"POST"==this.requestInfo.method&&(this.requestInfo.headers||(this.requestInfo.headers={}),this.requestInfo.headers["Content-Type"]||(this.requestInfo.headers["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"))},Spry.Data.HTTPSourceDataSet.prototype.recalculateDataSetDependencies=function(){this.hasDataRefStrings=!1;var t=0;for(t=0;this.dataSetsForDataRefStrings.length>t;t++){var e=this.dataSetsForDataRefStrings[t];e&&e.removeObserver(this)}this.dataSetsForDataRefStrings=[];for(var r=this.getDataRefStrings(),a=0,n=0;r.length>n;n++){var i=Spry.Data.Region.getTokensFromStr(r[n]);for(t=0;i&&i.length>t;t++)if(-1!=i[t].search(/{[^}:]+::[^}]+}/)){var s=i[t].replace(/^\{|::.*\}/g,""),e=null;this.dataSetsForDataRefStrings[s]||(e=Spry.Data.getDataSetByName(s),s&&e&&(this.dataSetsForDataRefStrings[s]=e,this.dataSetsForDataRefStrings[a++]=e,this.hasDataRefStrings=!0))}}for(t=0;this.dataSetsForDataRefStrings.length>t;t++){var e=this.dataSetsForDataRefStrings[t];e.addObserver(this)}},Spry.Data.HTTPSourceDataSet.prototype.getDataRefStrings=function(){var t=[];return this.url&&t.push(this.url),this.requestInfo&&this.requestInfo.postData&&t.push(this.requestInfo.postData),t},Spry.Data.HTTPSourceDataSet.prototype.attemptLoadData=function(){for(var t=0;this.dataSetsForDataRefStrings.length>t;t++){var e=this.dataSetsForDataRefStrings[t];if(e.getLoadDataRequestIsPending()||!e.getDataWasLoaded())return}this.loadData()},Spry.Data.HTTPSourceDataSet.prototype.onCurrentRowChanged=function(){this.attemptLoadData()},Spry.Data.HTTPSourceDataSet.prototype.onPostSort=function(){this.attemptLoadData()},Spry.Data.HTTPSourceDataSet.prototype.onDataChanged=function(){this.attemptLoadData()},Spry.Data.HTTPSourceDataSet.prototype.loadData=function(){if(this.url){this.cancelLoadData();var t=this.url,e=this.requestInfo.postData;if(this.hasDataRefStrings){for(var r=!0,a=0;this.dataSetsForDataRefStrings.length>a;a++){var n=this.dataSetsForDataRefStrings[a];n.getLoadDataRequestIsPending()?r=!1:n.getDataWasLoaded()||(n.loadData(),r=!1)}if(!r)return;if(t=Spry.Data.Region.processDataRefString(null,this.url,this.dataSetsForDataRefStrings),!t)return;e&&"string"==typeof e&&(e=Spry.Data.Region.processDataRefString(null,e,this.dataSetsForDataRefStrings))}this.notifyObservers("onPreLoad"),this.data=null,this.dataWasLoaded=!1,this.unfilteredData=null,this.dataHash=null,this.curRowID=0;var i=this.requestInfo.clone();i.url=t,i.postData=e,this.pendingRequest={},this.pendingRequest.data=Spry.Data.HTTPSourceDataSet.LoadManager.loadData(i,this,this.useCache)}},Spry.Data.HTTPSourceDataSet.prototype.cancelLoadData=function(){this.pendingRequest&&(Spry.Data.HTTPSourceDataSet.LoadManager.cancelLoadData(this.pendingRequest.data,this),this.pendingRequest=null)},Spry.Data.HTTPSourceDataSet.prototype.getURL=function(){return this.url},Spry.Data.HTTPSourceDataSet.prototype.setURL=function(t,e){(this.url!=t||e&&(this.requestInfo.method!=e.method||"POST"==e.method&&this.requestInfo.postData!=e.postData))&&(this.url=t,this.setRequestInfo(e),this.cancelLoadData(),this.recalculateDataSetDependencies(),this.dataWasLoaded=!1)},Spry.Data.HTTPSourceDataSet.prototype.setDataFromDoc=function(t){this.pendingRequest=null,this.loadDataIntoDataSet(t),this.applyColumnTypes(),this.disableNotifications(),this.filterAndSortData(),this.enableNotifications(),this.notifyObservers("onPostLoad"),this.notifyObservers("onDataChanged")},Spry.Data.HTTPSourceDataSet.prototype.loadDataIntoDataSet=function(){this.dataHash={},this.data=[],this.dataWasLoaded=!0},Spry.Data.HTTPSourceDataSet.prototype.xhRequestProcessor=function(t){var e=t.responseText;return 200==t.status||0==t.status?e:null},Spry.Data.HTTPSourceDataSet.prototype.sessionExpiredChecker=function(t){return"session expired"==t.xhRequest.responseText?!0:!1},Spry.Data.HTTPSourceDataSet.prototype.setSessionExpiredChecker=function(t){this.sessionExpiredChecker=t},Spry.Data.HTTPSourceDataSet.prototype.onRequestResponse=function(t){this.setDataFromDoc(t.rawData)},Spry.Data.HTTPSourceDataSet.prototype.onRequestError=function(t,e){this.notifyObservers("onLoadError",e)},Spry.Data.HTTPSourceDataSet.prototype.onRequestSessionExpired=function(t,e){this.notifyObservers("onSessionExpired",e)},Spry.Data.HTTPSourceDataSet.LoadManager={},Spry.Data.HTTPSourceDataSet.LoadManager.cache=[],Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest=function(t,e,r){Spry.Utils.Notifier.call(this),this.reqInfo=t,this.rawData=null,this.timer=null,this.state=Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.NOT_LOADED,this.xhRequestProcessor=e,this.sessionExpiredChecker=r},Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.prototype=new Spry.Utils.Notifier,Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.prototype.constructor=Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest,Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.NOT_LOADED=1,Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_REQUESTED=2,Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_FAILED=3,Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_SUCCESSFUL=4,Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.prototype.loadDataCallback=function(t){if(4==t.xhRequest.readyState){var e=null;if(this.xhRequestProcessor&&(e=this.xhRequestProcessor(t.xhRequest)),this.sessionExpiredChecker&&(Spry.Utils.setOptions(t,{rawData:e},!1),this.sessionExpiredChecker(t)))return this.state=Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_FAILED,this.notifyObservers("onRequestSessionExpired",t),this.observers.length=0,void 0;if(!e)return this.state=Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_FAILED,this.notifyObservers("onRequestError",t),this.observers.length=0,void 0;this.rawData=e,this.state=Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_SUCCESSFUL,this.notifyObservers("onRequestResponse",t),this.observers.length=0}},Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.prototype.loadData=function(){var t=this;this.cancelLoadData(),this.rawData=null,this.state=Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_REQUESTED;var e=this.reqInfo.clone();e.successCallback=function(e){t.loadDataCallback(e)},e.errorCallback=e.successCallback,this.timer=setTimeout(function(){t.timer=null,Spry.Utils.loadURL(e.method,e.url,e.async,e.successCallback,e)},0)},Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.prototype.cancelLoadData=function(){this.state==Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_REQUESTED&&(this.timer&&(this.timer.clearTimeout(),this.timer=null),this.rawData=null,this.state=Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.NOT_LOADED)},Spry.Data.HTTPSourceDataSet.LoadManager.getCacheKey=function(t){return t.method+"::"+t.url+"::"+t.postData+"::"+t.username},Spry.Data.HTTPSourceDataSet.LoadManager.loadData=function(t,e,r){if(!t)return null;var a=null,n=null;if(r&&(n=Spry.Data.HTTPSourceDataSet.LoadManager.getCacheKey(t),a=Spry.Data.HTTPSourceDataSet.LoadManager.cache[n]),a){if(a.state==Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_REQUESTED)return e&&a.addObserver(e),a;if(a.state==Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest.LOAD_SUCCESSFUL)return e&&setTimeout(function(){e.setDataFromDoc(a.rawData)},0),a}return a||(a=new Spry.Data.HTTPSourceDataSet.LoadManager.CachedRequest(t,e?e.xhRequestProcessor:null,e?e.sessionExpiredChecker:null),r&&(Spry.Data.HTTPSourceDataSet.LoadManager.cache[n]=a,a.addObserver({onRequestError:function(){Spry.Data.HTTPSourceDataSet.LoadManager.cache[n]=void 0}}))),e&&a.addObserver(e),a.loadData(),a},Spry.Data.HTTPSourceDataSet.LoadManager.cancelLoadData=function(t,e){t&&(e?t.removeObserver(e):t.cancelLoadData())},Spry.Data.XMLDataSet=function(t,e,r){this.xpath=e,this.doc=null,this.subPaths=[],this.entityEncodeStrings=!0,Spry.Data.HTTPSourceDataSet.call(this,t,r);var a=typeof this.subPaths;("string"==a||"object"==a&&this.subPaths.constructor!=Array)&&(this.subPaths=[this.subPaths])},Spry.Data.XMLDataSet.prototype=new Spry.Data.HTTPSourceDataSet,Spry.Data.XMLDataSet.prototype.constructor=Spry.Data.XMLDataSet,Spry.Data.XMLDataSet.prototype.getDataRefStrings=function(){var t=[];return this.url&&t.push(this.url),this.xpath&&t.push(this.xpath),this.requestInfo&&this.requestInfo.postData&&t.push(this.requestInfo.postData),t},Spry.Data.XMLDataSet.prototype.getDocument=function(){return this.doc},Spry.Data.XMLDataSet.prototype.getXPath=function(){return this.xpath},Spry.Data.XMLDataSet.prototype.setXPath=function(t){this.xpath!=t&&(this.xpath=t,this.dataWasLoaded&&this.doc&&(this.notifyObservers("onPreLoad"),this.setDataFromDoc(this.doc)))},Spry.Data.XMLDataSet.nodeContainsElementNode=function(t){if(t)for(t=t.firstChild;t;){if(1==t.nodeType)return!0;t=t.nextSibling}return!1},Spry.Data.XMLDataSet.getNodeText=function(t,e,r){var a="";if(t){try{for(var n=t.firstChild;n;){try{3==n.nodeType?a+=e?Spry.Utils.encodeEntities(n.data):n.data:4==n.nodeType&&(a+=r?Spry.Utils.encodeEntities(n.data):n.data)}catch(i){Spry.Debug.reportError("Spry.Data.XMLDataSet.getNodeText() exception caught: "+i+"\n")}n=n.nextSibling}}catch(i){Spry.Debug.reportError("Spry.Data.XMLDataSet.getNodeText() exception caught: "+i+"\n")}return a}},Spry.Data.XMLDataSet.createObjectForNode=function(t,e,r){if(!t)return null;var a={},n=0,i=null;try{for(n=0;t.attributes.length>n;n++)i=t.attributes[n],i&&2==i.nodeType&&(a["@"+i.name]=i.value)}catch(s){Spry.Debug.reportError("Spry.Data.XMLDataSet.createObjectForNode() caught exception while accessing attributes: "+s+"\n")}var o=t.firstChild;for(o&&!o.nextSibling&&1!=o.nodeType&&(a[t.nodeName]=Spry.Data.XMLDataSet.getNodeText(t,e,r));o;){if(1==o.nodeType&&!Spry.Data.XMLDataSet.nodeContainsElementNode(o)){a[o.nodeName]=Spry.Data.XMLDataSet.getNodeText(o,e,r);try{var p=o.nodeName+"/@";for(n=0;o.attributes.length>n;n++)i=o.attributes[n],i&&2==i.nodeType&&(a[p+i.name]=i.value)}catch(s){Spry.Debug.reportError("Spry.Data.XMLDataSet.createObjectForNode() caught exception while accessing attributes: "+s+"\n")}}o=o.nextSibling}return a},Spry.Data.XMLDataSet.getRecordSetFromXMLDoc=function(t,e,r,a){if(!t||!e)return null;var n={};n.xmlDoc=t,n.xmlPath=e,n.dataHash={},n.data=[],n.getData=function(){return this.data};var i=new ExprContext(t),s=xpathParse(e),o=s.evaluate(i),p=o.nodeSetValue(),l=!0;p&&p.length>0&&(l=2!=p[0].nodeType);var u=0,h=!0,c=!1;"boolean"==typeof a&&(h=c=a);for(var f=0;p.length>f;f++){var d=null;r?d={}:l?d=Spry.Data.XMLDataSet.createObjectForNode(p[f],h,c):(d={},d["@"+p[f].name]=p[f].value),d&&(d.ds_RowID=u++,d.ds_XMLNode=p[f],n.dataHash[d.ds_RowID]=d,n.data.push(d))}return n},Spry.Data.XMLDataSet.PathNode=function(t){this.path=t,this.subPaths=[],this.xpath=""},Spry.Data.XMLDataSet.PathNode.prototype.addSubPath=function(t){var e=this.findSubPath(t);return e||(e=new Spry.Data.XMLDataSet.PathNode(t),this.subPaths.push(e)),e},Spry.Data.XMLDataSet.PathNode.prototype.findSubPath=function(t){for(var e=this.subPaths.length,r=0;e>r;r++){var a=this.subPaths[r];if(t==a.path)return a}return null},Spry.Data.XMLDataSet.PathNode.prototype.consolidate=function(){var t=this.subPaths.length;if(!this.xpath&&1==t){var e=this.subPaths[0];return this.path+=("/"!=e[0]?"/":"")+e.path,this.xpath=e.xpath,this.subPaths=e.subPaths,this.consolidate(),void 0}for(var r=0;t>r;r++)this.subPaths[r].consolidate()},Spry.Data.XMLDataSet.prototype.convertXPathsToPathTree=function(t){for(var e=t.length,r=new Spry.Data.XMLDataSet.PathNode(""),a=0;e>a;a++){var n=t[a],i=n.replace(/\/\//g,"/__SPRYDS__");i=i.replace(/^\//,"");for(var s=i.split(/\//),o=s.length,p=r,l=0;o>l;l++){var u=s[l].replace(/__SPRYDS__/,"//");p=p.addSubPath(u)}p.xpath=n}return r.consolidate(),r},Spry.Data.XMLDataSet.prototype.flattenSubPaths=function(t,e){if(t&&e){var r=e.length;if(!(1>r)){for(var a=t.data,n={},i=[],s=[],o=0;r>o;o++){var p=e[o];"object"==typeof p&&(p=p.path),p||(p=""),i[o]=Spry.Data.Region.processDataRefString(null,p,this.dataSetsForDataRefStrings),s[o]=i[o].replace(/\[.*\]/g,"")}for(var l,u=a.length,h=[],o=0;u>o;o++){l=a[o];for(var c=[l],f=0;r>f;f++){var d=Spry.Data.XMLDataSet.getRecordSetFromXMLDoc(l.ds_XMLNode,i[f],e[f].xpath?!1:!0,this.entityEncodeStrings);if(d&&d.data&&d.data.length){if("object"==typeof e[f]&&e[f].subPaths){var S=e[f].subPaths;spType=typeof S,"string"==spType?S=[S]:"object"==spType&&spType.constructor==Object&&(S=[S]),this.flattenSubPaths(d,S)}for(var y=d.data,g=y.length,D=s[f]+"/",v=c.length,m=[],E=0;v>E;E++)for(var b=c[E],x=0;g>x;x++){var R={},T=y[x];for(w in b)R[w]=b[w];for(var w in T){var N=D+w;(D==w+"/"||-1!=D.search(RegExp("\\/"+w+"\\/$")))&&(N=s[f]),R[N]=T[w]}m.push(R)}c=m}}h=h.concat(c)}for(a=h,u=a.length,o=0;u>o;o++)l=a[o],l.ds_RowID=o,n[l.ds_RowID]=l;t.data=a,t.dataHash=n}}},Spry.Data.XMLDataSet.prototype.loadDataIntoDataSet=function(t){var e=null,r=Spry.Data.Region.processDataRefString(null,this.xpath,this.dataSetsForDataRefStrings),a=this.subPaths,n=!1;if(this.subPaths&&this.subPaths.length>0){for(var i=[],s=a.length,o=0;s>o;o++){var p=Spry.Data.Region.processDataRefString(null,a[o],this.dataSetsForDataRefStrings);"/"!=p.charAt(0)&&(p=r+"/"+p),i.push(p)}i.unshift(r);var l=this.convertXPathsToPathTree(i);r=l.path,a=l.subPaths,n=l.xpath?!1:!0}return(e=Spry.Data.XMLDataSet.getRecordSetFromXMLDoc(t,r,n,this.entityEncodeStrings))?(this.flattenSubPaths(e,a),this.doc=e.xmlDoc,this.data=e.data,this.dataHash=e.dataHash,this.dataWasLoaded=null!=this.doc,void 0):(Spry.Debug.reportError("Spry.Data.XMLDataSet.loadDataIntoDataSet() failed to create dataSet '"+this.name+"'for '"+this.xpath+"' - "+this.url+"\n"),void 0)},Spry.Data.XMLDataSet.prototype.xhRequestProcessor=function(t){var e=t.responseXML,r=!1;return 200!=t.status?0==t.status&&(!t.responseText||e&&e.firstChild||(r=!0)):e||(r=!0),r&&(e=Spry.Utils.stringToXMLDoc(t.responseText)),e&&e.firstChild&&"parsererror"!=e.firstChild.nodeName?e:null},Spry.Data.XMLDataSet.prototype.sessionExpiredChecker=function(t){if("session expired"==t.xhRequest.responseText)return!0;if(t.rawData){var e=t.rawData.documentElement.firstChild;if(e&&"session expired"==e.nodeValue)return!0}return!1},Spry.Data.Region=function(t,e,r,a,n,i,s,o){this.regionNode=t,this.name=e,this.isDetailRegion=r,this.data=a,this.dataSets=n,this.hasBehaviorAttributes=o,this.tokens=null,this.currentState=null,this.states={ready:!0},this.stateMap={},Spry.Utils.setOptions(this.states,i),Spry.Utils.setOptions(this.stateMap,s);for(var p=0;this.dataSets.length>p;p++){var l=this.dataSets[p];try{l&&l.addObserver(this)}catch(u){Spry.Debug.reportError("Failed to add '"+this.name+"' as a dataSet observer!\n")}}},Spry.Data.Region.hiddenRegionClassName="SpryHiddenRegion",Spry.Data.Region.evenRowClassName="even",Spry.Data.Region.oddRowClassName="odd",Spry.Data.Region.notifiers={},Spry.Data.Region.evalScripts=!0,Spry.Data.Region.addObserver=function(t,e){var r=Spry.Data.Region.notifiers[t];r||(r=new Spry.Utils.Notifier,Spry.Data.Region.notifiers[t]=r),r.addObserver(e)},Spry.Data.Region.removeObserver=function(t,e){var r=Spry.Data.Region.notifiers[t];r&&r.removeObserver(e)},Spry.Data.Region.notifyObservers=function(t,e,r){var a=Spry.Data.Region.notifiers[e.name];
if(a){var n={};r&&"object"==typeof r?n=r:n.data=r,n.region=e,n.regionID=e.name,n.regionNode=e.regionNode,a.notifyObservers(t,n)}},Spry.Data.Region.RS_Error=1,Spry.Data.Region.RS_LoadingData=2,Spry.Data.Region.RS_PreUpdate=4,Spry.Data.Region.RS_PostUpdate=8,Spry.Data.Region.prototype.getState=function(){return this.currentState},Spry.Data.Region.prototype.mapState=function(t,e){this.stateMap[t]=e},Spry.Data.Region.prototype.getMappedState=function(t){var e=this.stateMap[t];return e?e:t},Spry.Data.Region.prototype.setState=function(t,e){var r={state:t,mappedState:this.getMappedState(t)};if(e||Spry.Data.Region.notifyObservers("onPreStateChange",this,r),this.currentState=r.mappedState?r.mappedState:t,this.states[t]){var a={state:this.currentState};e||Spry.Data.Region.notifyObservers("onPreUpdate",this,a);var n=this.transform();Spry.Data.Region.debug&&Spry.Debug.trace("<hr />Generated region markup for '"+this.name+"':<br /><br />"+Spry.Utils.encodeEntities(n)),Spry.Utils.setInnerHTML(this.regionNode,n,!Spry.Data.Region.evalScripts),this.hasBehaviorAttributes&&this.attachBehaviors(),e||Spry.Data.Region.notifyObservers("onPostUpdate",this,a)}e||Spry.Data.Region.notifyObservers("onPostStateChange",this,r)},Spry.Data.Region.prototype.getDataSets=function(){return this.dataSets},Spry.Data.Region.prototype.addDataSet=function(t){if(t){this.dataSets||(this.dataSets=[]);for(var e=0;this.dataSets.length>e;e++)if(this.dataSets[e]==t)return;this.dataSets.push(t),t.addObserver(this)}},Spry.Data.Region.prototype.removeDataSet=function(t){if(t&&!this.dataSets)for(var e=0;this.dataSets.length>e;e++)if(this.dataSets[e]==t)return this.dataSets.splice(e,1),t.removeObserver(this),void 0},Spry.Data.Region.prototype.onPreLoad=function(){"loading"!=this.currentState&&this.setState("loading")},Spry.Data.Region.prototype.onLoadError=function(){"error"!=this.currentState&&this.setState("error"),Spry.Data.Region.notifyObservers("onError",this)},Spry.Data.Region.prototype.onSessionExpired=function(){"expired"!=this.currentState&&this.setState("expired"),Spry.Data.Region.notifyObservers("onExpired",this)},Spry.Data.Region.prototype.onCurrentRowChanged=function(){this.isDetailRegion&&this.updateContent()},Spry.Data.Region.prototype.onPostSort=function(){this.updateContent()},Spry.Data.Region.prototype.onDataChanged=function(){this.updateContent()},Spry.Data.Region.enableBehaviorAttributes=!0,Spry.Data.Region.behaviorAttrs={},Spry.Data.Region.behaviorAttrs["spry:select"]={attach:function(t,e,r){var a=null;try{a=e.attributes.getNamedItem("spry:selectgroup").value}catch(n){}a||(a="default"),Spry.Utils.addEventListener(e,"click",function(){Spry.Utils.SelectionManager.select(a,e,r)},!1),e.attributes.getNamedItem("spry:selected")&&Spry.Utils.SelectionManager.select(a,e,r)}},Spry.Data.Region.behaviorAttrs["spry:hover"]={attach:function(t,e,r){Spry.Utils.addEventListener(e,"mouseover",function(){Spry.Utils.addClassName(e,r)},!1),Spry.Utils.addEventListener(e,"mouseout",function(){Spry.Utils.removeClassName(e,r)},!1)}},Spry.Data.Region.setUpRowNumberForEvenOddAttr=function(t,e,r,a){if(!r)return Spry.Debug.showError("The "+e+" attribute requires a CSS class name as its value!"),t.attributes.removeNamedItem(e),void 0;var n="",i=r.split(/\s/);i.length>1&&(n=i[0],t.setAttribute(e,i[1])),t.setAttribute(a,"{"+(n?n+"::":"")+"ds_RowNumber}")},Spry.Data.Region.behaviorAttrs["spry:even"]={setup:function(t,e){Spry.Data.Region.setUpRowNumberForEvenOddAttr(t,"spry:even",e,"spryevenrownumber")},attach:function(t,e,r){if(r&&(rowNumAttr=e.attributes.getNamedItem("spryevenrownumber"),rowNumAttr&&rowNumAttr.value)){var a=parseInt(rowNumAttr.value);a%2&&Spry.Utils.addClassName(e,r)}e.removeAttribute("spry:even"),e.removeAttribute("spryevenrownumber")}},Spry.Data.Region.behaviorAttrs["spry:odd"]={setup:function(t,e){Spry.Data.Region.setUpRowNumberForEvenOddAttr(t,"spry:odd",e,"spryoddrownumber")},attach:function(t,e,r){if(r&&(rowNumAttr=e.attributes.getNamedItem("spryoddrownumber"),rowNumAttr&&rowNumAttr.value)){var a=parseInt(rowNumAttr.value);0==a%2&&Spry.Utils.addClassName(e,r)}e.removeAttribute("spry:odd"),e.removeAttribute("spryoddrownumber")}},Spry.Data.Region.setRowAttrClickHandler=function(t,e,r,a){if(e){var n=Spry.Data.getDataSetByName(e);if(n&&(rowIDAttr=t.attributes.getNamedItem(r))){var i=rowIDAttr.value;i&&Spry.Utils.addEventListener(t,"click",function(){n[a](i)},!1)}}},Spry.Data.Region.behaviorAttrs["spry:setrow"]={setup:function(t,e){return e?(t.setAttribute("spryrowid","{"+e+"::ds_RowID}"),void 0):(Spry.Debug.reportError("The spry:setrow attribute requires a data set name as its value!"),t.removeAttribute("spry:setrow"),void 0)},attach:function(t,e,r){Spry.Data.Region.setRowAttrClickHandler(e,r,"spryrowid","setCurrentRow"),e.removeAttribute("spry:setrow"),e.removeAttribute("spryrowid")}},Spry.Data.Region.behaviorAttrs["spry:setrownumber"]={setup:function(t,e){return e?(t.setAttribute("spryrownumber","{"+e+"::ds_RowID}"),void 0):(Spry.Debug.reportError("The spry:setrownumber attribute requires a data set name as its value!"),t.removeAttribute("spry:setrownumber"),void 0)},attach:function(t,e,r){Spry.Data.Region.setRowAttrClickHandler(e,r,"spryrownumber","setCurrentRowNumber"),e.removeAttribute("spry:setrownumber"),e.removeAttribute("spryrownumber")}},Spry.Data.Region.behaviorAttrs["spry:sort"]={attach:function(t,e,r){if(r){var a=t.getDataSets()[0],n="toggle",i=r.split(/\s/);if(i.length>1){var s=Spry.Data.getDataSetByName(i[0]);if(s&&(a=s,i.shift()),i.length>1){var o=i[i.length-1];("ascending"==o||"descending"==o||"toggle"==o)&&(n=o,i.pop())}}a&&i.length>0&&Spry.Utils.addEventListener(e,"click",function(){a.sort(i,n)},!1),e.removeAttribute("spry:sort")}}},Spry.Data.Region.prototype.attachBehaviors=function(){var t=this;Spry.Utils.getNodesByFunc(this.regionNode,function(e){if(!e||1!=e.nodeType)return!1;try{var r=Spry.Data.Region.behaviorAttrs;for(var a in r){var n=e.attributes.getNamedItem(a);if(n){var i=r[a];i&&i.attach&&i.attach(t,e,n.value)}}}catch(s){}return!1})},Spry.Data.Region.prototype.updateContent=function(){var t=!0,e=this.getDataSets();if(!e||1>e.length)return Spry.Debug.reportError("updateContent(): Region '"+this.name+"' has no data set!\n"),void 0;for(var r=0;e.length>r;r++){var a=e[r];a&&(a.getLoadDataRequestIsPending()?t=!1:a.getDataWasLoaded()||(a.loadData(),t=!1))}return t?(this.setState("ready"),void 0):(Spry.Data.Region.notifyObservers("onLoadingData",this),void 0)},Spry.Data.Region.prototype.clearContent=function(){this.regionNode.innerHTML=""},Spry.Data.Region.processContentPI=function(t){for(var e="",r=/<!--\s*<\/?spry:content\s*[^>]*>\s*-->/gm,a=0,n=0;t.length;){var i=r.exec(t);if(!i||!i[0]){e+=t.substr(a,t.length-a);break}if(n||i.index==a||(e+=t.substr(a,i.index-a)),-1!=i[0].search(/<\//))--n,n&&Spry.Debug.reportError("Nested spry:content regions are not allowed!\n");else{++n;var s=i[0].replace(/.*\bdataref="/,"");e+=s.replace(/".*$/,"")}a=r.lastIndex}return e},Spry.Data.Region.prototype.tokenizeData=function(t){if(!t)return null;var e=new Spry.Data.Region.Token(Spry.Data.Region.Token.LIST_TOKEN,null,null,null),r=[],a=Spry.Data.Region.processContentPI(t);r.push(e);for(var n=/((<!--\s*){0,1}<\/{0,1}spry:[^>]+>(\s*-->){0,1})|((\{|%7[bB])[^\}\s%]+(\}|%7[dD]))/gm,i=0;a.length;){var s=n.exec(a),o=null;if(!s||!s[0]){var p=a.substr(i,a.length-i);o=new Spry.Data.Region.Token(Spry.Data.Region.Token.STRING_TOKEN,null,p,p),r[r.length-1].addChild(o);break}if(s.index!=i){var p=a.substr(i,s.index-i);o=new Spry.Data.Region.Token(Spry.Data.Region.Token.STRING_TOKEN,null,p,p),r[r.length-1].addChild(o)}if(-1!=s[0].search(/^({|%7[bB])/)){var l=s[0],u=s[0];l=l.replace(/^({|%7[bB])/,""),l=l.replace(/(}|%7[dD])$/,"");var h=null,c=l.split(/::/);c.length>1&&(h=c[0],l=c[1]),u=u.replace(/^%7[bB]/,"{"),u=u.replace(/%7[dD]$/,"}"),o=new Spry.Data.Region.Token(Spry.Data.Region.Token.VALUE_TOKEN,h,l,new String(u)),r[r.length-1].addChild(o)}else{if("<"!=s[0].charAt(0))return Spry.Debug.reportError("Invalid region token: "+s[0]+"\n"),null;var f=s[0].replace(/^(<!--\s*){0,1}<\/?/,"");if(f=f.replace(/>(\s*-->){0,1}|\s.*$/,""),-1!=s[0].search(/<\//)){if(r[r.length-1].tokenType!=Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN)return Spry.Debug.reportError("Invalid processing instruction close tag: "+f+" -- "+s[0]+"\n"),null;r.pop()}else{var d=Spry.Data.Region.PI.instructions[f];if(!d)return Spry.Debug.reportError("Unsupported region processing instruction: "+s[0]+"\n"),null;var S=null,y="";-1!=s[0].search(/^.*\bselect=\"/)&&(y=s[0].replace(/^.*\bselect=\"/,""),y=y.replace(/".*$/,""),y&&(S=Spry.Data.getDataSetByName(y),S||(Spry.Debug.reportError("Failed to retrieve data set ("+y+") for "+f+"\n"),y="")));var g=null;-1!=s[0].search(/^.*\btest=\"/)&&(g=s[0].replace(/^.*\btest=\"/,""),g=g.replace(/".*$/,""),g=Spry.Utils.decodeEntities(g));var D=null;-1!=s[0].search(/^.*\bname=\"/)&&(D=s[0].replace(/^.*\bname=\"/,""),D=D.replace(/".*$/,""),D=Spry.Utils.decodeEntities(D));var v=new Spry.Data.Region.Token.PIData(f,y,g,D);o=new Spry.Data.Region.Token(Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN,S,v,new String(s[0])),r[r.length-1].addChild(o),r.push(o)}}i=n.lastIndex}return e},Spry.Data.Region.prototype.callScriptFunction=function(t,e){var r=void 0;t=t.replace(/^\s*\{?\s*function::\s*|\s*\}?\s*$/g,"");var a=Spry.Utils.getObjectByName(t);return a&&(r=a(this.name,function(){return e.getValueFromDataSet.apply(e,arguments)})),r},Spry.Data.Region.prototype.evaluateExpression=function(t,e){var r=void 0;try{r=-1!=t.search(/^\s*function::/)?this.callScriptFunction(t,e):Spry.Utils.eval(Spry.Data.Region.processDataRefString(e,t,null,!0))}catch(a){Spry.Debug.trace("Caught exception in Spry.Data.Region.prototype.evaluateExpression() while evaluating: "+Spry.Utils.encodeEntities(t)+"\n    Exception:"+a+"\n")}return r},Spry.Data.Region.prototype.processTokenChildren=function(t,e,r){for(var a=e.children,n=a.length,i=0;n>i;i++)this.processTokens(t,a[i],r)},Spry.Data.Region.prototype.processTokens=function(t,e,r){var a=0;switch(e.tokenType){case Spry.Data.Region.Token.LIST_TOKEN:this.processTokenChildren(t,e,r);break;case Spry.Data.Region.Token.STRING_TOKEN:t.push(e.data);break;case Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN:if("spry:repeat"==e.data.name){var n=null;if(n=e.dataSet?e.dataSet:this.dataSets[0]){var i=r.getDataSetContext(n);if(!i){Spry.Debug.reportError("processTokens() failed to get a data set context!\n");break}i.pushState();var s=i.getData(),o=s.length;for(a=0;o>a;a++){i.setRowIndex(a);var p=!0;e.data.jsExpr&&(p=this.evaluateExpression(e.data.jsExpr,r)),p&&this.processTokenChildren(t,e,r)}i.popState()}}else if("spry:if"==e.data.name){var p=!0;e.data.jsExpr&&(p=this.evaluateExpression(e.data.jsExpr,r)),p&&this.processTokenChildren(t,e,r)}else if("spry:choose"==e.data.name){var l=null,u=null,p=!1,h=0;for(h=0;e.children.length>h;h++){var c=e.children[h];if(c.tokenType==Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN)if("spry:when"==c.data.name){if(c.data.jsExpr&&(p=this.evaluateExpression(c.data.jsExpr,r))){u=c;break}}else"spry:default"==c.data.name&&(l=c)}!u&&l&&(u=l),u&&this.processTokenChildren(t,u,r)}else{if("spry:state"!=e.data.name)return Spry.Debug.reportError("processTokens(): Unknown processing instruction: "+e.data.name+"\n"),"";var p=!0;e.data.regionState&&e.data.regionState!=this.currentState||this.processTokenChildren(t,e,r)}break;case Spry.Data.Region.Token.VALUE_TOKEN:var n=e.dataSet,f=void 0;if(n&&"function"==n)f=this.callScriptFunction(e.data,r);else{if(!n&&this.dataSets&&this.dataSets.length>0&&this.dataSets[0]&&(n=this.dataSets[0]),!n)return Spry.Debug.reportError("processTokens(): Value reference has no data set specified: "+e.regionStr+"\n"),"";f=r.getValueFromDataSet(n,e.data)}f!==void 0&&t.push(f+"");break;default:Spry.Debug.reportError("processTokens(): Invalid token type: "+e.regionStr+"\n")}},Spry.Data.Region.prototype.transform=function(){if(this.data&&!this.tokens&&(this.tokens=this.tokenizeData(this.data)),!this.tokens)return"";if(processContext=new Spry.Data.Region.ProcessingContext(this),!processContext)return"";var t=[""];return this.processTokens(t,this.tokens,processContext),t.join("")},Spry.Data.Region.PI={},Spry.Data.Region.PI.instructions={},Spry.Data.Region.PI.buildOpenTagForValueAttr=function(t,e,r){if(!t||!e)return"";var a="";try{var n=t.attributes.getNamedItem(e);n&&n.value&&(a=Spry.Utils.encodeEntities(n.value))}catch(i){a=""}return a?"<"+Spry.Data.Region.PI.instructions[e].tagName+" "+r+'="'+a+'">':(Spry.Debug.reportError(e+" attribute requires a JavaScript expression that returns true or false!\n"),"")},Spry.Data.Region.PI.buildOpenTagForTest=function(t,e){return Spry.Data.Region.PI.buildOpenTagForValueAttr(t,e,"test")},Spry.Data.Region.PI.buildOpenTagForState=function(t,e){return Spry.Data.Region.PI.buildOpenTagForValueAttr(t,e,"name")},Spry.Data.Region.PI.buildOpenTagForRepeat=function(t,e){if(!t||!e)return"";var r="";try{var a=t.attributes.getNamedItem(e);a&&a.value&&(r=a.value,r=r.replace(/\s/g,""))}catch(n){r=""}if(!r)return Spry.Debug.reportError(e+" attribute requires a data set name!\n"),"";var i="";try{var s=t.attributes.getNamedItem("spry:test");s&&(s.value&&(i=' test="'+Spry.Utils.encodeEntities(s.value)+'"'),t.attributes.removeNamedItem(s.nodeName))}catch(n){i=""}return"<"+Spry.Data.Region.PI.instructions[e].tagName+' select="'+r+'"'+i+">"},Spry.Data.Region.PI.buildOpenTagForContent=function(t,e){if(!t||!e)return"";var r="";try{var a=t.attributes.getNamedItem(e);a&&a.value&&(r=Spry.Utils.encodeEntities(a.value))}catch(n){r=""}return r?"<"+Spry.Data.Region.PI.instructions[e].tagName+' dataref="'+r+'">':(Spry.Debug.reportError(e+" attribute requires a data reference!\n"),"")},Spry.Data.Region.PI.buildOpenTag=function(t,e){return"<"+Spry.Data.Region.PI.instructions[e].tagName+">"},Spry.Data.Region.PI.buildCloseTag=function(t,e){return"</"+Spry.Data.Region.PI.instructions[e].tagName+">"},Spry.Data.Region.PI.instructions["spry:state"]={tagName:"spry:state",childrenOnly:!1,getOpenTag:Spry.Data.Region.PI.buildOpenTagForState,getCloseTag:Spry.Data.Region.PI.buildCloseTag},Spry.Data.Region.PI.instructions["spry:if"]={tagName:"spry:if",childrenOnly:!1,getOpenTag:Spry.Data.Region.PI.buildOpenTagForTest,getCloseTag:Spry.Data.Region.PI.buildCloseTag},Spry.Data.Region.PI.instructions["spry:repeat"]={tagName:"spry:repeat",childrenOnly:!1,getOpenTag:Spry.Data.Region.PI.buildOpenTagForRepeat,getCloseTag:Spry.Data.Region.PI.buildCloseTag},Spry.Data.Region.PI.instructions["spry:repeatchildren"]={tagName:"spry:repeat",childrenOnly:!0,getOpenTag:Spry.Data.Region.PI.buildOpenTagForRepeat,getCloseTag:Spry.Data.Region.PI.buildCloseTag},Spry.Data.Region.PI.instructions["spry:choose"]={tagName:"spry:choose",childrenOnly:!0,getOpenTag:Spry.Data.Region.PI.buildOpenTag,getCloseTag:Spry.Data.Region.PI.buildCloseTag},Spry.Data.Region.PI.instructions["spry:when"]={tagName:"spry:when",childrenOnly:!1,getOpenTag:Spry.Data.Region.PI.buildOpenTagForTest,getCloseTag:Spry.Data.Region.PI.buildCloseTag},Spry.Data.Region.PI.instructions["spry:default"]={tagName:"spry:default",childrenOnly:!1,getOpenTag:Spry.Data.Region.PI.buildOpenTag,getCloseTag:Spry.Data.Region.PI.buildCloseTag},Spry.Data.Region.PI.instructions["spry:content"]={tagName:"spry:content",childrenOnly:!0,getOpenTag:Spry.Data.Region.PI.buildOpenTagForContent,getCloseTag:Spry.Data.Region.PI.buildCloseTag},Spry.Data.Region.PI.orderedInstructions=["spry:state","spry:if","spry:repeat","spry:repeatchildren","spry:choose","spry:when","spry:default","spry:content"],Spry.Data.Region.getTokensFromStr=function(t){return t?t.match(/{[^}]+}/g):null},Spry.Data.Region.processDataRefString=function(t,e,r,a){if(!e)return"";if(!t&&!r)return e;for(var n="",i=RegExp("\\{([^\\}:]+::)?[^\\}]+\\}","g"),s=0;e.length>s;){var o=i.exec(e);if(!o||!o[0])return n+=e.substr(s,e.length-s);o.index!=s&&(n+=e.substr(s,o.index-s));var p="";-1!=o[0].search(/^\{[^}:]+::/)&&(p=o[0].replace(/^\{|::.*/g,""));var l=o[0].replace(/^\{|.*::|\}/g,""),u="";if(t)u=t.getValueFromDataSet(p,l);else{var h=p?r[p]:r[0];h&&(u=h.getValue(l))}if(u!==void 0&&(u+="",n+=a?Spry.Utils.escapeQuotesAndLineBreaks(u):u),s==i.lastIndex){var c=o.index+o[0].length;e.length>c&&(n+=e.substr(c));break}s=i.lastIndex}return n},Spry.Data.Region.strToDataSetsArray=function(t,e){var r=[],a={};if(!t)return r;t=t.replace(/\s+/g," "),t=t.replace(/^\s|\s$/g,"");for(var n=t.split(/ /),i=0;n.length>i;i++)if(n[i]&&!Spry.Data.Region.PI.instructions[n[i]])try{var s=Spry.Data.getDataSetByName(n[i]);a[n[i]]||(e?r.push(n[i]):r.push(s),a[n[i]]=!0)}catch(o){}return r},Spry.Data.Region.DSContext=function(t,e){var r=t,a=[{rowIndex:-1}],n=[],i=function(){return a[a.length-1].rowIndex};this.resetAll=function(){a=[{rowIndex:r.getCurrentRow()}]},this.getDataSet=function(){return r},this.getNumRows=function(t){var e=this.getCurrentState().data;return e?e.length:r.getRowCount(t)},this.getData=function(){var t=this.getCurrentState().data;return t?t:r.getData()},this.setData=function(t){this.getCurrentState().data=t},this.getValue=function(t,e){var r="",a=this.getCurrentState(),n=a.nestedDS?a.nestedDS:this.getDataSet();return n&&(r=n.getValue(t,e)),r},this.getCurrentRow=function(){if(2>a.length||0>i())return r.getCurrentRow();var t=this.getData(),e=i();return 0>e||e>t.length?(Spry.Debug.reportError("Invalid index used in Spry.Data.Region.DSContext.getCurrentRow()!\n"),null):t[e]},this.getRowIndex=function(){var t=i();return t>=0?t:r.getRowNumber(r.getCurrentRow())},this.setRowIndex=function(t){this.getCurrentState().rowIndex=t;for(var e=this.getData(),r=n.length,a=0;r>a;a++)n[a].syncDataWithParentRow(this,t,e)},this.syncDataWithParentRow=function(t,e,a){var i=a[e];if(i&&(nestedDS=r.getNestedDataSetForParentRow(i))){var s=this.getCurrentState();s.nestedDS=nestedDS,s.data=nestedDS.getData(),s.rowIndex=nestedDS.getCurrentRowNumber(),s.rowIndex=0>s.rowIndex?0:s.rowIndex;for(var o=n.length,p=0;o>p;p++)n[p].syncDataWithParentRow(this,s.rowIndex,s.data)}},this.pushState=function(){var t=this.getCurrentState(),e={};e.rowIndex=t.rowIndex,e.data=t.data,e.nestedDS=t.nestedDS,a.push(e);for(var r=n.length,i=0;r>i;i++)n[i].pushState()},this.popState=function(){if(2>a.length)return Spry.Debug.reportError("Stack underflow in Spry.Data.Region.DSContext.popState()!\n"),void 0;for(var t=n.length,e=0;t>e;e++)n[e].popState();a.pop()},this.getCurrentState=function(){return a[a.length-1]},this.addChild=function(t){for(var e=n.length,r=0;e>r;r++)if(n[r]==t)return;n.push(t)}},Spry.Data.Region.ProcessingContext=function(t){if(this.region=t,this.dataSetContexts=[],t&&t.dataSets){for(var e=t.dataSets.slice(0),r=e.length,a=0;r>a;a++)for(var n=t.dataSets[a];n&&n.getParentDataSet;)n=n.getParentDataSet(),n&&-1==this.indexOf(e,n)&&e.push(n);for(a=0;e.length>a;a++)this.dataSetContexts.push(new Spry.Data.Region.DSContext(e[a],this));var i=this.dataSetContexts,s=i.length;for(a=0;s>a;a++){var o=i[a],n=o.getDataSet();if(n.getParentDataSet){var p=n.getParentDataSet();if(p){var l=this.getDataSetContext(p);l&&l.addChild(o)}}}}},Spry.Data.Region.ProcessingContext.prototype.indexOf=function(t,e){if(t)for(var r=t.length,a=0;r>a;a++)if(t[a]==e)return a;return-1},Spry.Data.Region.ProcessingContext.prototype.getDataSetContext=function(t){if(!t)return this.dataSetContexts.length>0?this.dataSetContexts[0]:null;if("string"==typeof t&&(t=Spry.Data.getDataSetByName(t),!t))return null;for(var e=0;this.dataSetContexts.length>e;e++){var r=this.dataSetContexts[e];if(r.getDataSet()==t)return r}return null},Spry.Data.Region.ProcessingContext.prototype.getValueFromDataSet=function(){var t="",e="";if(arguments.length>1)t=arguments[0],e=arguments[1];else{var r=arguments[0].replace(/\s*{\s*|\s*}\s*/g,"");-1!=r.search("::")?(t=r.replace(/::.*/,""),e=r.replace(/.*::/,"")):e=r}var a="",n=this.getDataSetContext(t);return n?a=n.getValue(e,n.getCurrentRow()):Spry.Debug.reportError("getValueFromDataSet: Failed to get "+t+" context for the "+this.region.regionNode.id+" region.\n"),a},Spry.Data.Region.ProcessingContext.prototype.$v=Spry.Data.Region.ProcessingContext.prototype.getValueFromDataSet,Spry.Data.Region.ProcessingContext.prototype.getCurrentRowForDataSet=function(t){var e=this.getDataSetContext(t);return e?e.getCurrentRow():null},Spry.Data.Region.Token=function(t,e,r,a){this.tokenType=t,this.dataSet=e,this.data=r,this.regionStr=a,this.parent=null,this.children=null},Spry.Data.Region.Token.prototype.addChild=function(t){t&&(this.children||(this.children=[]),this.children.push(t),t.parent=this)},Spry.Data.Region.Token.LIST_TOKEN=0,Spry.Data.Region.Token.STRING_TOKEN=1,Spry.Data.Region.Token.PROCESSING_INSTRUCTION_TOKEN=2,Spry.Data.Region.Token.VALUE_TOKEN=3,Spry.Data.Region.Token.PIData=function(t,e,r,a){this.name=t,this.data=e,this.jsExpr=r,this.regionState=a},Spry.Utils.addLoadListener(function(){setTimeout(function(){Spry.Data.initRegionsOnLoad&&Spry.Data.initRegions()},0)}),Spry.Data.DataSet.multiFilterFuncs={},Spry.Data.DataSet.multiFilterFuncs.and=function(t,e,r,a){if(a)for(var n=a.length,i=0;n>i&&(e=a[i](t,e,r),e);i++);return e},Spry.Data.DataSet.multiFilterFuncs.or=function(t,e,r,a){if(a&&a.length>0){for(var n=a.length,i=0;n>i;i++){var s=e;if(e=a[i](t,e,r))return e;e=s}return null}return e},Spry.Data.DataSet.prototype.getMultiFilterFunc=function(){var t=Spry.Data.DataSet.multiFilterFuncs[this.getFilterMode()];t||(t=Spry.Data.DataSet.multiFilterFuncs.and);var e=this.activeFilters;return function(r,a,n){return t(r,a,n,e)}},Spry.Data.DataSet.prototype.addFilter=function(t,e){this.hasFilter(t)||(this.activeFilters||(this.activeFilters=[]),this.activeFilters.push(t)),e&&this.applyFilters()},Spry.Data.DataSet.prototype.removeFilter=function(t,e){var r=this.activeFilters;if(r)for(var a=r.length,n=0;a>n;n++)if(r[n]==t)return this.activeFilters.splice(n,1),e&&this.applyFilters(),void 0},Spry.Data.DataSet.prototype.removeAllFilters=function(t){var e=this.activeFilters;e&&e.length>0&&(this.activeFilters=[],t&&this.applyFilters())},Spry.Data.DataSet.prototype.getFilters=function(){return this.activeFilters||(this.activeFilters=[]),this.activeFilters},Spry.Data.DataSet.prototype.applyFilters=function(){this.activeFilters&&this.activeFilters.length>0?this.filter(this.getMultiFilterFunc()):this.filter(null)},Spry.Data.DataSet.prototype.hasFilter=function(t){if(!this.activeFilters&&this.activeFilters>0)for(var e=this.activeFilters,r=e.length,a=0;r>a;a++)if(e[a]==t)return!0;return!1},Spry.Data.DataSet.prototype.getFilterMode=function(){return this.filterMode?this.filterMode:"and"},Spry.Data.DataSet.prototype.setFilterMode=function(t,e){var r=this.getFilterMode();return this.filterMode=t,e&&this.applyFilters(),r},Spry.Data.DataSetShell=function(t,e){this.currentDS=t,this.options=e,Spry.Data.DataSet.call(this,e),this.currentDS&&this.currentDS.addObserver(this.getObserverFunc(this.currentDS))},Spry.Data.DataSetShell.prototype=new Spry.Data.DataSet,Spry.Data.DataSetShell.prototype.constructor=Spry.Data.DataSetShell.prototype,Spry.Data.DataSetShell.prototype.getObserverFunc=function(){var t=this;return function(e,r,a){t.notifyObservers(e,a)}},Spry.Data.DataSetShell.prototype.setInternalDataSet=function(t,e){var r=this.currentDS;if(r!=t){var a=t.getDataWasLoaded();a&&this.notifyObservers("onPreLoad"),r&&r.removeObserver(this.getObserverFunc(r)),this.currentDS=t,t.addObserver(this.getObserverFunc(t)),a?(this.notifyObservers("onPostLoad"),this.notifyObservers("onDataChanged")):e&&t.loadData()}},Spry.Data.DataSetShell.prototype.getInternalDataSet=function(){return this.currentDS},Spry.Data.DataSetShell.prototype.getNestedDataSetForParentRow=function(){return this.currentDS?this.currentDS.getNestedDataSetForParentRow():null},Spry.Data.DataSetShell.prototype.getParentDataSet=function(){return this.currentDS&&this.currentDS.getParentDataSet?this.currentDS.getParentDataSet():null},Spry.Data.DataSetShell.prototype.loadData=function(){this.currentDS&&!this.currentDS.getLoadDataRequestIsPending()&&this.currentDS.loadData()},Spry.Data.DataSetShell.prototype.getData=function(t){return this.currentDS?this.currentDS.getData(t):[]},Spry.Data.DataSetShell.prototype.getLoadDataRequestIsPending=function(){return this.currentDS?this.currentDS.getLoadDataRequestIsPending():!1},Spry.Data.DataSetShell.prototype.getDataWasLoaded=function(){return this.currentDS?this.currentDS.getDataWasLoaded():!1},Spry.Data.DataSetShell.prototype.setDataFromArray=function(t,e){this.currentDS&&this.currentDS.setDataFromArray(t,e)},Spry.Data.DataSetShell.prototype.cancelLoadData=function(){this.currentDS&&this.currentDS.cancelLoadData()},Spry.Data.DataSetShell.prototype.getRowCount=function(t){return this.currentDS?this.currentDS.getRowCount(t):0},Spry.Data.DataSetShell.prototype.getRowByID=function(t){return this.currentDS?this.currentDS.getRowByID(t):void 0},Spry.Data.DataSetShell.prototype.getRowByRowNumber=function(t,e){return this.currentDS?this.currentDS.getRowByRowNumber(t,e):null},Spry.Data.DataSetShell.prototype.getCurrentRow=function(){return this.currentDS?this.currentDS.getCurrentRow():null},Spry.Data.DataSetShell.prototype.setCurrentRow=function(t){this.currentDS&&this.currentDS.setCurrentRow(t)},Spry.Data.DataSetShell.prototype.getRowNumber=function(t){return this.currentDS?this.currentDS.getRowNumber(t):0},Spry.Data.DataSetShell.prototype.getCurrentRowNumber=function(){return this.currentDS?this.currentDS.getCurrentRowNumber():0},Spry.Data.DataSetShell.prototype.getCurrentRowID=function(){return this.currentDS?this.currentDS.getCurrentRowID():0},Spry.Data.DataSetShell.prototype.setCurrentRowNumber=function(t){this.currentDS&&this.currentDS.setCurrentRowNumber(t)},Spry.Data.DataSetShell.prototype.findRowsWithColumnValues=function(t,e,r){return this.currentDS?this.currentDS.findRowsWithColumnValues(t,e,r):e?null:[]},Spry.Data.DataSetShell.prototype.setColumnType=function(t,e){this.currentDS&&this.currentDS.setColumnType(t,e)},Spry.Data.DataSetShell.prototype.getColumnType=function(t){return this.currentDS?this.currentDS.getColumnType(t):"string"},Spry.Data.DataSetShell.prototype.distinct=function(t){this.currentDS&&this.currentDS.distinct(t)},Spry.Data.DataSetShell.prototype.getSortColumn=function(){return this.currentDS?this.currentDS.getSortColumn():""},Spry.Data.DataSetShell.prototype.getSortOrder=function(){return this.currentDS?this.currentDS.getSortOrder():""},Spry.Data.DataSetShell.prototype.sort=function(t,e){this.currentDS&&this.currentDS.sort(t,e)},Spry.Data.DataSetShell.prototype.filterData=function(t,e){this.currentDS&&this.currentDS.filterData(t,e)},Spry.Data.DataSetShell.prototype.filter=function(t,e){this.currentDS&&this.currentDS.filter(t,e)};var Spry;if(Spry||(Spry={}),Spry.BrowserSniff=function(){""+navigator.appName,""+navigator.platform;var t=""+navigator.userAgent;this.mozilla=this.ie=this.opera=this.safari=!1;var e=/Opera.([0-9\.]*)/i,r=/MSIE.([0-9\.]*)/i,a=/gecko/i,n=/(applewebkit|safari)\/([\d\.]*)/i,i=!1;if(i=t.match(e))this.opera=!0,this.version=parseFloat(i[1]);else if(i=t.match(r))this.ie=!0,this.version=parseFloat(i[1]);else if(i=t.match(n))this.safari=!0,this.version=parseFloat(i[2]);else if(t.match(a)){var s=/rv:\s*([0-9\.]+)/i;i=t.match(s),this.mozilla=!0,this.version=parseFloat(i[1])}this.windows=this.mac=this.linux=!1,this.Platform=t.match(/windows/i)?"windows":t.match(/linux/i)?"linux":t.match(/mac/i)?"mac":t.match(/unix/i)?"unix":"unknown",this[this.Platform]=!0,this.v=this.version,this.safari&&this.mac&&this.mozilla&&(this.mozilla=!1)},Spry.is=new Spry.BrowserSniff,Spry.Debugger=function(){var t=this;this.onunloaddocument=function(){var e=Spry.Debugger.Utils.removeEvListener;e(window,"beforeunload",t.unloadfunc,!1),e(window,"load",t.loadfunc,!1),e(t.jstext,"keydown",t.dkfunc,!1),e(t.jstext,"keypress",t.dkfunc,!1),e(t.closediv,"click",t.cdwfunc,!1),e(t.cleardiv,"click",t.cldwfunc,!1),e(t.maximdiv,"click",t.mdwfunc,!1),e(t.headdiv,"mousedown",t.mddwfunc,!1),e(t.headdiv,"mouseup",this.mudwfunc,!1),e(document.body,"mousemove",t.mmdwfunc,!1);for(var r in t){var a=typeof t[r];"function"!=a&&("object"==a&&t[r].innerHTML&&(t[r].innerHTML=""),t[r]=null)}},this.myerrorhandler=function(e,r,a){try{t.out('<div class="error">'+t.explode(e+" \n "+r+" on line: "+a,0)+'<br style="clear: both;" /></div>')}catch(n){alert(n.message)}return!1},window.XMLHttpRequest&&window.XMLHttpRequest.prototype&&(window.XMLHttpRequest.prototype.debugopen=window.XMLHttpRequest.prototype.open,window.XMLHttpRequest.prototype.open=function(t,e,r,a,n){var i=this;if(this.addEventListener)this.addEventListener("load",function(){Spry.Debugger.Utils.logXHRequest(i,t,e)},!1);else if(window.opera){var s=this.onreadystatechange;this.onreadystatechange=function(){"function"==typeof s&&s(),Spry.Debugger.Utils.logXHRequest(i,t,e)}}return this.debugopen(t,e,r,a,n)}),this.unloadfunc=function(){t.onunloaddocument()},this.loadfunc=function(){t.init()},Spry.Debugger.Utils.addEvListener(window,"beforeunload",this.unloadfunc,!1),Spry.Debugger.Utils.addEvListener(window,"load",this.loadfunc,!1),window.onerror=this.myerrorhandler},Spry.Debugger.prototype.init=function(){var t=document.getElementById("debugdiv");if(!t){for(var e=document.createElement("div"),r=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div"),s=document.createElement("div"),o=document.createElement("div"),p=document.createElement("div"),l=document.createElement("iframe"),u=document.getElementsByTagName("script"),h="",c=0;u.length>c;c++)if(null!=u[c].src&&""!=u[c].src&&u[c].src.match(/SpryDebug.js$/)){h=u[c].src.replace(/SpryDebug.js/,"../css/SpryDebug.css");break}if(""!=h){var f=document.createElement("link");f.setAttribute("rel","stylesheet"),f.setAttribute("type","text/css"),f.setAttribute("href",h),document.getElementsByTagName("head").item(0).appendChild(f)}s.id="textdiv",s.innerHTML="<ol><li>Click the (left) button above.</li><li>Click on the page element to introspect. The red outline shows the current selection.</li></ol>",r.id="headdiv",a.id="closediv",a.innerHTML="x",n.id="maximdiv",n.innerHTML="<div></div>",p.id="cleardiv",p.innerHTML="clear",i.id="invdiv",i.innerHTML="o",e.id="debugdiv",l.src='javascript:""',l.frameBorder="0",l.scrolling="no",l.id="debugIframe",setTimeout(function(){try{var t=0;if(document.documentElement&&document.documentElement.scrollTop)var t=parseInt(document.documentElement.scrollTop,10);else if(document.body)var t=parseInt(document.body.scrollTop,10);t+=10,!isNaN(t)&&t>10&&(e.style.top=t+"px")}catch(r){alert(r.message)}},500),o.id="consolediv",o.innerHTML='<form id="debugForm" action="#" method="get" onsubmit="return debug.jseval();"><input type="text" id="debugtext" name="debugtext" /><input type="submit" id="submitform" /><div id="debuggersuggestions"></div></form>',document.body.appendChild(e),e.appendChild(r),e.appendChild(s),e.appendChild(o),r.appendChild(a),r.appendChild(n),r.appendChild(p),r.appendChild(i),e.parentNode.appendChild(l),this.jstext=document.getElementById("debugtext"),this.jstext.setAttribute("AutoComplete","off");var d=this;this.dkfunc=function(t){return d.debuggerKey(t)},this.cdwfunc=function(t){return d.closeDebugWindow(t)},this.cldwfunc=function(t){return d.clearDebugWindow(t)},this.mdwfunc=function(t){return d.maximDebugWindow(t)},this.mddwfunc=function(t){return d.mousedownDebugWindow(t)},this.mmdwfunc=function(t){return d.mousemoveDebugWindow(t)},this.mudwfunc=function(t){return d.mouseupDebugWindow(t)},this.imdfunc=function(t){return d.introspectPage(t)};var S=Spry.Debugger.Utils.addEvListener;S(d.jstext,"keydown",this.dkfunc,!1),S(a,"click",this.cdwfunc,!1),S(p,"click",this.cldwfunc,!1),S(i,"click",this.imdfunc,!1),S(n,"click",this.mdwfunc,!1),S(r,"mousedown",this.mddwfunc,!1),S(document.body,"mousemove",this.mmdwfunc,!1),S(r,"mouseup",this.mudwfunc,!1),this.debugdiv=e,this.jshints=document.getElementById("debuggersuggestions"),this.headdiv=r,this.closediv=a,this.maximdiv=n,this.textdiv=s,this.consolediv=o,this.cleardiv=p
}this.out(),setTimeout(function(){Spry.is.ie&&7>Spry.is.version&&(l.style.height=e.offsetHeight+"px",l.style.width=e.offsetWidth+"px")},0)},Spry.Debugger.prototype.introspectPage=function(){if(this.introspRun&&1==this.introspRun)this.introspRun=!1,t.stopHi();else if(this.introspRun=!0,this.hiElTop===void 0){var t=this;Spry.Debugger.Utils.addEvListener(document,"mouseover",function(e){if(t.introspRun){e=e||event;var r;return r=Spry.is.mozilla?e.target:e.srcElement,t.hiEl&&r==t.hiEl?!0:(t.prevT&&t.prevT==e.target||(t.highlight(r,t.prevT),t.prevT=r),Spry.Debugger.Utils.stopEvent(e),!1)}},!0),Spry.Debugger.Utils.addEvListener(document,"mousedown",function(e){if(e=e||event,t.introspRun){var r;return r=Spry.is.mozilla?e.target:e.srcElement,r!=t.invdiv&&t.log(r),t.stopHi(),t.introspRun=!1,Spry.Debugger.Utils.stopEvent(e),!1}},!0)}},Spry.Debugger.prototype.highlight=function(t){if(void 0!==this.introspRun&&this.introspRun&&(this.hiElTop||(this.hiElTop=document.createElement("div"),this.hiElTop.id="highlighterTop",this.hiElRight=document.createElement("div"),this.hiElRight.id="highlighterRight",this.hiElBottom=document.createElement("div"),this.hiElBottom.id="highlighterBottom",this.hiElLeft=document.createElement("div"),this.hiElLeft.id="highlighterLeft",document.body.appendChild(this.hiElTop),document.body.appendChild(this.hiElBottom),document.body.appendChild(this.hiElLeft),document.body.appendChild(this.hiElRight)),t!=this.hiElTop&&t!=this.hiElLeft&&t!=this.hiElBottom&&t!=this.hiElRight))try{var e=Spry.Debugger.Utils.getBorderBox(t);this.hiElBottom.style.width=this.hiElTop.style.width=e.width+"px",this.hiElRight.style.height=this.hiElLeft.style.height=e.height+"px",this.hiElRight.style.top=this.hiElLeft.style.top=this.hiElTop.style.top=e.y+"px",this.hiElBottom.style.left=this.hiElLeft.style.left=this.hiElTop.style.left=e.x+"px",this.hiElBottom.style.top=e.y+e.height-1+"px",this.hiElRight.style.left=e.x+e.width-1+"px"}catch(r){}},Spry.Debugger.prototype.stopHi=function(){try{this.hiElBottom.style.top=this.hiElLeft.style.top=this.hiElRight.style.top=this.hiElTop.style.top=this.hiElBottom.style.left=this.hiElLeft.style.left=this.hiElRight.style.left=this.hiElTop.style.left=this.hiElBottom.style.width=this.hiElLeft.style.width=this.hiElRight.style.width=this.hiElTop.style.width=this.hiElBottom.style.height=this.hiElLeft.style.height=this.hiElRight.style.height=this.hiElTop.style.height="0px"}catch(t){}},Spry.Debugger.prototype.debuggerKey=function(e){if(e=e||event,e&&e.keyCode)switch(e.keyCode){case 9:var l=[],b=this.jstext.value.replace(/.*\(/,""),a=b.replace(/\.?[^.]*$/,"");""==a&&(a="window"),a="var c = "+a;try{eval(a)}catch(e){}if("undefined"!=typeof c&&c){inner="",debug.out();for(var k in c)if(0==k.toLowerCase().indexOf(b.toLowerCase().replace(/.*\./,""))){if(k.toUpperCase()==k)continue;try{"domConfig"!=k&&"function"==typeof c[k]&&(k+="(")}catch(e){this.myerrorhandler("debug.debuggerKey: "+k+"()"+e.message,"debug.js",152)}l[l.length]=k}for(var j=0;l.length>j;j++)inner+="<div onmouseover=\"this.style.backgroundColor='#CCCCCC'\" onmouseout=\"this.style.backgroundColor=''\" onclick=\"debug.jstext.value = debug.jstext.value.replace(/.[^.]*$/, '.') + '"+l[j]+"'; debug.jshints.style.display = 'none'\" class=\"debuggersuggest\">"+l[j]+"</div>";0!=inner.length&&(this.jshints.innerHTML=inner,this.jshints.style.display="block")}return this.jstext.focus(),Spry.Debugger.Utils.stopEvent(e),!1;case 40:case 38:if("block"!=this.jshints.style.display)return Spry.Debugger.Utils.stopEvent(e),!1;var ch=this.jshints.getElementsByTagName("div"),prev=-1;ch&&ch.length&&(prev=ch.length);for(var next=!1,found=!1,k=0;ch.length>k;k++){if(next){ch[k].style.backgroundColor="#CCCCCC",this.debuggerScroll(ch[k]);break}if("#CCCCCC"==ch[k].style.backgroundColor.toUpperCase()||"rgb(204, 204, 204)"==ch[k].style.backgroundColor){if(ch[k].style.backgroundColor="",found=!0,40==e.keyCode){next=!0;continue}ch[prev].style.backgroundColor="#CCCCCC",this.debuggerScroll(ch[prev]);break}prev=k}return(!found||next&&k==ch.length)&&(ch[0].style.backgroundColor="#CCCCCC",this.debuggerScroll(ch[0])),Spry.Debugger.Utils.stopEvent(e),!1;case 13:if("block"!=this.jshints.style.display)return!0;for(var ch=this.jshints.getElementsByTagName("div"),k=0;ch.length>k;k++)if("#CCCCCC"==ch[k].style.backgroundColor.toUpperCase()||"rgb(204, 204, 204)"==ch[k].style.backgroundColor)return this.jstext.value=this.jstext.value.replace(/\.[^.]*$/,".")+ch[k].innerHTML,this.jshints.style.display="none",Spry.Debugger.Utils.stopEvent(e),!1;return Spry.Debugger.Utils.stopEvent(e),!1;default:this.jshints.style.display="none"}},Spry.Debugger.prototype.debuggerScroll=function(t){var e=this.jshints,r=100;t.offsetTop<e.scrollTop?e.scrollTop=t.offsetTop:t.offsetTop+t.offsetHeight>e.scrollTop+r&&(e.scrollTop=t.offsetTop+t.offsetHeight-r+5,0>e.scrollTop&&(e.scrollTop=0))},Spry.Debugger.prototype.jseval=function(){this.history||(this.history=[]);try{var val=this.jstext.value;this.history[this.history.length]=val,val="var tmp = "+val+'; if (tmp){ var asd = false; try{debug.log("<div><span class=\\"commandExecResultsLabel\\">Command Execution Result</span>:" + debug.explode(tmp, 0) + "</div>")}catch(asd){}}';var bug=!1;try{eval(val)}catch(bug){alert(bug.message)}bug&&bug.message&&eval(this.jstext.value)}catch(e){this.myerrorhandler(e.message," debug.console ",255)}return this.jstext.value="",!1},Spry.Debugger.prototype.dumpObjectEl=function(t,e,r){if("domConfig"!=e){var a="";try{var n=typeof t[e];if("unknown"==n)return'<div class="varlabel">'+e+'</div><div class="varvalue">value unknown</div>';if("function"!=n&&("number"==typeof e||e.toUpperCase()!=e)){if(a+='<div class="varlabel',"object"==n&&null!=t[e]&&1>r&&(a+=" objectlabel"),a+='">'+e+'</div><div class="varvalue">',"object"==n&&null!=t[e]&&1>r&&(a+='<a href="#" onclick="Spry.Debugger.Utils.makeVisible(this); return false;">'),"undefined"==n)a+="undefined";else if(null==t[e])a+="null";else if("string"==n)if(""==t[e])a+='""';else if(t[e].match(/^#[0-9a-z]{3,6}$/)||0==t[e].indexOf("rgb(")){var i=t[e];0==t[e].indexOf("rgb(")&&(i="#"+parseInt(t[e].substr(t[e].indexOf("(")+1,t[e].indexOf(",")-t[e].indexOf("(")-1),10).toString(16)+parseInt(t[e].substr(t[e].indexOf(",")+1,t[e].lastIndexOf(",")-t[e].indexOf(",")-1),10).toString(16)+parseInt(t[e].substr(t[e].lastIndexOf(",")+1,t[e].indexOf(")")-t[e].lastIndexOf(",")-1),10).toString(16)),a+='<span style="color:'+i+'">'+t[e]+"</span>"}else a+=t[e].replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br />");else try{a+=t[e]}catch(t){a+="[object ?!]"}if("object"==n&&null!=t[e]&&1>r){a+="</a>";try{a+=this.explode(t[e],r+1)}catch(s){}}a+="</div>"}}catch(o){}return a}},Spry.Debugger.prototype.explode=function(t,e){try{var r="",a="";switch(e===void 0&&(e=0),r+='<div class="dumptable'+(e>0?" hidedump":"")+'">',typeof t){case"object":if(t.length===void 0||t.length>0&&t.push===void 0){for(var n in t)if("domConfig"!=n&&"function"!=typeof t[n]){r+=this.dumpObjectEl(t,n,e);try{if("style"==n&&0==e){var i="";document.defaultView&&document.defaultView.getComputedStyle?i=document.defaultView.getComputedStyle(t,null):t.currentStyle&&(i=t.currentStyle),r+='<div class="varlabel computed">[Computed Style]:</div><div class="varvalue">[<a href="#" onclick="Spry.Debugger.Utils.makeVisible(this); return false;">STYLE</a>]',r+=this.explode(i,1),r+="</div>"}}catch(s){alert(s.message)}}else a+=", "+n+"()";a.length>0&&(a=a.substring(2),r+='<div class="varlabel">FUNCTIONS:</div>',r+='<div class="varvalue" colspan="2">'+a+"</div>")}else if(0==t.length)r+='<div class="specialvaluedump" colspan="2">Empty Array</div>';else{r+='<div class="varlabel">Length</div><div class="varvalue">'+t.length+"</div>";for(var n=0;t.length>n;n++)r+=this.dumpObjectEl(t,n,e)}break;case"string":var o=t.length,p=t;if(t.indexOf("<")){var p=t.replace(/</gi,"&lt;").replace(/>/gi,"&gt;");p="<pre>"+p+"</pre>"}r+='<div class="varlabel">string('+o+'):</div><div class="varvalue"> '+p+"</div>";break;case"function":try{var l=""+t;r+='<div class="varlabel">function()</div><div class="varvalue"><pre> '+l.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"</pre></div>"}catch(t){this.log(t.message)}break;case"undefined":r+='<div class="specialvaluedump" colspan=2><i>undefined</i></div>';break;case"number":var u=parseInt(t,10)==t?"Integer:":parseFloat(t)==t?"Float:":"Number:";r+='<div class="varlabel">'+u+'</div><div class="varvalue">'+t+"</div>";break;case"boolean":r+='<div class="varlabel">Boolean:</div><div class="varvalue">'+t+"</div>"}return r+='<br class="clear" /></div>'}catch(t){this.out("Spry.Debugger.explode error: "+t.message)}},Spry.Debugger.prototype.log=function(){var t=arguments,e=this;setTimeout(function(){var r="";if(t.length>0)for(var a=0;t.length>a;a++)r+=e.explode(t[a],0);e.out(r)},10)},Spry.Debugger.prototype.out=function(t){"undefined"==typeof buffer&&(buffer="");var e=this.textdiv,r=this;e?(e.innerHTML||(e.innerHTML=""),setTimeout(function(){if(buffer.length>0&&(e.innerHTML+=buffer,buffer=""),"string"==typeof t){var a=r.textdiv.scrollHeight;e.innerHTML+=t+'<br class="clear" />',r.textdiv.scrollTop=a}},0)):(setTimeout(function(){r.out()},400),"string"==typeof t&&(buffer+=t+'<br class="clear" />'))},Spry.Debugger.prototype.closeDebugWindow=function(){var t=this.debugdiv;return"none"==this.textdiv.style.display?(this.textdiv.style.display="",t.style.height="500px"):(this.textdiv.style.display="none",t.style.height="14px"),!0},Spry.Debugger.prototype.clearDebugWindow=function(){return this.textdiv.innerHTML="",!0},Spry.Debugger.prototype.maximDebugWindow=function(){var t=this.debugdiv;this.textdiv&&(this.textdiv.style.display="block"),t.className||(t.className=""),-1==t.className.indexOf("maximized")?(this.left=t.style.left,t.className+="maximized",t.style.left="0",document.documentElement&&(t.style.height=document.documentElement.clientHeight,t.style.width=document.documentElement.clientWidth)):(t.className=t.className.replace(/maximized/i,""),t.style.left=this.left,t.style.height="",t.style.width="");var e=document.getElementById("debugIframe");return e&&(e.style.top=t.style.top,e.style.left=t.style.left,e.style.height=t.offsetHeight,e.style.width=t.offsetWidth),!0},Spry.Debugger.prototype.mousedownDebugWindow=function(t){t=t||event;var e=this.debugdiv;return this.startDrag||(this.startDrag=!0,initialX=t.screenX,initialY=t.screenY,topX=e.offsetLeft,topY=e.offsetTop),!1},Spry.Debugger.prototype.mouseupDebugWindow=function(){return this.startDrag&&(Spry.is.ie?this.debugdiv.style.filter="alpha(opacity=100)":this.debugdiv.style.opacity=1,this.startDrag=!1),!1},Spry.Debugger.prototype.mousemoveDebugWindow=function(t){if(t=t||event,this.startDrag){Spry.is.ie?this.debugdiv.style.filter="alpha(opacity=60)":this.debugdiv.style.opacity=.6;var e=t.screenX-initialX,r=t.screenY-initialY;this.debugdiv.style.left=topX+e+"px",this.debugdiv.style.top=topY+r+"px";var a=document.getElementById("debugIframe");a&&(a.style.top=this.debugdiv.style.top,a.style.left=this.debugdiv.style.left)}return!1},Spry.Debugger.Utils||(Spry.Debugger.Utils={}),Spry.Debugger.Utils.camelize=function(t){if(-1==t.indexOf("-"))return t;for(var e=t.split("-"),r=!0,a="",n=0;e.length>n;n++)if(e[n].length>0)if(r)a=e[n],r=!1;else{var i=e[n];a+=i.charAt(0).toUpperCase()+i.substring(1)}return a},Spry.Debugger.Utils.getStyleProp=function(t,e){var r;try{if(t.style&&(r=t.style[Spry.Debugger.Utils.camelize(e)]),!r)if(document.defaultView&&document.defaultView.getComputedStyle){var a=document.defaultView.getComputedStyle(t,null);r=a?a.getPropertyValue(e):null}else t.currentStyle&&(r=t.currentStyle[Spry.Debugger.Utils.camelize(e)])}catch(n){}return"auto"==r?null:r},Spry.Debugger.Utils.getIntProp=function(t,e){var r=parseInt(Spry.Debugger.Utils.getStyleProp(t,e),10);return isNaN(r)?0:r},Spry.Debugger.Utils.getBorderBox=function(t,e){if(e=e||document,"string"==typeof t&&(t=e.getElementById(t)),!t)return!1;if(null===t.parentNode||"none"==Spry.Debugger.Utils.getStyleProp(t,"display"))return!1;var r,a={x:0,y:0,width:0,height:0},n=null;if(t.getBoundingClientRect){r=t.getBoundingClientRect();var i=e.documentElement.scrollTop||e.body.scrollTop,s=e.documentElement.scrollLeft||e.body.scrollLeft;a.x=r.left+s,a.y=r.top+i,a.width=r.right-r.left,a.height=r.bottom-r.top}else if(e.getBoxObjectFor){r=e.getBoxObjectFor(t),a.x=r.x,a.y=r.y,a.width=r.width,a.height=r.height;var o=Spry.Debugger.Utils.getIntProp(t,"border-top-width"),p=Spry.Debugger.Utils.getIntProp(t,"border-left-width");a.x-=p,a.y-=o}else{if(a.x=t.offsetLeft,a.y=t.offsetTop,a.width=t.offsetWidth,a.height=t.offsetHeight,n=t.offsetParent,n!=t)for(;n;)a.x+=n.offsetLeft,a.y+=n.offsetTop,n=n.offsetParent;var p=Spry.Debugger.Utils.getIntProp(t,"border-left-width"),o=Spry.Debugger.Utils.getIntProp(t,"border-top-width");a.x-=p,a.y-=o,(Spry.is.opera||Spry.is.safari&&"absolute"==Spry.Debugger.Utils.getStyleProp(t,"position"))&&(a.y-=e.body.offsetTop)}if(n=t.parentNode?t.parentNode:null,n.nodeName)for(var l=n.nodeName.toUpperCase();n&&"BODY"!=l&&"HTML"!=l;)l=n.nodeName.toUpperCase(),a.x-=n.scrollLeft,a.y-=n.scrollTop,n=n.parentNode?n.parentNode:null;var u=Spry.Debugger.Utils.getIntProp,o=u(t,"margin-top"),p=u(t,"margin-left"),h=u(t,"margin-bottom"),c=u(t,"margin-right");return a.x-=p,a.y-=o,a.height+=o+h,a.width+=p+c,a},Spry.Debugger.Utils.removeEvListener=function(t,e,r,a){try{t.removeEventListener?t.removeEventListener(e,r,a):t.detachEvent&&t.detachEvent("on"+e,r,a)}catch(n){}},Spry.Debugger.Utils.addEvListener=function(t,e,r,a){try{t.addEventListener?t.addEventListener(e,r,a):t.attachEvent&&t.attachEvent("on"+e,r)}catch(n){}},Spry.Debugger.Utils.stopEvent=function(t){try{t&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,t.preventDefault?t.preventDefault():t.returnValue=!1)}catch(t){}},Spry.Debugger.Utils.logXHRequest=function(t,e,r){if(4==t.readyState){var a=(new Date).getTime()+""+Math.random(),n=(new Date).getTime()+""+Math.random(),i='<div class="urldump">'+e+" "+r+' <a href="#" onclick="Spry.Debugger.Utils.makeVisible(\''+a+"', false); Spry.Debugger.Utils.makeVisible('"+n+'\'); return false;">Content</a> | <a href="#" onclick="Spry.Debugger.Utils.makeVisible(\''+n+"', false); Spry.Debugger.Utils.makeVisible('"+a+"'); return false;\"> Headers</a>";i+='<div><div class="contenturldump hidedump" id="'+n+'"><pre>'+t.responseText.replace(/</g,"&lt;")+"</pre></div></div>";var s=t.getAllResponseHeaders();i+='<div><div class="contenturldump hidedump" id="'+a+'"><pre>'+s+"</pre></div></div>",debug.out(i)}},Spry.Debugger.Utils.makeVisible=function(t,e){if(t=Spry.Debugger.Utils.getElement(t),e!==void 0)return t.style.display="block"==e?"block":"none",void 0;if(t.parentNode){for(var r=t.parentNode.getElementsByTagName("div"),a=!1,n=0;r.length>n;n++)if(r[n].className.match(/hidedump/)){a=r[n];break}if(a){var i=a.style.display||Spry.Debugger.Utils.getStyleProp(a,"display");a.style.display=i&&"block"==i?"none":"block"}}},Spry.Debugger.Utils.getElement=function(t){return"string"==typeof t?document.getElementById(t):t},debug===void 0||debug.toString===void 0){var debug=new Spry.Debugger;if(console===void 0)var console=debug}var Spry;Spry||(Spry={}),Spry.forwards=1,Spry.backwards=2,Spry.Effect||(Spry.Effect={}),Spry.Effect.Transitions={linearTransition:function(t,e,r,a){return t>a?r+e:e+t/a*r},sinusoidalTransition:function(t,e,r,a){return t>a?r+e:e+(-Math.cos(t/a*Math.PI)/2+.5)*r},squareTransition:function(t,e,r,a){return t>a?r+e:e+Math.pow(t/a,2)*r},squarerootTransition:function(t,e,r,a){return t>a?r+e:e+Math.sqrt(t/a)*r},fifthTransition:function(t,e,r,a){return t>a?r+e:e+Math.sqrt(-Math.cos(t/a*Math.PI)/2+.5)*r},circleTransition:function(t,e,r,a){if(t>a)return r+e;var n=t/a;return e+Math.sqrt(1-Math.pow(n-1,2))*r},pulsateTransition:function(t,e,r,a){return t>a?r+e:e+(.5+Math.sin(17*t/a)/2)*r},growSpecificTransition:function(t,e,r,a){if(t>a)return r+e;var n=t/a;return e+(5*Math.pow(n,3)-6.4*Math.pow(n,2)+2*n)*r}};for(var trans in Spry.Effect.Transitions)Spry[trans]=Spry.Effect.Transitions[trans];Spry.Effect.Registry=function(){this.effects=[]},Spry.Effect.Registry.prototype.getRegisteredEffect=function(t,e){var r={};r.element=Spry.Effect.getElement(t),r.options=e;for(var a=0;this.effects.length>a;a++)if(this.effectsAreTheSame(this.effects[a],r))return this.effects[a].effect;return!1},Spry.Effect.Registry.prototype.addEffect=function(t,e,r){if(!this.getRegisteredEffect(e,r)){var a=this.effects.length;this.effects[a]={};var n=this.effects[a];n.effect=t,n.element=Spry.Effect.getElement(e),n.options=r}},Spry.Effect.Registry.prototype.effectsAreTheSame=function(t,e){if(t.element!=e.element)return!1;var r=Spry.Effect.Utils.optionsAreIdentical(t.options,e.options);return r&&("function"==typeof e.options.setup&&(t.options.setup=e.options.setup),"function"==typeof e.options.finish&&(t.options.finish=e.options.finish)),r};var SpryRegistry=new Spry.Effect.Registry;Spry.Effect.Utils||(Spry.Effect.Utils={}),Spry.Effect.Utils.showError=function(t){alert("Spry.Effect ERR: "+t)},Spry.Effect.Utils.showInitError=function(t){return Spry.Effect.Utils.showError("The "+t+" class can't be accessed as a static function anymore. "+"\n"+"Please read Spry Effects migration documentation."),!1},Spry.Effect.Utils.Position=function(){this.x=0,this.y=0,this.units="px"},Spry.Effect.Utils.Rectangle=function(){this.width=0,this.height=0,this.units="px"},Spry.Effect.Utils.intToHex=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},Spry.Effect.Utils.hexToInt=function(t){return parseInt(t,16)},Spry.Effect.Utils.rgb=function(t,e,r){var a=Spry.Effect.Utils.intToHex,n=a(t),i=a(e),s=a(r);return compositeColorHex=n.concat(i,s).toUpperCase(),compositeColorHex="#"+compositeColorHex},Spry.Effect.Utils.longColorVersion=function(t){if(t.match(/^#[0-9a-f]{3}$/i))for(var e=t.split(""),t="#",r=1;e.length>r;r++)t+=e[r]+""+e[r];return t},Spry.Effect.Utils.camelize=function(t){if(-1==t.indexOf("-"))return t;for(var e=t.split("-"),r=!0,a="",n=0;e.length>n;n++)if(e[n].length>0)if(r)a=e[n],r=!1;else{var i=e[n];a+=i.charAt(0).toUpperCase()+i.substring(1)}return a},Spry.Effect.Utils.isPercentValue=function(t){var e=!1;return"string"==typeof t&&t.length>0&&t.lastIndexOf("%")>0&&(e=!0),e},Spry.Effect.Utils.getPercentValue=function(t){var e=0;try{e=Number(t.substring(0,t.lastIndexOf("%")))}catch(r){Spry.Effect.Utils.showError("Spry.Effect.Utils.getPercentValue: "+r)}return e},Spry.Effect.Utils.getPixelValue=function(t){var e=0;if("number"==typeof t)return t;var r=t.lastIndexOf("px");-1==r&&(r=t.length);try{e=parseInt(t.substring(0,r),10)}catch(a){}return e},Spry.Effect.Utils.getFirstChildElement=function(t){if(t)for(var e=t.firstChild;e;){if(1==e.nodeType)return e;e=e.nextSibling}return null},Spry.Effect.Utils.fetchChildImages=function(t,e){if(t&&1==t.nodeType&&e&&t.hasChildNodes())for(var r=t.getElementsByTagName("img"),a=r.length,n=0;a>n;n++){var i=r[n],s=Spry.Effect.getDimensions(i);e.push([i,s.width,s.height])}},Spry.Effect.Utils.optionsAreIdentical=function(t,e){if(null==t&&null==e)return!0;if(null!=t&&null!=e){var r=0,a=0;for(var n in t)r++;for(var i in e)a++;if(r!=a)return!1;for(var s in t){var o=typeof t[s],p=typeof e[s];if(o!=p||"undefined"!=o&&t[s]!=e[s])return!1}return!0}return!1},Spry.Effect.Utils.DoEffect=function(t,e,r){if(!r)var r={};r.name=t;var a=SpryRegistry.getRegisteredEffect(e,r);return a||(a=new Spry.Effect[t](e,r),SpryRegistry.addEffect(a,e,r)),a.start(),!0},Spry.Utils||(Spry.Utils={}),Spry.Utils.Notifier=function(){this.observers=[],this.suppressNotifications=0},Spry.Utils.Notifier.prototype.addObserver=function(t){if(t){for(var e=this.observers.length,r=0;e>r;r++)if(this.observers[r]==t)return;this.observers[e]=t}},Spry.Utils.Notifier.prototype.removeObserver=function(t){if(t)for(var e=0;this.observers.length>e;e++)if(this.observers[e]==t){this.observers.splice(e,1);break}},Spry.Utils.Notifier.prototype.notifyObservers=function(t,e){if(t&&!this.suppressNotifications)for(var r=this.observers.length,a=0;r>a;a++){var n=this.observers[a];n&&("function"==typeof n?n(t,this,e):n[t]&&n[t](this,e))}},Spry.Utils.Notifier.prototype.enableNotifications=function(){0>--this.suppressNotifications&&(this.suppressNotifications=0,Spry.Effect.Utils.showError("Unbalanced enableNotifications() call!\n"))},Spry.Utils.Notifier.prototype.disableNotifications=function(){++this.suppressNotifications},Spry.Effect.getElement=function(t){var e=t;return"string"==typeof t&&(e=document.getElementById(t)),null==e&&Spry.Effect.Utils.showError('Element "'+t+'" not found.'),e},Spry.Effect.getStyleProp=function(t,e){var r,a=Spry.Effect.Utils.camelize(e);try{if(t.style&&(r=t.style[a]),!r)if(document.defaultView&&document.defaultView.getComputedStyle){var n=document.defaultView.getComputedStyle(t,null);r=n?n.getPropertyValue(e):null}else t.currentStyle&&(r=t.currentStyle[a])}catch(i){Spry.Effect.Utils.showError("Spry.Effect.getStyleProp: "+i)}return"auto"==r?null:r},Spry.Effect.setStyleProp=function(t,e,r){try{t.style[Spry.Effect.Utils.camelize(e)]=r}catch(a){Spry.Effect.Utils.showError("Spry.Effect.setStyleProp: "+a)}},Spry.Effect.getStylePropRegardlessOfDisplayState=function(t,e,r){var a=r?r:t,n=Spry.Effect.getStyleProp(a,"display"),i=Spry.Effect.getStyleProp(a,"visibility");"none"==n&&(Spry.Effect.setStyleProp(a,"visibility","hidden"),Spry.Effect.setStyleProp(a,"display","block"),window.opera&&a.focus());var s=Spry.Effect.getStyleProp(t,e);return"none"==n&&(Spry.Effect.setStyleProp(a,"display","none"),Spry.Effect.setStyleProp(a,"visibility",i)),s},Spry.Effect.makePositioned=function(t){var e=Spry.Effect.getStyleProp(t,"position");e&&"static"!=e||(t.style.position="relative",window.opera&&(t.style.top=0,t.style.left=0))},Spry.Effect.isInvisible=function(t){var e=Spry.Effect.getStyleProp(t,"display");if(e&&"none"==e.toLowerCase())return!0;var r=Spry.Effect.getStyleProp(t,"visibility");return r&&"hidden"==r.toLowerCase()?!0:!1},Spry.Effect.enforceVisible=function(t){var e=Spry.Effect.getStyleProp(t,"display");e&&"none"==e.toLowerCase()&&Spry.Effect.setStyleProp(t,"display","block");var r=Spry.Effect.getStyleProp(t,"visibility");r&&"hidden"==r.toLowerCase()&&Spry.Effect.setStyleProp(t,"visibility","visible")},Spry.Effect.makeClipping=function(t){var e=Spry.Effect.getStyleProp(t,"overflow");if(!e||"hidden"!=e.toLowerCase()&&"scroll"!=e.toLowerCase()){var r=0,a=/MSIE 7.0/.test(navigator.userAgent)&&/Windows NT/.test(navigator.userAgent);a&&(r=Spry.Effect.getDimensionsRegardlessOfDisplayState(t).height),Spry.Effect.setStyleProp(t,"overflow","hidden"),a&&Spry.Effect.setStyleProp(t,"height",r+"px")}},Spry.Effect.cleanWhitespace=function(t){for(var e=t.childNodes.length,r=e-1;r>=0;r--){var a=t.childNodes[r];if(3==a.nodeType&&!/\S/.test(a.nodeValue))try{t.removeChild(a)}catch(n){Spry.Effect.Utils.showError("Spry.Effect.cleanWhitespace: "+n)}}},Spry.Effect.getComputedStyle=function(t){return/MSIE/.test(navigator.userAgent)?t.currentStyle:document.defaultView.getComputedStyle(t,null)},Spry.Effect.getDimensions=function(t){var e=new Spry.Effect.Utils.Rectangle,r=null;if(t.style.width&&/px/i.test(t.style.width))e.width=parseInt(t.style.width,10);else{r=Spry.Effect.getComputedStyle(t);var a=r&&r.width&&/px/i.test(r.width);a&&(e.width=parseInt(r.width,10)),a&&0!=e.width||(e.width=t.offsetWidth)}if(t.style.height&&/px/i.test(t.style.height))e.height=parseInt(t.style.height,10);else{r||(r=Spry.Effect.getComputedStyle(t));var a=r&&r.height&&/px/i.test(r.height);a&&(e.height=parseInt(r.height,10)),a&&0!=e.height||(e.height=t.offsetHeight)}return e},Spry.Effect.getDimensionsRegardlessOfDisplayState=function(t,e){var r=e?e:t,a=Spry.Effect.getStyleProp(r,"display"),n=Spry.Effect.getStyleProp(r,"visibility");"none"==a&&(Spry.Effect.setStyleProp(r,"visibility","hidden"),Spry.Effect.setStyleProp(r,"display","block"),window.opera&&r.focus());var i=Spry.Effect.getDimensions(t);return"none"==a&&(Spry.Effect.setStyleProp(r,"display","none"),Spry.Effect.setStyleProp(r,"visibility",n)),i},Spry.Effect.getOpacity=function(t){var e=Spry.Effect.getStyleProp(t,"opacity");return(e===void 0||null==e)&&(e=1),e},Spry.Effect.getBgColor=function(t){return Spry.Effect.getStyleProp(t,"background-color")},Spry.Effect.intPropStyle=function(t,e){var r=parseInt(Spry.Effect.getStyleProp(t,e),10);return isNaN(r)?0:r},Spry.Effect.getPosition=function(t){var e=new Spry.Effect.Utils.Position,r=null;if(t.style.left&&/px/i.test(t.style.left))e.x=parseInt(t.style.left,10);else{r=Spry.Effect.getComputedStyle(t);var a=r&&r.left&&/px/i.test(r.left);a&&(e.x=parseInt(r.left,10)),a&&0!=e.x||(e.x=t.offsetLeft)}if(t.style.top&&/px/i.test(t.style.top))e.y=parseInt(t.style.top,10);else{r||(r=Spry.Effect.getComputedStyle(t));var a=r&&r.top&&/px/i.test(r.top);a&&(e.y=parseInt(r.top,10)),a&&0!=e.y||(e.y=t.offsetTop)}return e},Spry.Effect.getOffsetPosition=Spry.Effect.getPosition,Spry.Effect.Animator=function(t){if(Spry.Utils.Notifier.call(this),this.name="Animator",this.element=null,this.startMilliseconds=0,this.repeat="none",this.isRunning=!1,this.timer=null,this.cancelRemaining=0,!t)var t={};this.direction=t.toggle?!1:Spry.forwards;var e=this;null!=t.setup&&this.addObserver({onPreEffect:function(){try{e.options.setup(e.element,e)}catch(t){Spry.Effect.Utils.showError("Spry.Effect.Animator.prototype.start: setup callback: "+t)}}}),null!=t.finish&&this.addObserver({onPostEffect:function(){try{e.options.finish(e.element,e)}catch(t){Spry.Effect.Utils.showError("Spry.Effect.Animator.prototype.stop: finish callback: "+t)}}}),this.options={duration:1e3,toggle:!1,transition:Spry.linearTransition,interval:16},this.setOptions(t),t.transition&&this.setTransition(t.transition),t.fps&&this.setFps(t.fps)},Spry.Effect.Animator.prototype=new Spry.Utils.Notifier,Spry.Effect.Animator.prototype.constructor=Spry.Utils.Animator,Spry.Effect.Animator.prototype.notStaticAnimator=!0,Spry.Effect.Animator.prototype.setOptions=function(t){if(t)for(var e in t)this.options[e]=t[e]},Spry.Effect.Animator.prototype.setTransition=function(t){if("number"==typeof t||"1"==t||"2"==t)switch(parseInt(t,10)){case 1:t=Spry.linearTransition;break;case 2:t=Spry.sinusoidalTransition;break;default:Spry.Effect.Utils.showError("unknown transition")}else"string"==typeof t&&("function"==typeof window[t]?t=window[t]:"function"==typeof Spry[t]?t=Spry[t]:Spry.Effect.Utils.showError("unknown transition"));if(this.options.transition=t,this.effectsArray!==void 0)for(var e=this.effectsArray.length,r=0;e>r;r++)this.effectsArray[r].effect.setTransition(t)},Spry.Effect.Animator.prototype.setDuration=function(t){if(this.options.duration=t,this.effectsArray!==void 0)for(var e=this.effectsArray.length,r=0;e>r;r++)this.effectsArray[r].effect.setDuration(t)},Spry.Effect.Animator.prototype.setFps=function(t){if(this.options.interval=parseInt(1e3/t,10),this.options.fps=t,this.effectsArray!==void 0)for(var e=this.effectsArray.length,r=0;e>r;r++)this.effectsArray[r].effect.setFps(t)},Spry.Effect.Animator.prototype.start=function(t){if(this.element){0==arguments.length&&(t=!1),this.isRunning&&this.cancel(),this.prepareStart();var e=new Date;if(this.startMilliseconds=e.getTime(),this.element.id&&(this.element=document.getElementById(this.element.id)),0!=this.cancelRemaining&&this.options.toggle){if(1>this.cancelRemaining&&"function"==typeof this.options.transition){var r=0,a=this.options.duration,n=0,i=1,s=0;this.cancelRemaining=Math.round(1e3*this.cancelRemaining)/1e3;for(var o=!1,p=0;!(o||s++>this.options.duration);){var l=r+(a-r)/2;p=Math.round(1e3*this.options.transition(l,1,-1,this.options.duration))/1e3,p==this.cancelRemaining&&(this.startMilliseconds-=l,o=!0),this.cancelRemaining>p?(a=l,i=p):(r=l,n=p)}}this.cancelRemaining=0}if(this.notifyObservers("onPreEffect",this),0==t){var u=this;this.timer=setInterval(function(){u.drawEffect()},this.options.interval)}this.isRunning=!0}},Spry.Effect.Animator.prototype.stopFlagReset=function(){this.timer&&(clearInterval(this.timer),this.timer=null),this.startMilliseconds=0},Spry.Effect.Animator.prototype.stop=function(){this.stopFlagReset(),this.notifyObservers("onPostEffect",this),this.isRunning=!1},Spry.Effect.Animator.prototype.cancel=function(){var t=this.getElapsedMilliseconds();this.startMilliseconds>0&&this.options.duration>t&&(this.cancelRemaining=this.options.transition(t,0,1,this.options.duration)),this.stopFlagReset(),this.notifyObservers("onCancel",this),this.isRunning=!1},Spry.Effect.Animator.prototype.drawEffect=function(){var t=!0;this.notifyObservers("onStep",this);var e=this.getElapsedMilliseconds();return"function"!=typeof this.options.transition?(Spry.Effect.Utils.showError("unknown transition"),void 0):(this.animate(),e>this.options.duration&&(t=!1,this.stop()),t)},Spry.Effect.Animator.prototype.getElapsedMilliseconds=function(){if(this.startMilliseconds>0){var t=new Date;return t.getTime()-this.startMilliseconds}return 0},Spry.Effect.Animator.prototype.doToggle=function(){return this.direction?(1==this.options.toggle&&(this.direction==Spry.forwards?(this.direction=Spry.backwards,this.notifyObservers("onToggle",this)):this.direction==Spry.backwards&&(this.direction=Spry.forwards)),void 0):(this.direction=Spry.forwards,void 0)},Spry.Effect.Animator.prototype.prepareStart=function(){this.options&&this.options.toggle&&this.doToggle()},Spry.Effect.Animator.prototype.animate=function(){},Spry.Effect.Animator.prototype.onStep=function(t){t!=this&&this.notifyObservers("onStep",this)},Spry.Effect.Move=function(t,e,r,a){this.dynamicFromPos=!1,3==arguments.length&&(a=r,r=e,e=Spry.Effect.getPosition(t),this.dynamicFromPos=!0),Spry.Effect.Animator.call(this,a),this.name="Move",this.element=Spry.Effect.getElement(t),this.element&&(e.units!=r.units&&Spry.Effect.Utils.showError("Spry.Effect.Move: Conflicting units ("+e.units+", "+r.units+")"),this.units=e.units,this.startX=Number(e.x),this.stopX=Number(r.x),this.startY=Number(e.y),this.stopY=Number(r.y))},Spry.Effect.Move.prototype=new Spry.Effect.Animator,Spry.Effect.Move.prototype.constructor=Spry.Effect.Move,Spry.Effect.Move.prototype.animate=function(){var t=0,e=0,r=Math.floor,a=this.getElapsedMilliseconds();this.direction==Spry.forwards?(t=r(this.options.transition(a,this.startX,this.stopX-this.startX,this.options.duration)),e=r(this.options.transition(a,this.startY,this.stopY-this.startY,this.options.duration))):this.direction==Spry.backwards&&(t=r(this.options.transition(a,this.stopX,this.startX-this.stopX,this.options.duration)),e=r(this.options.transition(a,this.stopY,this.startY-this.stopY,this.options.duration))),this.element.style.left=t+this.units,this.element.style.top=e+this.units},Spry.Effect.Move.prototype.prepareStart=function(){if(this.options&&this.options.toggle&&this.doToggle(),1==this.dynamicFromPos){var t=Spry.Effect.getPosition(this.element);this.startX=t.x,this.startY=t.y,this.rangeMoveX=this.startX-this.stopX,this.rangeMoveY=this.startY-this.stopY}},Spry.Effect.Size=function(t,e,r,a){if(this.dynamicFromRect=!1,3==arguments.length&&(a=r,r=e,e=Spry.Effect.getDimensionsRegardlessOfDisplayState(t),this.dynamicFromRect=!0),Spry.Effect.Animator.call(this,a),this.name="Size",this.element=Spry.Effect.getElement(t),this.element){if(t=this.element,e.units!=r.units)return Spry.Effect.Utils.showError("Spry.Effect.Size: Conflicting units ("+e.units+", "+r.units+")"),!1;this.units=e.units;var n=Spry.Effect.getDimensionsRegardlessOfDisplayState(t);if(this.originalWidth=n.width,this.originalHeight=n.height,this.startWidth=e.width,this.startHeight=e.height,this.stopWidth=r.width,this.stopHeight=r.height,this.childImages=[],this.options.useCSSBox){Spry.Effect.makePositioned(this.element);var i=Spry.Effect.intPropStyle;this.startFromBorder_top=i(t,"border-top-width"),this.startFromBorder_bottom=i(t,"border-bottom-width"),this.startFromBorder_left=i(t,"border-left-width"),this.startFromBorder_right=i(t,"border-right-width"),this.startFromPadding_top=i(t,"padding-top"),this.startFromPadding_bottom=i(t,"padding-bottom"),this.startFromPadding_left=i(t,"padding-left"),this.startFromPadding_right=i(t,"padding-right"),this.startFromMargin_top=i(t,"margin-top"),this.startFromMargin_bottom=i(t,"margin-bottom"),this.startFromMargin_right=i(t,"margin-right"),this.startFromMargin_left=i(t,"margin-left"),this.startLeft=i(t,"left"),this.startTop=i(t,"top")
}this.options.scaleContent&&Spry.Effect.Utils.fetchChildImages(t,this.childImages),this.fontFactor=1;var s=Spry.Effect.getStyleProp(this.element,"font-size");s&&/em\s*$/.test(s)&&(this.fontFactor=parseFloat(s));var o=Spry.Effect.Utils.isPercentValue;if(o(this.startWidth)){var p=Spry.Effect.Utils.getPercentValue(this.startWidth);this.startWidth=n.width*(p/100)}if(o(this.startHeight)){var l=Spry.Effect.Utils.getPercentValue(this.startHeight);this.startHeight=n.height*(l/100)}if(o(this.stopWidth)){var u=Spry.Effect.Utils.getPercentValue(this.stopWidth);this.stopWidth=n.width*(u/100)}if(o(this.stopHeight)){var h=Spry.Effect.Utils.getPercentValue(this.stopHeight);this.stopHeight=n.height*(h/100)}this.enforceVisible=Spry.Effect.isInvisible(this.element)}},Spry.Effect.Size.prototype=new Spry.Effect.Animator,Spry.Effect.Size.prototype.constructor=Spry.Effect.Size,Spry.Effect.Size.prototype.animate=function(){var t=0,e=0,r=0,a=0,n=Math.floor,i=this.getElapsedMilliseconds();this.direction==Spry.forwards?(t=n(this.options.transition(i,this.startWidth,this.stopWidth-this.startWidth,this.options.duration)),e=n(this.options.transition(i,this.startHeight,this.stopHeight-this.startHeight,this.options.duration)),a=1):this.direction==Spry.backwards&&(t=n(this.options.transition(i,this.stopWidth,this.startWidth-this.stopWidth,this.options.duration)),e=n(this.options.transition(i,this.stopHeight,this.startHeight-this.stopHeight,this.options.duration)),a=-1);var s=t/this.originalWidth;r=this.fontFactor*s;var o=this.element.style;if(0>t&&(t=0),0>e&&(e=0),o.width=t+this.units,o.height=e+this.units,this.options.useCSSBox!==void 0&&1==this.options.useCSSBox){var p=Spry.Effect.intPropStyle,l=p(this.element,"top"),u=p(this.element,"left"),h=p(this.element,"margin-top"),c=p(this.element,"margin-left"),f=s,d=e/this.originalHeight,S=n(this.startFromBorder_top*d),y=n(this.startFromBorder_bottom*d),g=n(this.startFromBorder_left*f),D=n(this.startFromBorder_right*f),v=n(this.startFromPadding_top*d),m=n(this.startFromPadding_bottom*d),E=n(this.startFromPadding_left*f),b=n(this.startFromPadding_right*f),x=n(this.startFromMargin_top*d),R=n(this.startFromMargin_bottom*d),T=n(this.startFromMargin_right*f),w=n(this.startFromMargin_left*f);o.borderTopWidth=S+this.units,o.borderBottomWidth=y+this.units,o.borderLeftWidth=g+this.units,o.borderRightWidth=D+this.units,o.paddingTop=v+this.units,o.paddingBottom=m+this.units,o.paddingLeft=E+this.units,o.paddingRight=b+this.units,o.marginTop=x+this.units,o.marginBottom=R+this.units,o.marginLeft=w+this.units,o.marginRight=T+this.units,o.left=n(u+c-w)+this.units,o.top=n(l+h-x)+this.units}if(this.options.scaleContent){for(var N=0;this.childImages.length>N;N++)this.childImages[N][0].style.width=s*this.childImages[N][1]+this.units,this.childImages[N][0].style.height=s*this.childImages[N][2]+this.units;this.element.style.fontSize=r+"em"}this.enforceVisible&&(Spry.Effect.enforceVisible(this.element),this.enforceVisible=!1)},Spry.Effect.Size.prototype.prepareStart=function(){if(this.options&&this.options.toggle&&this.doToggle(),1==this.dynamicFromRect){var t=Spry.Effect.getDimensions(this.element);this.startWidth=t.width,this.startHeight=t.height,this.widthRange=this.startWidth-this.stopWidth,this.heightRange=this.startHeight-this.stopHeight}},Spry.Effect.Opacity=function(t,e,r,a){this.dynamicStartOpacity=!1,3==arguments.length&&(a=r,r=e,e=Spry.Effect.getOpacity(t),this.dynamicStartOpacity=!0),Spry.Effect.Animator.call(this,a),this.name="Opacity",this.element=Spry.Effect.getElement(t),this.element&&(/MSIE/.test(navigator.userAgent)&&!this.element.hasLayout&&Spry.Effect.setStyleProp(this.element,"zoom","1"),this.startOpacity=e,this.stopOpacity=r,this.enforceVisible=Spry.Effect.isInvisible(this.element))},Spry.Effect.Opacity.prototype=new Spry.Effect.Animator,Spry.Effect.Opacity.prototype.constructor=Spry.Effect.Opacity,Spry.Effect.Opacity.prototype.animate=function(){var t=0,e=this.getElapsedMilliseconds();if(this.direction==Spry.forwards?t=this.options.transition(e,this.startOpacity,this.stopOpacity-this.startOpacity,this.options.duration):this.direction==Spry.backwards&&(t=this.options.transition(e,this.stopOpacity,this.startOpacity-this.stopOpacity,this.options.duration)),0>t&&(t=0),/MSIE/.test(navigator.userAgent)){var r=Spry.Effect.getStyleProp(this.element,"filter");r&&(r=r.replace(/alpha\(opacity=[0-9]{1,3}\)/g,"")),this.element.style.filter=r+"alpha(opacity="+Math.floor(100*t)+")"}else this.element.style.opacity=t;this.enforceVisible&&(Spry.Effect.enforceVisible(this.element),this.enforceVisible=!1)},Spry.Effect.Opacity.prototype.prepareStart=function(){this.options&&this.options.toggle&&this.doToggle(),1==this.dynamicStartOpacity&&(this.startOpacity=Spry.Effect.getOpacity(this.element),this.opacityRange=this.startOpacity-this.stopOpacity)},Spry.Effect.Color=function(t,e,r,a){this.dynamicStartColor=!1,3==arguments.length&&(a=r,r=e,e=Spry.Effect.getBgColor(t),this.dynamicStartColor=!0),Spry.Effect.Animator.call(this,a),this.name="Color",this.element=Spry.Effect.getElement(t),this.element&&(this.startColor=e,this.stopColor=r,this.startRedColor=Spry.Effect.Utils.hexToInt(e.substr(1,2)),this.startGreenColor=Spry.Effect.Utils.hexToInt(e.substr(3,2)),this.startBlueColor=Spry.Effect.Utils.hexToInt(e.substr(5,2)),this.stopRedColor=Spry.Effect.Utils.hexToInt(r.substr(1,2)),this.stopGreenColor=Spry.Effect.Utils.hexToInt(r.substr(3,2)),this.stopBlueColor=Spry.Effect.Utils.hexToInt(r.substr(5,2)))},Spry.Effect.Color.prototype=new Spry.Effect.Animator,Spry.Effect.Color.prototype.constructor=Spry.Effect.Color,Spry.Effect.Color.prototype.animate=function(){var t=0,e=0,r=0,a=Math.floor,n=this.getElapsedMilliseconds();this.direction==Spry.forwards?(t=a(this.options.transition(n,this.startRedColor,this.stopRedColor-this.startRedColor,this.options.duration)),e=a(this.options.transition(n,this.startGreenColor,this.stopGreenColor-this.startGreenColor,this.options.duration)),r=a(this.options.transition(n,this.startBlueColor,this.stopBlueColor-this.startBlueColor,this.options.duration))):this.direction==Spry.backwards&&(t=a(this.options.transition(n,this.stopRedColor,this.startRedColor-this.stopRedColor,this.options.duration)),e=a(this.options.transition(n,this.stopGreenColor,this.startGreenColor-this.stopGreenColor,this.options.duration)),r=a(this.options.transition(n,this.stopBlueColor,this.startBlueColor-this.stopBlueColor,this.options.duration))),this.element.style.backgroundColor=Spry.Effect.Utils.rgb(t,e,r)},Spry.Effect.Color.prototype.prepareStart=function(){this.options&&this.options.toggle&&this.doToggle(),1==this.dynamicStartColor&&(this.startColor=Spry.Effect.getBgColor(element),this.startRedColor=Spry.Effect.Utils.hexToInt(startColor.substr(1,2)),this.startGreenColor=Spry.Effect.Utils.hexToInt(startColor.substr(3,2)),this.startBlueColor=Spry.Effect.Utils.hexToInt(startColor.substr(5,2)),this.redColorRange=this.startRedColor-this.stopRedColor,this.greenColorRange=this.startGreenColor-this.stopGreenColor,this.blueColorRange=this.startBlueColor-this.stopBlueColor)},Spry.Effect.Cluster=function(t){Spry.Effect.Animator.call(this,t),this.name="Cluster",this.effectsArray=[],this.currIdx=-1;var e=function(t,e){this.effect=t,this.kind=e,this.isRunning=!1};this.ClusteredEffect=e},Spry.Effect.Cluster.prototype=new Spry.Effect.Animator,Spry.Effect.Cluster.prototype.constructor=Spry.Effect.Cluster,Spry.Effect.Cluster.prototype.setInterval=function(t){var e=this.effectsArray.length;this.options.interval=t;for(var r=0;e>r;r++)this.effectsArray[r].effect.setInterval(t)},Spry.Effect.Cluster.prototype.drawEffect=function(){var t=!0,e=!1,r=!1,a=!1;(-1==this.currIdx&&this.direction==Spry.forwards||this.currIdx==this.effectsArray.length&&this.direction==Spry.backwards)&&this.initNextEffectsRunning();for(var n=this.direction==Spry.forwards?0:this.effectsArray.length-1,i=this.direction==Spry.forwards?this.effectsArray.length:-1,s=this.direction==Spry.forwards?1:-1,o=n;o!=i;o+=s)1==this.effectsArray[o].isRunning&&(r=this.effectsArray[o].effect.drawEffect(),0==r&&o==this.currIdx&&(this.effectsArray[o].isRunning=!1,a=!0));if(1==a&&(e=this.initNextEffectsRunning()),1==e){this.stop(),t=!1;for(var o=0;this.effectsArray.length>o;o++)this.effectsArray[o].isRunning=!1;this.currIdx=this.direction==Spry.forwards?this.effectsArray.length:-1}return t},Spry.Effect.Cluster.prototype.initNextEffectsRunning=function(){var t=!1,e=this.direction==Spry.forwards?1:-1,r=this.direction==Spry.forwards?this.effectsArray.length:-1;if(this.currIdx+=e,this.currIdx>this.effectsArray.length-1&&this.direction==Spry.forwards||0>this.currIdx&&this.direction==Spry.backwards)t=!0;else for(var a=this.currIdx;a!=r&&(!(a>this.currIdx&&this.direction==Spry.forwards||this.currIdx>a&&this.direction==Spry.backwards)||"queue"!=this.effectsArray[a].kind);a+=e)this.effectsArray[a].effect.start(!0),this.effectsArray[a].isRunning=!0,this.currIdx=a;return t},Spry.Effect.Cluster.prototype.toggleCluster=function(){return this.direction?(1==this.options.toggle?this.direction==Spry.forwards?(this.direction=Spry.backwards,this.notifyObservers("onToggle",this),this.currIdx=this.effectsArray.length):this.direction==Spry.backwards&&(this.direction=Spry.forwards,this.currIdx=-1):this.direction==Spry.forwards?this.currIdx=-1:this.direction==Spry.backwards&&(this.currIdx=this.effectsArray.length),void 0):(this.direction=Spry.forwards,void 0)},Spry.Effect.Cluster.prototype.doToggle=function(){this.toggleCluster();for(var t=0;this.effectsArray.length>t;t++)this.effectsArray[t].effect.options&&null!=this.effectsArray[t].effect.options.toggle&&1==this.effectsArray[t].effect.options.toggle&&this.effectsArray[t].effect.doToggle()},Spry.Effect.Cluster.prototype.cancel=function(){for(var t=0;this.effectsArray.length>t;t++)this.effectsArray[t].effect.isRunning&&this.effectsArray[t].effect.cancel();var e=this.getElapsedMilliseconds();this.startMilliseconds>0&&this.options.duration>e&&(this.cancelRemaining=this.options.transition(e,0,1,this.options.duration)),this.stopFlagReset(),this.notifyObservers("onCancel",this),this.isRunning=!1},Spry.Effect.Cluster.prototype.addNextEffect=function(t){t.addObserver(this),this.effectsArray[this.effectsArray.length]=new this.ClusteredEffect(t,"queue"),1==this.effectsArray.length&&(this.element=t.element)},Spry.Effect.Cluster.prototype.addParallelEffect=function(t){(0==this.effectsArray.length||"parallel"!=this.effectsArray[this.effectsArray.length-1].kind)&&t.addObserver(this),this.effectsArray[this.effectsArray.length]=new this.ClusteredEffect(t,"parallel"),1==this.effectsArray.length&&(this.element=t.element)},Spry.Effect.Cluster.prototype.prepareStart=function(){this.toggleCluster()},Spry.Effect.Fade=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Fade");Spry.Effect.Cluster.call(this,e),this.name="Fade";var t=Spry.Effect.getElement(t);if(this.element=t,this.element){var r=1e3,a=0,n=100,i=!1,s=Spry.fifthTransition,o=60,p=0;p=/MSIE/.test(navigator.userAgent)?parseInt(Spry.Effect.getStylePropRegardlessOfDisplayState(this.element,"filter").replace(/alpha\(opacity=([0-9]{1,3})\)/g,"$1"),10):parseInt(100*Spry.Effect.getStylePropRegardlessOfDisplayState(this.element,"opacity"),10),isNaN(p)&&(p=100),e&&(null!=e.duration&&(r=e.duration),null!=e.from&&(a=Spry.Effect.Utils.isPercentValue(e.from)?Spry.Effect.Utils.getPercentValue(e.from)*p/100:e.from),null!=e.to&&(n=Spry.Effect.Utils.isPercentValue(e.to)?Spry.Effect.Utils.getPercentValue(e.to)*p/100:e.to),null!=e.toggle&&(i=e.toggle),null!=e.transition&&(s=e.transition),null!=e.fps?o=e.fps:this.options.transition=s),a/=100,n/=100,e={duration:r,toggle:i,transition:s,from:a,to:n,fps:o};var l=new Spry.Effect.Opacity(t,a,n,e);this.addNextEffect(l)}},Spry.Effect.Fade.prototype=new Spry.Effect.Cluster,Spry.Effect.Fade.prototype.constructor=Spry.Effect.Fade,Spry.Effect.Blind=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Blind");Spry.Effect.Cluster.call(this,e),this.name="Blind";var t=Spry.Effect.getElement(t);if(this.element=t,this.element){var r=1e3,a=!1,n=Spry.circleTransition,i=60,s=!1;Spry.Effect.makeClipping(t);var o=Spry.Effect.getDimensionsRegardlessOfDisplayState(t),p=o.height,l=0,u=e?e.from:o.height,h=e?e.to:0,c=!1;e&&(null!=e.duration&&(r=e.duration),null!=e.from&&(p=Spry.Effect.Utils.isPercentValue(e.from)?Spry.Effect.Utils.getPercentValue(e.from)*o.height/100:Spry.Effect.Utils.getPixelValue(e.from)),null!=e.to&&(l=Spry.Effect.Utils.isPercentValue(e.to)?Spry.Effect.Utils.getPercentValue(e.to)*o.height/100:Spry.Effect.Utils.getPixelValue(e.to)),null!=e.toggle&&(a=e.toggle),null!=e.transition&&(n=e.transition),null!=e.fps&&(i=e.fps),null!=e.useCSSBox&&(c=e.useCSSBox));var f=new Spry.Effect.Utils.Rectangle;f.width=o.width,f.height=p;var d=new Spry.Effect.Utils.Rectangle;d.width=o.width,d.height=l,e={duration:r,toggle:a,transition:n,scaleContent:s,useCSSBox:c,from:u,to:h,fps:i};var S=new Spry.Effect.Size(t,f,d,e);this.addNextEffect(S)}},Spry.Effect.Blind.prototype=new Spry.Effect.Cluster,Spry.Effect.Blind.prototype.constructor=Spry.Effect.Blind,Spry.Effect.Highlight=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Highlight");Spry.Effect.Cluster.call(this,e),this.name="Highlight";var r=1e3,a="#ffffff",n=!1,i=Spry.sinusoidalTransition,s=60,t=Spry.Effect.getElement(t);if(this.element=t,this.element){var o=Spry.Effect.getBgColor(t);if("transparent"==o&&(o="#ffff99"),e&&(null!=e.duration&&(r=e.duration),null!=e.from&&(o=e.from),null!=e.to&&(a=e.to),null!=e.toggle&&(n=e.toggle),null!=e.transition&&(i=e.transition),null!=e.fps&&(s=e.fps)),-1!=o.indexOf("rgb"))var o=Spry.Effect.Utils.rgb(parseInt(o.substring(o.indexOf("(")+1,o.indexOf(",")),10),parseInt(o.substring(o.indexOf(",")+1,o.lastIndexOf(",")),10),parseInt(o.substring(o.lastIndexOf(",")+1,o.indexOf(")")),10));if(-1!=a.indexOf("rgb"))var a=Spry.Effect.Utils.rgb(parseInt(a.substring(a.indexOf("(")+1,a.indexOf(",")),10),parseInt(a.substring(a.indexOf(",")+1,a.lastIndexOf(",")),10),parseInt(a.substring(a.lastIndexOf(",")+1,a.indexOf(")")),10));var o=Spry.Effect.Utils.longColorVersion(o),a=Spry.Effect.Utils.longColorVersion(a);this.restoreBackgroundImage=Spry.Effect.getStyleProp(t,"background-image"),e={duration:r,toggle:n,transition:i,fps:s};var p=new Spry.Effect.Color(t,o,a,e);this.addNextEffect(p),this.addObserver({onPreEffect:function(t){Spry.Effect.setStyleProp(t.element,"background-image","none")},onPostEffect:function(e){Spry.Effect.setStyleProp(e.element,"background-image",e.restoreBackgroundImage),e.direction==Spry.forwards&&e.options.restoreColor&&Spry.Effect.setStyleProp(t,"background-color",e.options.restoreColor)}})}},Spry.Effect.Highlight.prototype=new Spry.Effect.Cluster,Spry.Effect.Highlight.prototype.constructor=Spry.Effect.Highlight,Spry.Effect.Slide=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Slide");Spry.Effect.Cluster.call(this,e),this.name="Slide";var t=Spry.Effect.getElement(t);if(this.element=t,this.element){var r=1e3,a=!1,n=Spry.sinusoidalTransition,i=60,s=!1,o=Spry.Effect.Utils.getFirstChildElement(t),p=-1;if(/MSIE 7.0/.test(navigator.userAgent)&&/Windows NT/.test(navigator.userAgent)&&Spry.Effect.makePositioned(t),Spry.Effect.makeClipping(t),/MSIE 6.0/.test(navigator.userAgent)&&/Windows NT/.test(navigator.userAgent)){var l=Spry.Effect.getStyleProp(t,"position");!l||"static"!=l&&"fixed"!=l||(Spry.Effect.setStyleProp(t,"position","relative"),Spry.Effect.setStyleProp(t,"top",""),Spry.Effect.setStyleProp(t,"left",""))}if(o){Spry.Effect.makePositioned(o),Spry.Effect.makeClipping(o);var u=Spry.Effect.getDimensionsRegardlessOfDisplayState(o,t);Spry.Effect.setStyleProp(o,"width",u.width+"px")}var h=Spry.Effect.getDimensionsRegardlessOfDisplayState(t),c=new Spry.Effect.Utils.Rectangle,f=new Spry.Effect.Utils.Rectangle;c.width=f.width=h.width,c.height=f.height=h.height,this.options.to||(e||(e={}),e.to="0%"),e&&null!==e.horizontal&&e.horizontal===!0&&(s=!0),null!=e.duration&&(r=e.duration),null!=e.from&&(s?h.width=Spry.Effect.Utils.isPercentValue(e.from)?c.width*Spry.Effect.Utils.getPercentValue(e.from)/100:Spry.Effect.Utils.getPixelValue(e.from):h.height=Spry.Effect.Utils.isPercentValue(e.from)?c.height*Spry.Effect.Utils.getPercentValue(e.from)/100:Spry.Effect.Utils.getPixelValue(e.from)),null!=e.to&&(s?f.width=Spry.Effect.Utils.isPercentValue(e.to)?c.width*Spry.Effect.Utils.getPercentValue(e.to)/100:Spry.Effect.Utils.getPixelValue(e.to):f.height=Spry.Effect.Utils.isPercentValue(e.to)?c.height*Spry.Effect.Utils.getPercentValue(e.to)/100:Spry.Effect.Utils.getPixelValue(e.to)),null!=e.toggle&&(a=e.toggle),null!=e.transition&&(n=e.transition),null!=e.fps&&(i=e.fps),e={duration:r,transition:n,scaleContent:!1,toggle:a,fps:i};var d=new Spry.Effect.Size(t,h,f,e);this.addParallelEffect(d),(h.width<f.width&&s||h.height<f.height&&!s)&&(p=1);var S=new Spry.Effect.Utils.Position,y=new Spry.Effect.Utils.Position;if(y.x=S.x=Spry.Effect.intPropStyle(o,"left"),y.y=S.y=Spry.Effect.intPropStyle(o,"top"),y.units=S.units,s?y.x=parseInt(S.x+p*(h.width-f.width),10):y.y=parseInt(S.y+p*(h.height-f.height),10),1==p)var g=S,S=y,y=g;e={duration:r,transition:n,toggle:a,from:S,to:y,fps:i};var D=new Spry.Effect.Move(o,S,y,e);this.addParallelEffect(D)}},Spry.Effect.Slide.prototype=new Spry.Effect.Cluster,Spry.Effect.Slide.prototype.constructor=Spry.Effect.Slide,Spry.Effect.Grow=function(t,e){if(t){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Grow");Spry.Effect.Cluster.call(this,e),this.name="Grow";var r=1e3,a=!1,n=!0,i=!1,s=!0,o=!1,p=Spry.squareTransition,l=60,t=Spry.Effect.getElement(t);if(this.element=t,this.element){Spry.Effect.makeClipping(t);var u=Spry.Effect.getDimensionsRegardlessOfDisplayState(t),h=u.width,c=u.height,f=0==h?1:c/h,d=new Spry.Effect.Utils.Rectangle;d.width=0,d.height=0;var S=new Spry.Effect.Utils.Rectangle;S.width=h,S.height=c;var y=e?e.from:u.width,g=e?e.to:0,D=Spry.Effect.Utils.getPixelValue;e&&(null!=e.growCenter&&(s=e.growCenter),null!=e.duration&&(r=e.duration),null!=e.useCSSBox&&(o=e.useCSSBox),null!=e.scaleContent&&(n=e.scaleContent),null!=e.from&&(Spry.Effect.Utils.isPercentValue(e.from)?(d.width=h*(Spry.Effect.Utils.getPercentValue(e.from)/100),d.height=c*(Spry.Effect.Utils.getPercentValue(e.from)/100)):i?(d.height=D(e.from),d.width=D(e.from)/f):(d.width=D(e.from),d.height=f*D(e.from))),null!=e.to&&(Spry.Effect.Utils.isPercentValue(e.to)?(S.width=h*(Spry.Effect.Utils.getPercentValue(e.to)/100),S.height=c*(Spry.Effect.Utils.getPercentValue(e.to)/100)):i?(S.height=D(e.to),S.width=D(e.to)/f):(S.width=D(e.to),S.height=f*D(e.to))),null!=e.toggle&&(a=e.toggle),null!=e.transition&&(p=e.transition),null!=e.fps&&(l=e.fps)),e={duration:r,toggle:a,transition:p,scaleContent:n,useCSSBox:o,fps:l};var v=new Spry.Effect.Size(t,d,S,e);if(this.addParallelEffect(v),s){Spry.Effect.makePositioned(t);var m=new Spry.Effect.Utils.Position;m.x=parseInt(Spry.Effect.getStylePropRegardlessOfDisplayState(t,"left"),10),m.y=parseInt(Spry.Effect.getStylePropRegardlessOfDisplayState(t,"top"),10),m.x||(m.x=0),m.y||(m.y=0),e={duration:r,toggle:a,transition:p,from:y,to:g,fps:l};var E=new Spry.Effect.Utils.Position;E.x=m.x+(h-d.width)/2,E.y=m.y+(c-d.height)/2;var b=new Spry.Effect.Utils.Position;b.x=m.x+(h-S.width)/2,b.y=m.y+(c-S.height)/2;var x=new Spry.Effect.Move(t,E,b,e);this.addParallelEffect(x)}}}},Spry.Effect.Grow.prototype=new Spry.Effect.Cluster,Spry.Effect.Grow.prototype.constructor=Spry.Effect.Grow,Spry.Effect.Shake=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Shake");Spry.Effect.Cluster.call(this,e),this.options.direction=!1,this.options.toggle&&(this.options.toggle=!1),this.name="Shake";var t=Spry.Effect.getElement(t);if(this.element=t,this.element){var r=100,a=Spry.linearTransition,n=60,i=4;e&&(null!=e.duration&&(i=Math.ceil(this.options.duration/r)-1),null!=e.fps&&(n=e.fps),null!=e.transition&&(a=e.transition)),Spry.Effect.makePositioned(t);var s=new Spry.Effect.Utils.Position;s.x=parseInt(Spry.Effect.getStyleProp(t,"left"),10),s.y=parseInt(Spry.Effect.getStyleProp(t,"top"),10),s.x||(s.x=0),s.y||(s.y=0);var o=new Spry.Effect.Utils.Position;o.x=s.x,o.y=s.y;var p=new Spry.Effect.Utils.Position;p.x=s.x+20,p.y=s.y+0;var l=new Spry.Effect.Utils.Position;l.x=s.x+-20,l.y=s.y+0,e={duration:Math.ceil(r/2),toggle:!1,fps:n,transition:a};var u=new Spry.Effect.Move(t,o,p,e);this.addNextEffect(u),e={duration:r,toggle:!1,fps:n,transition:a};for(var h=new Spry.Effect.Move(t,p,l,e),c=new Spry.Effect.Move(t,l,p,e),f=0;i>f;f++)0==f%2?this.addNextEffect(h):this.addNextEffect(c);var d=0==i%2?p:l;e={duration:Math.ceil(r/2),toggle:!1,fps:n,transition:a};var u=new Spry.Effect.Move(t,d,o,e);this.addNextEffect(u)}},Spry.Effect.Shake.prototype=new Spry.Effect.Cluster,Spry.Effect.Shake.prototype.constructor=Spry.Effect.Shake,Spry.Effect.Shake.prototype.doToggle=function(){},Spry.Effect.Squish=function(t,e){return this.notStaticAnimator?(e||(e={}),e.to||(e.to="0%"),e.from||(e.from="100%"),e.growCenter=!1,Spry.Effect.Grow.call(this,t,e),this.name="Squish",void 0):Spry.Effect.Utils.showInitError("Squish")},Spry.Effect.Squish.prototype=new Spry.Effect.Grow,Spry.Effect.Squish.prototype.constructor=Spry.Effect.Squish,Spry.Effect.Pulsate=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Pulsate");Spry.Effect.Cluster.call(this,e),this.options.direction=!1,this.options.toggle&&(this.options.toggle=!1);var t=Spry.Effect.getElement(t),r=0;if(this.element=t,this.element){this.name="Pulsate";var a=100,n=100,i=0,s=!1,o=Spry.linearTransition,p=60;r=/MSIE/.test(navigator.userAgent)?parseInt(Spry.Effect.getStylePropRegardlessOfDisplayState(this.element,"filter").replace(/alpha\(opacity=([0-9]{1,3})\)/g,"$1"),10):parseInt(100*Spry.Effect.getStylePropRegardlessOfDisplayState(this.element,"opacity"),10),isNaN(r)&&(r=100),e&&(null!=e.from&&(n=Spry.Effect.Utils.isPercentValue(e.from)?Spry.Effect.Utils.getPercentValue(e.from)*r/100:e.from),null!=e.to&&(i=Spry.Effect.Utils.isPercentValue(e.to)?Spry.Effect.Utils.getPercentValue(e.to)*r/100:e.to),null!=e.transition&&(o=e.transition),null!=e.fps&&(p=e.fps)),e={duration:a,toggle:s,transition:o,fps:p},n/=100,i/=100;for(var l=new Spry.Effect.Opacity(t,n,i,e),u=new Spry.Effect.Opacity(t,i,n,e),h=parseInt(this.options.duration/200,10),c=0;h>c;c++)this.addNextEffect(l),this.addNextEffect(u)}},Spry.Effect.Pulsate.prototype=new Spry.Effect.Cluster,Spry.Effect.Pulsate.prototype.constructor=Spry.Effect.Pulsate,Spry.Effect.Pulsate.prototype.doToggle=function(){},Spry.Effect.Puff=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Puff");Spry.Effect.Cluster.call(this,e);var t=Spry.Effect.getElement(t);if(this.element=t,this.element){this.name="Puff";var r=!1,a=1e3,n=Spry.fifthTransition,i=60;Spry.Effect.makePositioned(t),e&&(null!=e.toggle&&(r=e.toggle),null!=e.duration&&(a=e.duration),null!=e.transition&&(n=e.transition),null!=e.fps&&(i=e.fps));var s=Spry.Effect.getDimensions(t),o=s.width,p=s.height;e={duration:a,toggle:r,transition:n,fps:i};var l=1,u=0,h=new Spry.Effect.Opacity(t,l,u,e);this.addParallelEffect(h);var c=Spry.Effect.getPosition(t),f=new Spry.Effect.Utils.Position;f.x=-1*(o/2),f.y=-1*(p/2),e={duration:a,toggle:r,transition:n,from:c,to:f,fps:i};var d=new Spry.Effect.Move(t,c,f,e);this.addParallelEffect(d);var S=this;this.addObserver({onPreEffect:function(){S.direction==Spry.backwards&&(S.element.style.display="block")},onPostEffect:function(){S.direction==Spry.forwards&&(S.element.style.display="none")}})}},Spry.Effect.Puff.prototype=new Spry.Effect.Cluster,Spry.Effect.Puff.prototype.constructor=Spry.Effect.Puff,Spry.Effect.DropOut=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("DropOut");Spry.Effect.Cluster.call(this,e);var t=Spry.Effect.getElement(t);if(this.element=t,this.element){var r=1e3,a=60,n=Spry.fifthTransition,i=Spry.forwards,s=!1;this.name="DropOut",Spry.Effect.makePositioned(t),e&&(null!=e.duration&&(r=e.duration),null!=e.toggle&&(s=e.toggle),null!=e.fps&&(a=e.fps),null!=e.transition&&(n=e.transition),null!=e.dropIn&&(i=-1));var o=new Spry.Effect.Utils.Position;o.x=parseInt(Spry.Effect.getStyleProp(t,"left"),10),o.y=parseInt(Spry.Effect.getStyleProp(t,"top"),10),o.x||(o.x=0),o.y||(o.y=0);var p=new Spry.Effect.Utils.Position;p.x=o.x+0,p.y=o.y+0;var l=new Spry.Effect.Utils.Position;l.x=o.x+0,l.y=o.y+160*i,e={from:p,to:l,duration:r,toggle:s,transition:n,fps:a};var u=new Spry.Effect.Move(t,e.from,e.to,e);this.addParallelEffect(u);var h=1,c=0;e={duration:r,toggle:s,transition:n,fps:a};var f=new Spry.Effect.Opacity(t,h,c,e);this.addParallelEffect(f);var d=this;this.addObserver({onPreEffect:function(){d.element.style.display="block"},onPostEffect:function(){d.direction==Spry.forwards&&(d.element.style.display="none")}})}},Spry.Effect.DropOut.prototype=new Spry.Effect.Cluster,Spry.Effect.DropOut.prototype.constructor=Spry.Effect.DropOut,Spry.Effect.Fold=function(t,e){if(!this.notStaticAnimator)return Spry.Effect.Utils.showInitError("Fold");Spry.Effect.Cluster.call(this,e);var t=Spry.Effect.getElement(t);if(this.element=t,this.element){this.name="Fold";var r=1e3,a=!1,n=!0,i=!1,s=Spry.fifthTransition,o=o;Spry.Effect.makeClipping(t);var p=Spry.Effect.getDimensionsRegardlessOfDisplayState(t),l=p.width,u=p.height,h=l,c=u/5,f=new Spry.Effect.Utils.Rectangle;f.width=l,f.height=u;var d=new Spry.Effect.Utils.Rectangle;d.width=h,d.height=c,e&&(null!=e.duration&&(r=Math.ceil(e.duration/2)),null!=e.toggle&&(a=e.toggle),null!=e.useCSSBox&&(i=e.useCSSBox),null!=e.fps&&(o=e.fps),null!=e.transition&&(s=e.transition)),e={duration:r,toggle:a,scaleContent:n,useCSSBox:i,transition:s,fps:o};var S=new Spry.Effect.Size(t,f,d,e);this.addNextEffect(S),f.width=d.width,f.height=d.height,d.width="0%";var S=new Spry.Effect.Size(t,f,d,e);this.addNextEffect(S)}},Spry.Effect.Fold.prototype=new Spry.Effect.Cluster,Spry.Effect.Fold.prototype.constructor=Spry.Effect.Fold,Spry.Effect.DoFade=function(t,e){return Spry.Effect.Utils.DoEffect("Fade",t,e)},Spry.Effect.DoBlind=function(t,e){return Spry.Effect.Utils.DoEffect("Blind",t,e)},Spry.Effect.DoHighlight=function(t,e){return Spry.Effect.Utils.DoEffect("Highlight",t,e)},Spry.Effect.DoSlide=function(t,e){return Spry.Effect.Utils.DoEffect("Slide",t,e)},Spry.Effect.DoGrow=function(t,e){return Spry.Effect.Utils.DoEffect("Grow",t,e)},Spry.Effect.DoShake=function(t,e){return Spry.Effect.Utils.DoEffect("Shake",t,e)},Spry.Effect.DoSquish=function(t,e){return Spry.Effect.Utils.DoEffect("Squish",t,e)},Spry.Effect.DoPulsate=function(t,e){return Spry.Effect.Utils.DoEffect("Pulsate",t,e)},Spry.Effect.DoPuff=function(t,e){return Spry.Effect.Utils.DoEffect("Puff",t,e)},Spry.Effect.DoDropOut=function(t,e){return Spry.Effect.Utils.DoEffect("DropOut",t,e)},Spry.Effect.DoFold=function(t,e){return Spry.Effect.Utils.DoEffect("Fold",t,e)},Spry.Data.HTMLDataSet=function(t,e,r){this.sourceElementID=e,this.sourceElement=null,this.sourceWasInitialized=!1,this.usesExternalFile=null!=t?!0:!1,this.firstRowAsHeaders=!0,this.useColumnsAsRows=!1,this.columnNames=null,this.hideDataSourceElement=!0,this.rowSelector=null,this.dataSelector=null,this.tableModeEnabled=!0,Spry.Data.HTTPSourceDataSet.call(this,t,r)},Spry.Data.HTMLDataSet.prototype=new Spry.Data.HTTPSourceDataSet,Spry.Data.HTMLDataSet.prototype.constructor=Spry.Data.HTMLDataSet,Spry.Data.HTMLDataSet.prototype.getDataRefStrings=function(){var t=[];return this.url&&t.push(this.url),"string"==typeof this.sourceElementID&&t.push(this.sourceElementID),t},Spry.Data.HTMLDataSet.prototype.setDisplay=function(t,e){t&&(t.style.display=e)},Spry.Data.HTMLDataSet.prototype.initDataSource=function(){this.loadDependentDataSets()&&(this.usesExternalFile||(this.setSourceElement(),this.hideDataSourceElement&&this.setDisplay(this.sourceElement,"none")))},Spry.Data.HTMLDataSet.prototype.setSourceElement=function(t){if(this.sourceElement=null,!this.sourceElementID)return t?this.sourceElement=t:(this.hideDataSourceElement=!1,this.sourceElement=document.body),void 0;var e=Spry.Data.Region.processDataRefString(null,this.sourceElementID,this.dataSetsForDataRefStrings);if(this.usesExternalFile){if(t){var r=!1,a=Spry.Utils.getNodesByFunc(t,function(t){return r?!1:1!=t.nodeType?!1:t.id&&t.id.toLowerCase()==e.toLowerCase()?(r=!0,!0):void 0});this.sourceElement=a[0]}}else this.sourceElement=Spry.$(e);this.sourceElement||Spry.Debug.reportError("Spry.Data.HTMLDataSet: '"+e+"' is not a valid element ID")},Spry.Data.HTMLDataSet.prototype.getSourceElement=function(){return this.sourceElement},Spry.Data.HTMLDataSet.prototype.getSourceElementID=function(){return this.sourceElementID},Spry.Data.HTMLDataSet.prototype.setSourceElementID=function(t){this.sourceElementID!=t&&(this.sourceElementID=t,this.recalculateDataSetDependencies(),this.dataWasLoaded=!1)},Spry.Data.HTMLDataSet.prototype.getDataSelector=function(){return this.dataSelector},Spry.Data.HTMLDataSet.prototype.setDataSelector=function(t){this.dataSelector!=t&&(this.dataSelector=t,this.dataWasLoaded=!1)},Spry.Data.HTMLDataSet.prototype.getRowSelector=function(){return this.rowSelector},Spry.Data.HTMLDataSet.prototype.setRowSelector=function(t){this.rowSelector!=t&&(this.rowSelector=t,this.dataWasLoaded=!1)},Spry.Data.HTMLDataSet.prototype.loadDataIntoDataSet=function(t){var e=t;e=Spry.Data.HTMLDataSet.cleanupSource(e);var r=document.createElement("div");if(r.id="htmlsource"+this.internalID,r.innerHTML=e,this.setSourceElement(r),this.sourceElement){var a=this.getDataFromSourceElement();a&&(this.dataHash=a.dataHash,this.data=a.data)}this.dataWasLoaded=!0,r=null},Spry.Data.HTMLDataSet.prototype.loadDependentDataSets=function(){if(this.hasDataRefStrings){for(var t=!0,e=0;this.dataSetsForDataRefStrings.length>e;e++){var r=this.dataSetsForDataRefStrings[e];r.getLoadDataRequestIsPending()?t=!1:r.getDataWasLoaded()||(r.loadData(),t=!1)}if(!t)return!1}return!0},Spry.Data.HTMLDataSet.prototype.loadData=function(){this.cancelLoadData(),this.initDataSource();var t=this;if(this.usesExternalFile){var e=Spry.Data.Region.processDataRefString(null,this.url,this.dataSetsForDataRefStrings),r=this.requestInfo.postData;r&&"string"==typeof r&&(r=Spry.Data.Region.processDataRefString(null,r,this.dataSetsForDataRefStrings)),this.notifyObservers("onPreLoad"),this.dataHash={},this.data=[],this.dataWasLoaded=!1,this.unfilteredData=null,this.curRowID=0;var a=this.requestInfo.clone();a.url=e,a.postData=r,this.pendingRequest={},this.pendingRequest.data=Spry.Data.HTTPSourceDataSet.LoadManager.loadData(a,this,this.useCache)}else this.notifyObservers("onPreLoad"),this.dataHash={},this.data=[],this.dataWasLoaded=!1,this.unfilteredData=null,this.curRowID=0,this.pendingRequest={},this.pendingRequest.timer=setTimeout(function(){t.pendingRequest=null;var e=t.getDataFromSourceElement();e&&(t.dataHash=e.dataHash,t.data=e.data),t.dataWasLoaded=!0,t.disableNotifications(),t.filterAndSortData(),t.enableNotifications(),t.notifyObservers("onPostLoad"),t.notifyObservers("onDataChanged")},0)},Spry.Data.HTMLDataSet.cleanupSource=function(t){return t=t.replace(/<(img|script|link|frame|iframe|input)([^>]+)>/gi,function(t,e,r){return"<"+e+r.replace(/\b(src|href)\s*=/gi,function(t,e){return"spry_"+e+"="})+">"})},Spry.Data.HTMLDataSet.undoCleanupSource=function(t){return t=t.replace(/<(img|script|link|frame|iframe|input)([^>]+)>/gi,function(t,e,r){return"<"+e+r.replace(/\bspry_(src|href)\s*=/gi,function(t,e){return e+"="})+">"})},Spry.Data.HTMLDataSet.normalizeColumnName=function(t){return t=t.replace(/(?:^[\s\t]+|[\s\t]+$)/gi,""),t=t.replace(/<\/?([a-z]+)([^>]+)>/gi,""),t=t.replace(/[\s\t]+/gi,"_")},Spry.Data.HTMLDataSet.prototype.getDataFromSourceElement=function(){if(!this.sourceElement)return null;var t,e=this.tableModeEnabled&&"table"==this.sourceElement.nodeName.toLowerCase();if(t=e?this.getDataFromHTMLTable():this.getDataFromNestedStructure(),!t)return null;
if(this.useColumnsAsRows){for(var r=[],a=0;t.length>a;a++)for(var n=t[a],i=0;n.length>i;i++)r[i]||(r[i]=[]),r[i][a]=n[i];t=r}var s={};if(s.dataHash={},s.data=[],0==t.length)return s;for(var o=[],p=t[0],i=0;p.length>i;i++)o[i]=e&&this.firstRowAsHeaders?Spry.Data.HTMLDataSet.normalizeColumnName(p[i]):"column"+i;if(this.columnNames&&this.columnNames.length)if(this.columnNames.length<o.length)Spry.Debug.reportError("Too few elements in the columnNames array. The columNames length must match the actual number of columns.");else for(var l=0;o.length>l;l++)this.columnNames[l]&&(o[l]=this.columnNames[l]);for(var u=0,h=e&&this.firstRowAsHeaders?1:0,a=h;t.length>a;a++){var n=t[a];if(o.length==n.length){for(var c={},i=0;n.length>i;i++)c[o[i]]=n[i];c.ds_RowID=u++,s.dataHash[c.ds_RowID]=c,s.data.push(c)}else Spry.Debug.reportError("Unbalanced column names for row #"+(a+1)+". Skipping row.")}return s},Spry.Data.HTMLDataSet.getElementChildren=function(t){for(var e=[],r=t.firstChild;r;)1==r.nodeType&&e.push(r),r=r.nextSibling;return e},Spry.Data.HTMLDataSet.prototype.getDataFromHTMLTable=function(){var t=this.sourceElement.tHead,e=this.sourceElement.tBodies[0],r=[],a=[];t&&(r=Spry.Data.HTMLDataSet.getElementChildren(t)),e&&(a=Spry.Data.HTMLDataSet.getElementChildren(e));var n=[],i=r.concat(a);this.rowSelector&&(i=Spry.Data.HTMLDataSet.applySelector(i,this.rowSelector));for(var s=0;i.length>s;s++){var o,p=i[s];o=n[s]?n[s]:[];var l=0,u=p.cells;this.dataSelector&&(u=Spry.Data.HTMLDataSet.applySelector(u,this.dataSelector));for(var h=0;u.length>h;h++){for(var c=u[h],f=h+l;o[f];)l++,f++;var d=Spry.Data.HTMLDataSet.undoCleanupSource(c.innerHTML);o[f]=d;var S=c.colSpan;0==S&&(S=1);for(var y=l,g=1;S>g;g++)l++,f=h+l,o[f]=d;var D=c.rowSpan;0==D&&(D=1);for(var v=1;D>v;v++){nextRowIndex=s+v;var m;m=n[nextRowIndex]?n[nextRowIndex]:[];for(var E=y,g=0;S>g;g++)f=h+E,m[f]=d,E++;n[nextRowIndex]=m}}n[s]=o}return n},Spry.Data.HTMLDataSet.prototype.getDataFromNestedStructure=function(){var t=[];if(this.sourceElementID&&!this.rowSelector&&!this.dataSelector)return t[0]=[Spry.Data.HTMLDataSet.undoCleanupSource(this.sourceElement.innerHTML)],t;var e=this,r=[];r=this.rowSelector?Spry.Utils.getNodesByFunc(this.sourceElement,function(t){return Spry.Data.HTMLDataSet.evalSelector(t,e.sourceElement,e.rowSelector)}):[this.sourceElement];for(var a=0;r.length>a;a++){var n=r[a],i=[];i=this.dataSelector?Spry.Utils.getNodesByFunc(n,function(t){return Spry.Data.HTMLDataSet.evalSelector(t,n,e.dataSelector)}):[n],t[a]=[];for(var s=0;i.length>s;s++)t[a][s]=Spry.Data.HTMLDataSet.undoCleanupSource(i[s].innerHTML)}return t},Spry.Data.HTMLDataSet.applySelector=function(t,e,r){for(var a=[],n=0;t.length>n;n++){var i=t[n];Spry.Data.HTMLDataSet.evalSelector(i,r?r:i.parentNode,e)&&a.push(i)}return a},Spry.Data.HTMLDataSet.evalSelector=function(t,e,r){if(1!=t.nodeType)return!1;if(t==e)return!1;for(var a=r.split(","),n=0;a.length>n;n++){var i=a[n].replace(/^\s+/,"").replace(/\s+$/,""),s=null,o=null,p=null,l=!0;if(">"==i.substring(0,1)&&(t.parentNode!=e?l=!1:i=i.substring(1).replace(/^\s+/,"")),l)if(s=i.toLowerCase(),-1!=i.indexOf(".")){var u=i.split(".");s=u[0],o=u[1]}else if(-1!=i.indexOf("#")){var u=i.split("#");s=u[0],p=u[1]}if(l&&""!=s&&"*"!=s&&t.nodeName.toLowerCase()!=s&&(l=!1),l&&p&&t.id!=p&&(l=!1),l&&o&&-1==t.className.search(RegExp("\\b"+o+"\\b","i"))&&(l=!1),l)return!0}return!1};var Spry;Spry||(Spry={}),Spry.Utils||(Spry.Utils={}),Spry.Utils.ImageLoader=function(){this.queue=[],this.timerID=0,this.currentEntry=null},Spry.Utils.ImageLoader.prototype.start=function(){if(!this.timerID){var t=this;this.timerID=setTimeout(function(){t.timerID=0,t.processQueue()},0)}},Spry.Utils.ImageLoader.prototype.stop=function(){if(this.currentEntry){var t=this.currentEntry;t.loader.onload=null,t.loader.src="",t.loader=null,this.currentEntry=null,this.queue.unshift(t)}this.timerID&&clearTimeout(this.timerID),this.timerID=0},Spry.Utils.ImageLoader.prototype.clearQueue=function(){this.stop(),this.queue.length=0},Spry.Utils.ImageLoader.prototype.load=function(t,e,r){t&&(r===void 0&&(r=0),this.queue.push({url:t,callback:e,priority:r}),this.queue.sort(function(t,e){return t.priority>e.priority?-1:t.priority<e.priority?1:0}),this.start())},Spry.Utils.ImageLoader.prototype.processQueue=function(){if(!(1>this.queue.length)){var t=this.currentEntry=this.queue.shift(),e=t.loader=new Image,r=this;e.onload=function(){r.currentEntry=null,t.callback&&t.callback(t.url,t.loader),r.queue.length>0&&r.start()},e.onerror=function(){r.currentEntry=null,r.queue.length>0&&r.start()},this.currentLoader=e,e.src=t.url}},Spry.Data.JSONDataSet=function(t,e){this.path="",this.pathIsObjectOfArrays=!1,this.doc=null,this.subPaths=[],this.useParser=!1,this.preparseFunc=null,Spry.Data.HTTPSourceDataSet.call(this,t,e);var r=typeof this.subPaths;("string"==r||"object"==r&&this.subPaths.constructor!=Array)&&(this.subPaths=[this.subPaths])},Spry.Data.JSONDataSet.prototype=new Spry.Data.HTTPSourceDataSet,Spry.Data.JSONDataSet.prototype.constructor=Spry.Data.JSONDataSet,Spry.Data.JSONDataSet.prototype.getDataRefStrings=function(){var t=[];return this.url&&t.push(this.url),this.path&&t.push(this.path),this.requestInfo&&this.requestInfo.postData&&t.push(this.requestInfo.postData),t},Spry.Data.JSONDataSet.prototype.getDocument=function(){return this.doc},Spry.Data.JSONDataSet.prototype.getPath=function(){return this.path},Spry.Data.JSONDataSet.prototype.setPath=function(t){this.path!=t&&(this.path=t,this.dataWasLoaded&&this.doc&&(this.notifyObservers("onPreLoad"),this.setDataFromDoc(this.doc)))},Spry.Data.JSONDataSet.getMatchingObjects=function(t,e){var r=[];if(t&&e){var a="",n="",i=t.search(/\./);-1!=i?(a=t.substring(0,i),n=t.substring(i+1)):a=t;var s=[];if(a&&"object"==typeof e){var o=e[a],p=typeof o;void 0!=p&&null!=p&&(o&&"object"==p&&o.constructor==Array?s=s.concat(o):s.push(o))}var l=s.length;if(n)for(var u=0;l>u;u++)r=r.concat(Spry.Data.JSONDataSet.getMatchingObjects(n,s[u]));else r=s}return r},Spry.Data.JSONDataSet.flattenObject=function(t,e){var r=e?e:"column0",a={},n=typeof t;return"object"==n?Spry.Data.JSONDataSet.copyProps(a,t):a[r]=t,a.ds_JSONObject=t,a},Spry.Data.JSONDataSet.copyProps=function(t,e,r){if(e&&t)for(var a in e)r&&"object"==typeof e[a]||(t[a]=e[a]);return t},Spry.Data.JSONDataSet.flattenDataIntoRecordSet=function(t,e,r){var a={};a.data=[],a.dataHash={},e||(e="");var n=t,i=typeof n,s="";if("object"!=i||!n){if(null!=n){var o={};o.column0=n,o.ds_RowID=0,a.data.push(o),a.dataHash[o.ds_RowID]=o}return a}var p=[];if(n.constructor==Array){var l=n.length;if(1>l)return a;var u=typeof n[0];if("object"!=u){for(var h=0;l>h;h++){var o={};o.column0=n[h],o.ds_RowID=h,a.data.push(o),a.dataHash[o.ds_RowID]=o}return a}if(n[0].constructor==Array)return a;if(e)for(var h=0;l>h;h++)p=p.concat(Spry.Data.JSONDataSet.getMatchingObjects(e,n[h]));else for(var h=0;l>h;h++)p.push(n[h])}else e?p=Spry.Data.JSONDataSet.getMatchingObjects(e,n):p.push(n);var c=p.length;if(e&&c>=1&&"object"!=typeof p[0]&&(s=e.replace(/.*\./,"")),r)for(var f=0,h=0;c>h;h++){var n=p[h],d=[],S=0;for(var y in n){var g=n[y],D=typeof g;"object"==D&&g.constructor==Array&&(d.push(y),S=Math.max(S,n[y].length))}for(var v=d.length,m=0;S>m;m++){for(var o={},E=0;v>E;E++){var b=d[E];o[b]=n[b][m]}o.ds_RowID=f++,a.dataHash[o.ds_RowID]=o,a.data.push(o)}}else for(var h=0;c>h;h++){var o=Spry.Data.JSONDataSet.flattenObject(p[h],s,r);o.ds_RowID=h,a.dataHash[h]=o,a.data.push(o)}return a},Spry.Data.JSONDataSet.prototype.flattenSubPaths=function(t,e){if(t&&e){var r=e.length;if(!(1>r)){for(var a=t.data,n={},i=[],s=[],o=[],p=0;r>p;p++){var l=e[p];"object"==typeof l&&(o[p]=l.pathIsObjectOfArrays,l=l.path),l||(l=""),i[p]=Spry.Data.Region.processDataRefString(null,l,this.dataSetsForDataRefStrings),s[p]=i[p].replace(/\[.*\]/g,"")}for(var u,h=a.length,c=[],p=0;h>p;p++){u=a[p];for(var f=[u],d=0;r>d;d++){var S=Spry.Data.JSONDataSet.flattenDataIntoRecordSet(u.ds_JSONObject,i[d],o[d]);if(S&&S.data&&S.data.length){if("object"==typeof e[d]&&e[d].subPaths){var y=e[d].subPaths;spType=typeof y,"string"==spType?y=[y]:"object"==spType&&spType.constructor==Object&&(y=[y]),this.flattenSubPaths(S,y)}for(var g=S.data,D=g.length,v=s[d]+".",m=f.length,E=[],b=0;m>b;b++)for(var x=f[b],R=0;D>R;R++){var T={},w=g[R];for(var N in w){var C=v+N;(v==N||-1!=v.search(RegExp("\\."+N+"\\.$")))&&(C=s[d]),T[C]=w[N]}Spry.Data.JSONDataSet.copyProps(T,x),E.push(T)}f=E}}c=c.concat(f)}for(a=c,h=a.length,p=0;h>p;p++)u=a[p],u.ds_RowID=p,n[u.ds_RowID]=u;t.data=a,t.dataHash=n}}},Spry.Data.JSONDataSet.prototype.parseJSON=function(str,filter){function walk(t,e){if(e&&"object"==typeof e)for(var r in e)e.hasOwnProperty(r)&&(e[r]=walk(r,e[r]));return filter(t,e)}try{if(/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/.test(str)){var j=eval("("+str+")");return"function"==typeof filter&&(j=walk("",j)),j}}catch(e){}throw Error("Failed to parse JSON string.")},Spry.Data.JSONDataSet.prototype.syncColumnTypesToData=function(){var t=this.getData()[0];for(var e in t)if(!this.columnTypes[e]){var r=typeof t[e];"number"==r&&this.setColumnType(e,r)}},Spry.Data.JSONDataSet.prototype.loadDataIntoDataSet=function(rawDataDoc){this.preparseFunc&&(rawDataDoc=this.preparseFunc(this,rawDataDoc));var jsonObj;try{jsonObj=this.useParser?this.parseJSON(rawDataDoc):eval("("+rawDataDoc+")")}catch(e){Spry.Debug.reportError("Caught exception in JSONDataSet.loadDataIntoDataSet: "+e),jsonObj={}}null==jsonObj&&(jsonObj="null");var rs=Spry.Data.JSONDataSet.flattenDataIntoRecordSet(jsonObj,Spry.Data.Region.processDataRefString(null,this.path,this.dataSetsForDataRefStrings),this.pathIsObjectOfArrays);this.flattenSubPaths(rs,this.subPaths),this.doc=rawDataDoc,this.docObj=jsonObj,this.data=rs.data,this.dataHash=rs.dataHash,this.dataWasLoaded=null!=this.doc,this.syncColumnTypesToData()},Spry.Data.NestedJSONDataSet=function(t,e,r){this.parentDataSet=t,this.jpath=e,this.nestedDataSets=[],this.nestedDataSetsHash={},this.currentDS=null,this.currentDSAncestor=null,this.options=r,this.ignoreOnDataChanged=!1,Spry.Data.DataSet.call(this,r),t.addObserver(this)},Spry.Data.NestedJSONDataSet.prototype=new Spry.Data.DataSet,Spry.Data.NestedJSONDataSet.prototype.constructor=Spry.Data.NestedJSONDataSet.prototype,Spry.Data.NestedJSONDataSet.prototype.getParentDataSet=function(){return this.parentDataSet},Spry.Data.NestedJSONDataSet.prototype.getNestedDataSetForParentRow=function(t){var e=t.ds_JSONObject;if(e&&this.nestedDataSets){if(this.currentDSAncestor&&this.currentDSAncestor==e)return this.currentDS;for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++){var i=r[n];if(i&&e==i.ancestor)return i.dataSet}}return null},Spry.Data.NestedJSONDataSet.prototype.getNestedJSONDataSetsArray=function(){var t=[];if(this.nestedDataSets)for(var e=this.nestedDataSets,r=this.nestedDataSets.length,a=0;r>a;a++)t.push(e[a].dataSet);return t},Spry.Data.NestedJSONDataSet.prototype.onDataChanged=function(){this.ignoreOnDataChanged||this.loadData()},Spry.Data.NestedJSONDataSet.prototype.onCurrentRowChanged=function(){this.notifyObservers("onPreParentContextChange"),this.currentDS=null,this.currentDSAncestor=null;var t=this.parentDataSet.getCurrentRow();if(t){var e=this.getNestedDataSetForParentRow(t);e&&(this.currentDS=e,this.currentDSAncestor=t.ds_JSONObject)}this.notifyObservers("onDataChanged"),this.notifyObservers("onPostParentContextChange"),this.ignoreOnDataChanged=!1},Spry.Data.NestedJSONDataSet.prototype.onPostParentContextChange=Spry.Data.NestedJSONDataSet.prototype.onCurrentRowChanged,Spry.Data.NestedJSONDataSet.prototype.onPreParentContextChange=function(){this.ignoreOnDataChanged=!0},Spry.Data.NestedJSONDataSet.prototype.filterAndSortData=function(){this.filterDataFunc&&this.filterData(this.filterDataFunc,!0),this.distinctOnLoad&&this.distinct(this.distinctFieldsOnLoad),this.keepSorted&&this.getSortColumn()?this.sort(this.lastSortColumns,this.lastSortOrder):this.sortOnLoad&&this.sort(this.sortOnLoad,this.sortOrderOnLoad),this.filterFunc&&this.filter(this.filterFunc,!0)},Spry.Data.NestedJSONDataSet.prototype.loadData=function(){var t=this.parentDataSet;if(t&&!t.getLoadDataRequestIsPending()&&this.jpath){if(!t.getDataWasLoaded())return t.loadData(),void 0;this.notifyObservers("onPreLoad"),this.nestedDataSets=[],this.currentDS=null,this.currentDSAncestor=null,this.data=[],this.dataHash={};var e=this,r=[t];t.getNestedJSONDataSetsArray&&(r=t.getNestedJSONDataSetsArray());var a=null,n=t.getCurrentRow();n&&(a=n.ds_JSONObject);for(var i=r.length,s=0;i>s;s++){var o=r[s],p=o.getData(!0);if(p)for(var l=p.length,u=0;l>u;u++){var h=p[u];if(h&&h.ds_JSONObject){var c=new Spry.Data.DataSet(this.options);for(var f in this.columnTypes)c.setColumnType(f,this.columnTypes[f]);var d=Spry.Data.JSONDataSet.flattenDataIntoRecordSet(h.ds_JSONObject,this.jpath);c.setDataFromArray(d.data,!0);var S={};S.ancestor=h.ds_JSONObject,S.dataSet=c,this.nestedDataSets.push(S),h.ds_JSONObject==a&&(this.currentDS=c,this.currentDSAncestor=this.ds_JSONObject),c.addObserver(function(t,r,a){r==e.currentDS&&setTimeout(function(){e.notifyObservers(t,a)},0)})}}}this.pendingRequest={},this.dataWasLoaded=!1,this.pendingRequest.timer=setTimeout(function(){e.pendingRequest=null,e.dataWasLoaded=!0,e.disableNotifications(),e.filterAndSortData(),e.enableNotifications(),e.notifyObservers("onPostLoad"),e.notifyObservers("onDataChanged")},0)}},Spry.Data.NestedJSONDataSet.prototype.getData=function(t){return this.currentDS?this.currentDS.getData(t):[]},Spry.Data.NestedJSONDataSet.prototype.getRowCount=function(t){return this.currentDS?this.currentDS.getRowCount(t):0},Spry.Data.NestedJSONDataSet.prototype.getRowByID=function(t){return this.currentDS?this.currentDS.getRowByID(t):void 0},Spry.Data.NestedJSONDataSet.prototype.getRowByRowNumber=function(t,e){return this.currentDS?this.currentDS.getRowByRowNumber(t,e):null},Spry.Data.NestedJSONDataSet.prototype.getCurrentRow=function(){return this.currentDS?this.currentDS.getCurrentRow():null},Spry.Data.NestedJSONDataSet.prototype.setCurrentRow=function(t){return this.currentDS?this.currentDS.setCurrentRow(t):void 0},Spry.Data.NestedJSONDataSet.prototype.getRowNumber=function(t){return this.currentDS?this.currentDS.getRowNumber(t):0},Spry.Data.NestedJSONDataSet.prototype.getCurrentRowNumber=function(){return this.currentDS?this.currentDS.getCurrentRowNumber():0},Spry.Data.NestedJSONDataSet.prototype.getCurrentRowID=function(){return this.currentDS?this.currentDS.getCurrentRowID():0},Spry.Data.NestedJSONDataSet.prototype.setCurrentRowNumber=function(t){return this.currentDS?this.currentDS.setCurrentRowNumber(t):void 0},Spry.Data.NestedJSONDataSet.prototype.findRowsWithColumnValues=function(t,e,r){return this.currentDS?this.currentDS.findRowsWithColumnValues(t,e,r):e?null:[]},Spry.Data.NestedJSONDataSet.prototype.setColumnType=function(t,e){if(t){Spry.Data.DataSet.prototype.setColumnType.call(this,t,e);for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++)r[n].dataSet.setColumnType(t,e)}},Spry.Data.NestedJSONDataSet.prototype.getColumnType=function(t){return this.currentDS?this.currentDS.getColumnType(t):"string"},Spry.Data.NestedJSONDataSet.prototype.distinct=function(t){if(t)for(var e=this.nestedDataSets,r=e.length,a=0;r>a;a++)e[a].dataSet.distinct(t)},Spry.Data.NestedJSONDataSet.prototype.sort=function(t,e){if(t){for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++)r[n].dataSet.sort(t,e);if(a>0){var i=r[0].dataSet;this.lastSortColumns=i.lastSortColumns.slice(0),this.lastSortOrder=i.lastSortOrder}}},Spry.Data.NestedJSONDataSet.prototype.filterData=function(t,e){this.filterDataFunc=t;for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++)r[n].dataSet.filterData(t,e)},Spry.Data.NestedJSONDataSet.prototype.filter=function(t,e){this.filterFunc=t;for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++)r[n].dataSet.filter(t,e)},Spry.Data.NestedXMLDataSet=function(t,e,r){this.parentDataSet=t,this.xpath=e,this.nestedDataSets=[],this.nestedDataSetsHash={},this.currentDS=null,this.currentDSAncestor=null,this.options=r,this.ignoreOnDataChanged=!1,this.entityEncodeStrings=t?t.entityEncodeStrings:!0,Spry.Data.DataSet.call(this,r),t.addObserver(this)},Spry.Data.NestedXMLDataSet.prototype=new Spry.Data.DataSet,Spry.Data.NestedXMLDataSet.prototype.constructor=Spry.Data.NestedXMLDataSet.prototype,Spry.Data.NestedXMLDataSet.prototype.getParentDataSet=function(){return this.parentDataSet},Spry.Data.NestedXMLDataSet.prototype.getNestedDataSetForParentRow=function(t){var e=t.ds_XMLNode;if(e&&this.nestedDataSets){if(this.currentDSAncestor&&this.currentDSAncestor==e)return this.currentDS;for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++){var i=r[n];if(i&&e==i.ancestor)return i.dataSet}}return null},Spry.Data.NestedXMLDataSet.prototype.getNestedXMLDataSetsArray=function(){var t=[];if(this.nestedDataSets)for(var e=this.nestedDataSets,r=this.nestedDataSets.length,a=0;r>a;a++)t.push(e[a].dataSet);return t},Spry.Data.NestedXMLDataSet.prototype.onDataChanged=function(){this.ignoreOnDataChanged||this.loadData()},Spry.Data.NestedXMLDataSet.prototype.onCurrentRowChanged=function(){this.notifyObservers("onPreParentContextChange"),this.currentDS=null,this.currentDSAncestor=null;var t=this.parentDataSet.getCurrentRow();if(t){var e=this.getNestedDataSetForParentRow(t);e&&(this.currentDS=e,this.currentDSAncestor=t.ds_XMLNode)}this.notifyObservers("onDataChanged"),this.notifyObservers("onPostParentContextChange"),this.ignoreOnDataChanged=!1},Spry.Data.NestedXMLDataSet.prototype.onPostParentContextChange=Spry.Data.NestedXMLDataSet.prototype.onCurrentRowChanged,Spry.Data.NestedXMLDataSet.prototype.onPreParentContextChange=function(){this.ignoreOnDataChanged=!0},Spry.Data.NestedXMLDataSet.prototype.filterAndSortData=function(){this.filterDataFunc&&this.filterData(this.filterDataFunc,!0),this.distinctOnLoad&&this.distinct(this.distinctFieldsOnLoad),this.keepSorted&&this.getSortColumn()?this.sort(this.lastSortColumns,this.lastSortOrder):this.sortOnLoad&&this.sort(this.sortOnLoad,this.sortOrderOnLoad),this.filterFunc&&this.filter(this.filterFunc,!0)},Spry.Data.NestedXMLDataSet.prototype.loadData=function(){var t=this.parentDataSet;if(t&&!t.getLoadDataRequestIsPending()&&this.xpath){if(!t.getDataWasLoaded())return t.loadData(),void 0;this.notifyObservers("onPreLoad"),this.nestedDataSets=[],this.currentDS=null,this.currentDSAncestor=null,this.data=[],this.dataHash={};var e=this,r=[t];t.getNestedXMLDataSetsArray&&(r=t.getNestedXMLDataSetsArray());var a=null,n=t.getCurrentRow();n&&(a=n.ds_XMLNode);for(var i=r.length,s=0;i>s;s++){var o=r[s],p=o.getData(!0);if(p)for(var l=p.length,u=0;l>u;u++){var h=p[u];if(h&&h.ds_XMLNode){var c=new Spry.Data.DataSet(this.options);for(var f in this.columnTypes)c.setColumnType(f,this.columnTypes[f]);var d=Spry.Data.XMLDataSet.getRecordSetFromXMLDoc(h.ds_XMLNode,this.xpath,!1,this.entityEncodeStrings);c.setDataFromArray(d.data,!0);var S={};S.ancestor=h.ds_XMLNode,S.dataSet=c,this.nestedDataSets.push(S),h.ds_XMLNode==a&&(this.currentDS=c,this.currentDSAncestor=this.ds_XMLNode),c.addObserver(function(t,r,a){r==e.currentDS&&setTimeout(function(){e.notifyObservers(t,a)},0)})}}}this.pendingRequest={},this.dataWasLoaded=!1,this.pendingRequest.timer=setTimeout(function(){e.pendingRequest=null,e.dataWasLoaded=!0,e.disableNotifications(),e.filterAndSortData(),e.enableNotifications(),e.notifyObservers("onPostLoad"),e.notifyObservers("onDataChanged")},0)}},Spry.Data.NestedXMLDataSet.prototype.getData=function(t){return this.currentDS?this.currentDS.getData(t):[]},Spry.Data.NestedXMLDataSet.prototype.getRowCount=function(t){return this.currentDS?this.currentDS.getRowCount(t):0},Spry.Data.NestedXMLDataSet.prototype.getRowByID=function(t){return this.currentDS?this.currentDS.getRowByID(t):void 0},Spry.Data.NestedXMLDataSet.prototype.getRowByRowNumber=function(t,e){return this.currentDS?this.currentDS.getRowByRowNumber(t,e):null},Spry.Data.NestedXMLDataSet.prototype.getCurrentRow=function(){return this.currentDS?this.currentDS.getCurrentRow():null},Spry.Data.NestedXMLDataSet.prototype.setCurrentRow=function(t){return this.currentDS?this.currentDS.setCurrentRow(t):void 0},Spry.Data.NestedXMLDataSet.prototype.getRowNumber=function(t){return this.currentDS?this.currentDS.getRowNumber(t):0},Spry.Data.NestedXMLDataSet.prototype.getCurrentRowNumber=function(){return this.currentDS?this.currentDS.getCurrentRowNumber():0},Spry.Data.NestedXMLDataSet.prototype.getCurrentRowID=function(){return this.currentDS?this.currentDS.getCurrentRowID():0},Spry.Data.NestedXMLDataSet.prototype.setCurrentRowNumber=function(t){return this.currentDS?this.currentDS.setCurrentRowNumber(t):void 0},Spry.Data.NestedXMLDataSet.prototype.findRowsWithColumnValues=function(t,e,r){return this.currentDS?this.currentDS.findRowsWithColumnValues(t,e,r):e?null:[]},Spry.Data.NestedXMLDataSet.prototype.setColumnType=function(t,e){if(t){Spry.Data.DataSet.prototype.setColumnType.call(this,t,e);for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++)r[n].dataSet.setColumnType(t,e)}},Spry.Data.NestedXMLDataSet.prototype.getColumnType=function(t){return this.currentDS?this.currentDS.getColumnType(t):"string"},Spry.Data.NestedXMLDataSet.prototype.distinct=function(t){if(t)for(var e=this.nestedDataSets,r=e.length,a=0;r>a;a++)e[a].dataSet.distinct(t)},Spry.Data.NestedXMLDataSet.prototype.sort=function(t,e){if(t){for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++)r[n].dataSet.sort(t,e);if(a>0){var i=r[0].dataSet;this.lastSortColumns=i.lastSortColumns.slice(0),this.lastSortOrder=i.lastSortOrder}}},Spry.Data.NestedXMLDataSet.prototype.filterData=function(t,e){this.filterDataFunc=t;for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++)r[n].dataSet.filterData(t,e)},Spry.Data.NestedXMLDataSet.prototype.filter=function(t,e){this.filterFunc=t;for(var r=this.nestedDataSets,a=r.length,n=0;a>n;n++)r[n].dataSet.filter(t,e)},Spry.Data.NestedXMLDataSet.prototype.setXPath=function(t){this.xpath!=t&&(this.xpath=t,this.loadData())};var Spry;Spry||(Spry={}),Spry.Utils||(Spry.Utils={}),Spry.Utils.Notifier=function(){this.observers=[],this.suppressNotifications=0},Spry.Utils.Notifier.prototype.addObserver=function(t){if(t){for(var e=this.observers.length,r=0;e>r;r++)if(this.observers[r]==t)return;this.observers[e]=t}},Spry.Utils.Notifier.prototype.removeObserver=function(t){if(t)for(var e=0;this.observers.length>e;e++)if(this.observers[e]==t){this.observers.splice(e,1);break}},Spry.Utils.Notifier.prototype.notifyObservers=function(t,e){if(t&&!this.suppressNotifications)for(var r=this.observers.length,a=0;r>a;a++){var n=this.observers[a];n&&("function"==typeof n?n(t,this,e):n[t]&&n[t](this,e))}},Spry.Utils.Notifier.prototype.enableNotifications=function(){0>--this.suppressNotifications&&(this.suppressNotifications=0,Spry.Debug.reportError("Unbalanced enableNotifications() call!\n"))},Spry.Utils.Notifier.prototype.disableNotifications=function(){++this.suppressNotifications};var Spry;Spry||(Spry={}),Spry.Data||(Spry.Data={}),Spry.Data.PagedView=function(t,e){Spry.Data.DataSet.call(this),this.ds=t,this.pageSize=10,this.pageOffset=0,this.forceFullPages=!1,this.pageFirstItemOffset=0,this.useZeroBasedIndexes=!1,this.setCurrentRowOnPageChange=!1,Spry.Utils.setOptions(this,e),this.adjustmentValue=1,this.useZeroBasedIndexes||(this.adjustmentValue=0),this.pageStop=this.pageOffset+this.pageSize,this.ds.addObserver(this),this.preProcessData(),this.pageSize>0&&this.filter(this.getFilterFunc())},Spry.Data.PagedView.prototype=new Spry.Data.DataSet,Spry.Data.PagedView.prototype.constructor=Spry.Data.PagedView,Spry.Data.PagedView.prototype.setCurrentRow=function(t){this.ds&&this.ds.setCurrentRow(t)},Spry.Data.PagedView.prototype.setCurrentRowNumber=function(t){this.ds&&this.ds.setCurrentRowNumber(t)},Spry.Data.PagedView.prototype.sort=function(t,e){if(t){"string"==typeof t?t=[t,"ds_RowID"]:2>t.length&&"ds_RowID"!=t[0]&&t.push("ds_RowID"),e||(e="toggle"),"toggle"==e&&(e=this.lastSortColumns.length>0&&this.lastSortColumns[0]==t[0]&&"ascending"==this.lastSortOrder?"descending":"ascending");var r={oldSortColumns:this.lastSortColumns,oldSortOrder:this.lastSortOrder,newSortColumns:t,newSortOrder:e};this.notifyObservers("onPreSort",r),this.disableNotifications(),Spry.Data.DataSet.prototype.sort.call(this,t,e),this.updatePagerColumns(),this.firstPage(),this.enableNotifications(),this.notifyObservers("onPostSort",r)}},Spry.Data.PagedView.prototype.loadData=function(){return this.ds&&!this.ds.getLoadDataRequestIsPending()?this.ds.getDataWasLoaded()?(Spry.Data.DataSet.prototype.loadData.call(this),void 0):(this.ds.loadData(),void 0):void 0},Spry.Data.PagedView.prototype.onDataChanged=function(){this.setPageOffset(0),this.preProcessData()},Spry.Data.PagedView.prototype.onCurrentRowChanged=function(t,e){var r=this;setTimeout(function(){r.notifyObservers("onCurrentRowChanged",e)},0)},Spry.Data.PagedView.prototype.onPostSort=Spry.Data.PagedView.prototype.onDataChanged,Spry.Data.PagedView.prototype.updatePagerColumns=function(){var t=this.getData(!0);if(t&&!(1>t.length)){var e=t.length,r=this.pageSize>0?this.pageSize:e,a=1,n=a+r-1;n=a>n?a:n>e?e:n;for(var i=1,s=parseInt((e+r-1)/r),o=Math.min(e,r),p=0;e>p;p++){itemIndex=p+1,itemIndex>n&&(a=itemIndex,n=a+this.pageSize-1,n=n>e?e:n,o=Math.min(n-a+1,r),++i);var l=t[p];l&&(l.ds_PageNumber=i,l.ds_PageSize=this.pageSize,l.ds_PageItemRowNumber=p,l.ds_PageItemNumber=itemIndex,l.ds_PageFirstItemNumber=a,l.ds_PageLastItemNumber=n,l.ds_PageItemCount=o,l.ds_PageCount=s,l.ds_PageTotalItemCount=e)}}},Spry.Data.PagedView.prototype.preProcessData=function(){if(this.ds&&this.ds.getDataWasLoaded()){this.notifyObservers("onPreLoad"),this.unfilteredData=null,this.data=[],this.dataHash={};var t=this.ds.getData();if(t){for(var e=t.length,r=0;e>r;r++){var a=t[r],n={};Spry.Utils.setOptions(n,a),this.data.push(n),this.dataHash[n.ds_RowID]=n}e>0&&(this.curRowID=t[0].ds_RowID),this.updatePagerColumns()}this.loadData()}},Spry.Data.PagedView.prototype.getFilterFunc=function(){var t=this;return function(e,r,a){return t.pageOffset>a||a>=t.pageStop?null:r}},Spry.Data.PagedView.prototype.setPageOffset=function(t){var e=this.getData(!0).length;this.pageFirstItemOffset=0>t?0:t,this.forceFullPages&&t>e-this.pageSize&&(t=e-this.pageSize),0>t&&(t=0),this.pageOffset=t,this.pageStop=t+this.pageSize},Spry.Data.PagedView.prototype.filterDataSet=function(t){if(!(1>this.pageSize)){this.setPageOffset(t);var e=this.getData(!0);e&&e.length&&e[this.pageFirstItemOffset]&&(this.curRowID=e[this.pageFirstItemOffset].ds_RowID),this.setCurrentRowOnPageChange&&this.ds.setCurrentRow(this.curRowID),this.filter(this.getFilterFunc())}},Spry.Data.PagedView.prototype.getPageCount=function(){return parseInt((this.getData(!0).length+this.pageSize-1)/this.pageSize)},Spry.Data.PagedView.prototype.getCurrentPage=function(){return parseInt(((this.pageFirstItemOffset!=this.pageOffset?this.pageFirstItemOffset:this.pageOffset)+this.pageSize)/this.pageSize)-this.adjustmentValue},Spry.Data.PagedView.prototype.goToPage=function(t){t=parseInt(t);var e=this.getPageCount();if(!(1>t+this.adjustmentValue||t+this.adjustmentValue>e)){var r=(t-1+this.adjustmentValue)*this.pageSize;this.filterDataSet(r)}},Spry.Data.PagedView.prototype.goToPageContainingRowID=function(t){this.goToPageContainingRowNumber(this.getRowNumber(this.getRowByID(t),!0))},Spry.Data.PagedView.prototype.goToPageContainingRowNumber=function(t){this.goToPage(this.getPageForRowNumber(t))},Spry.Data.PagedView.prototype.goToPageContainingItemNumber=function(t){this.goToPageContainingRowNumber(t-1)},Spry.Data.PagedView.prototype.firstPage=function(){this.goToPage(1-this.adjustmentValue)},Spry.Data.PagedView.prototype.lastPage=function(){this.goToPage(this.getPageCount()-this.adjustmentValue)},Spry.Data.PagedView.prototype.previousPage=function(){this.goToPage(this.getCurrentPage()-1)},Spry.Data.PagedView.prototype.nextPage=function(){this.goToPage(this.getCurrentPage()+1)},Spry.Data.PagedView.prototype.getPageForRowID=function(t){return this.getPageForRowNumber(this.getRowNumber(this.getRowByID(t),!0))},Spry.Data.PagedView.prototype.getPageForRowNumber=function(t){return parseInt(t/this.pageSize)+1-this.adjustmentValue},Spry.Data.PagedView.prototype.getPageForItemNumber=function(t){return this.getPageForRowNumber(t-1)},Spry.Data.PagedView.prototype.getPageSize=function(){return this.pageSize},Spry.Data.PagedView.prototype.setPageSize=function(t){this.pageSize!=t&&(1>t?(this.pageSize=0,this.setPageOffset(0),this.updatePagerColumns(),this.filter(null)):1>this.pageSize?(this.pageSize=t,this.setPageOffset(0),this.updatePagerColumns(),this.filterDataSet(this.pageOffset)):(this.pageSize=t,this.updatePagerColumns(),this.goToPage(this.getPageForRowNumber(this.pageFirstItemOffset))))},Spry.Data.PagedView.prototype.getPagingInfo=function(){return new Spry.Data.PagedView.PagingInfo(this)},Spry.Data.PagedView.PagingInfo=function(t){Spry.Data.DataSet.call(this),this.pagedView=t,t.addObserver(this)},Spry.Data.PagedView.PagingInfo.prototype=new Spry.Data.DataSet,Spry.Data.PagedView.PagingInfo.prototype.constructor=Spry.Data.PagedView.PagingInfo,Spry.Data.PagedView.PagingInfo.prototype.onDataChanged=function(){this.extractInfo()},Spry.Data.PagedView.PagingInfo.prototype.onPostSort=Spry.Data.PagedView.PagingInfo.prototype.onDataChanged,Spry.Data.PagedView.PagingInfo.prototype.extractInfo=function(){var t=this.pagedView;if(t&&t.getDataWasLoaded()){this.notifyObservers("onPreLoad"),this.unfilteredData=null,this.data=[],this.dataHash={};var e=t.getData(!0);if(e){var r=e.length;t.getPageCount();for(var a=0,n=0;r>a;){var i=e[a],s={};s.ds_RowID=n++,this.data.push(s),this.dataHash[s.ds_RowID]=s,s.ds_PageNumber=i.ds_PageNumber,s.ds_PageSize=i.ds_PageSize,s.ds_PageCount=i.ds_PageCount,s.ds_PageFirstItemNumber=i.ds_PageFirstItemNumber,s.ds_PageLastItemNumber=i.ds_PageLastItemNumber,s.ds_PageItemCount=i.ds_PageItemCount,s.ds_PageTotalItemCount=i.ds_PageTotalItemCount,a+=s.ds_PageSize}if(r>0){var o=this,p=function(e){"onPostLoad"==e&&(o.removeObserver(p),o.setCurrentRowNumber(t.getCurrentPage()-(t.useZeroBasedIndexes?0:1)))};this.addObserver(p)}}this.loadData()}},Spry.Data.TSVDataSet=function(t,e){Spry.Data.HTTPSourceDataSet.call(this,t,e),this.delimiter="	",this.firstRowAsHeaders=!0,this.columnNames=[],this.columnNames=[],Spry.Utils.setOptions(this,e)},Spry.Data.TSVDataSet.prototype=new Spry.Data.HTTPSourceDataSet,Spry.Data.TSVDataSet.prototype.constructor=Spry.Data.TSVDataSet,Spry.Data.TSVDataSet.prototype.getDataRefStrings=function(){var t=[];return this.url&&t.push(this.url),t},Spry.Data.TSVDataSet.prototype.getDocument=function(){return this.doc},Spry.Data.TSVDataSet.prototype.columnNumberToColumnName=function(t){var e=this.columnNames[t];return e||(e="column"+t),e},Spry.Data.TSVDataSet.prototype.loadDataIntoDataSet=function(t){var e=[],r={},a=t?t:"";a.length;for(var n=0,i=this.firstRowAsHeaders,s=0,o=/[^\r\n]+|(\r\n|\r|\n)/gm,p=o.exec(a),l=null,u=-1,h=0;p&&p[0];){var c=p[0];if("\r\n"==c||"\r"==c||"\n"==c)i||(l.ds_RowID=h++,e.push(l),r[l.ds_RowID]=l,l=null),i=!1,u=-1;else for(var f=c.split(this.delimiter),n=0;f.length>n;n++)i?this.columnNames[++u]=f[n]:(0==++u&&(l={}),l[this.columnNumberToColumnName(u)]=f[n]);s=o.lastIndex,p=o.exec(a)}this.doc=t,this.data=e,this.dataHash=r,this.dataWasLoaded=null!=this.doc};var Spry;Spry||(Spry={}),Spry.Utils||(Spry.Utils={}),Spry.Utils.urlComponentToObject=function(t,e,r){var a={};if(t){e||(e="&"),r||(r="=");for(var n=t.split(e),i=0;n.length>i;i++){var s=n[i].split(r),o=decodeURIComponent(s[0]?s[0]:""),p=decodeURIComponent(s[1]?s[1]:"");if(p.match(/^0$|^[1-9]\d*$/)&&(p=parseInt(p)),a[o]===void 0)a[o]=p;else{if("object"!=typeof a[o]){var l=a[o];a[o]=[],a[o].push(l)}a[o].push(p)}}}return a},Spry.Utils.getLocationHashParamsAsObject=function(t,e){return Spry.Utils.urlComponentToObject(window.location.hash.replace(/^#/,""),t,e)},Spry.Utils.getLocationParamsAsObject=function(){return Spry.Utils.urlComponentToObject(window.location.search.replace(/^\?/,""))},Spry.Utils.getURLHashParamsAsObject=function(t,e,r){var a;
return t&&(a=t.search("#"))>=0?Spry.Utils.urlComponentToObject(t.substr(a+1),e,r):{}},Spry.Utils.getURLParamsAsObject=function(t){var e;return t&&(e=t.match(/\?[^#]*/))&&e?Spry.Utils.urlComponentToObject(e[0].replace(/^\?/,"")):{}};var Spry;Spry||(Spry={}),Spry.Utils||(Spry.Utils={}),Spry.Utils.submitForm=function(t,e,r){if(!t)return!0;"string"==typeof t&&(t=Spry.$(t)||document.forms[t]);var a={};a.method=t.getAttribute("method"),a.url=t.getAttribute("action")||document.location.href,a.enctype=t.getAttribute("enctype"),Spry.Utils.setOptions(a,r);var n=Spry.Utils.extractParamsFromForm(t,a.elements);return a.additionalData&&(n+="&"+a.additionalData),a.enctype&&"multipart/form-data"==a.enctype.toLowerCase()?!0:(a.method=a.method&&"post"==a.method.toLowerCase()?"POST":"GET","GET"==a.method?(a.url+=-1==a.url.indexOf("?")?"?":"&",a.url+=n):(a.headers||(a.headers={}),a.headers["Content-Type"]&&-1!=a.headers["Content-Type"].indexOf("application/x-www-form-urlencoded")||(a.headers["Content-Type"]="application/x-www-form-urlencoded"),a.postData=n),Spry.Utils.loadURL(a.method,a.url,!0,e,a),!1)},Spry.Utils.extractParamsFromForm=function(t,e){if(!t)return"";"string"==typeof t&&(t=document.getElementById(t)||document.forms[t]);var r;e&&(r=","+e.join(",")+",");for(var a,n=[],i=0;t.elements.length>i;i++)if(a=t.elements[i],!a.disabled&&a.name&&a.type&&(!r||-1!=r.indexOf(","+a.name+",")))switch(a.type.toLowerCase()){case"text":case"password":case"textarea":case"hidden":case"submit":n.push(encodeURIComponent(a.name)+"="+encodeURIComponent(a.value));break;case"select-one":var s,o="";a.selectedIndex>=0&&(s=a.options[a.selectedIndex],o=s.value||s.text),n.push(encodeURIComponent(a.name)+"="+encodeURIComponent(o));break;case"select-multiple":for(var p=0;a.length>p;p++)a.options[p].selected&&(o=a.options[p].value||a.options[p].text,n.push(encodeURIComponent(a.name)+"="+encodeURIComponent(o)));break;case"checkbox":case"radio":a.checked&&n.push(encodeURIComponent(a.name)+"="+encodeURIComponent(a.value));break;default:}return n.join("&")};var Spry;Spry||(Spry={}),Spry.XML||(Spry.XML={}),Spry.XML.Schema||(Spry.XML.Schema={}),Spry.XML.Schema.Node=function(t){this.nodeName=t,this.isAttribute=!1,this.appearsMoreThanOnce=!1,this.children=[]},Spry.XML.Schema.Node.prototype.toString=function(t){t||(t="");var e=t+this.nodeName;this.appearsMoreThanOnce&&(e+=" (+)"),e+="\n";var r=t+"    ";for(var a in this.children){var n=this.children[a];e+=n.isAttribute?r+n.nodeName+"\n":n.toString(r)}return e},Spry.XML.Schema.mapElementIntoSchemaNode=function(t,e){if(t&&e){var r=0;for(r=0;t.attributes.length>r;r++){var a=t.attributes.item(r);if(a&&2==a.nodeType){var n="@"+a.name;if(!e.children[n]){var i=new Spry.XML.Schema.Node(n);i.isAttribute=!0,e.children[n]=i}}}for(var s=t.firstChild,o=[];s;){if(1==s.nodeType){var p=e.children[s.nodeName];p||(p=new Spry.XML.Schema.Node(s.nodeName),p&&(e.children[s.nodeName]=p)),p&&(o[p.nodeName]?p.appearsMoreThanOnce=!0:o[p.nodeName]=!0),Spry.XML.Schema.mapElementIntoSchemaNode(s,p)}s=s.nextSibling}}},Spry.XML.getSchemaForElement=function(t){return t?(schemaNode=new Spry.XML.Schema.Node(t.nodeName),Spry.XML.Schema.mapElementIntoSchemaNode(t,schemaNode),schemaNode):null},Spry.XML.getSchema=function(t){if(!t)return null;for(var e=t.firstChild;e&&1!=e.nodeType;)e=e.nextSibling;return Spry.XML.getSchemaForElement(e)},Spry.XML.nodeHasValue=function(t){if(t){var e=t.firstChild;if(e&&null==e.nextSibling&&(3==e.nodeType||4==e.nodeType))return!0}return!1},Spry.XML.XObject=function(){},Spry.XML.XObject.prototype._value=function(){var t=this["#text"];return void 0!=t?t:this["#cdata-section"]},Spry.XML.XObject.prototype._hasValue=function(){return void 0!=this._value()},Spry.XML.XObject.prototype._valueIsText=function(){return void 0!=this["#text"]},Spry.XML.XObject.prototype._valueIsCData=function(){return void 0!=this["#cdata-section"]},Spry.XML.XObject.prototype._propertyIsArray=function(t){var e=this[t];return void 0==e?!1:"object"==typeof e&&e.constructor==Array},Spry.XML.XObject.prototype._getPropertyAsArray=function(t){var e=[],r=this[t];if(void 0!=r){if("object"==typeof r&&r.constructor==Array)return r;e.push(r)}return e},Spry.XML.XObject.prototype._getProperties=function(){var t=[];for(var e in this)/^_/.test(e)||t.push(e);return t},Spry.XML.nodeToObject=function(t){if(!t)return null;for(var e=new Spry.XML.XObject,r=0;t.attributes.length>r;r++){var a=t.attributes[r],n="@"+a.name;e[n]=a.value}var i;if(Spry.XML.nodeHasValue(t))try{i=t.firstChild,3==i.nodeType?e[i.nodeName]=Spry.Utils.encodeEntities(i.data):4==i.nodeType&&(e[i.nodeName]=i.data)}catch(s){Spry.Debug.reportError("Spry.XML.nodeToObject() exception caught: "+s+"\n")}else for(i=t.firstChild;i;){if(1==i.nodeType){var o=!1,p=i.nodeName;if(e[p]){if(e[p].constructor!=Array){var l=e[p];e[p]=[],e[p].push(l)}o=!0}var u=Spry.XML.nodeToObject(i);o?e[p].push(u):e[p]=u}i=i.nextSibling}return e},Spry.XML.documentToObject=function(t){var e=null;if(t&&t.firstChild)for(var r=t.firstChild;r;){if(1==r.nodeType){e=new Spry.XML.XObject,e[r.nodeName]=Spry.XML.nodeToObject(r);break}r=r.nextSibling}return e};var REGEXP_UNICODE=function(){for(var t=[" ","Ġ",-1,"!","Ġ",-1,"Ġ","Ġ",0,"ġ","Ġ",-1,"ġ","Ġ|ġ",0,"Ģ","Ġ|ġ",-1,"Ġ","[Ġ]",0,"ġ","[Ġ]",-1,"ġ","[Ġġ]",0,"Ģ","[Ġġ]",-1,"ġ","[Ġ-ġ]",0,"Ģ","[Ġ-ġ]",-1],e=0;t.length>e;e+=3)if(t[e].search(RegExp(t[e+1]))!=t[e+2])return!1;return!0}(),XML_S="[ 	\r\n]+",XML_EQ="("+XML_S+")?=("+XML_S+")?",XML_CHAR_REF="&#[0-9]+;|&#x[0-9a-fA-F]+;",XML10_VERSION_INFO=XML_S+"version"+XML_EQ+'("1\\.0"|'+"'1\\.0')",XML10_BASE_CHAR=REGEXP_UNICODE?"A-Za-zÀ-ÖØ-öø-ÿĀ-ıĴ-ľŁ-ňŊ-žƀ-ǃǍ-ǰǴ-ǵǺ-ȗɐ-ʨʻ-ˁΆΈ-ΊΌΎ-ΡΣ-ώϐ-ϖϚϜϞϠϢ-ϳЁ-ЌЎ-яё-ќў-ҁҐ-ӄӇ-ӈӋ-ӌӐ-ӫӮ-ӵӸ-ӹԱ-Ֆՙա-ֆא-תװ-ײء-غف-يٱ-ڷں-ھۀ-ێې-ۓەۥ-ۦअ-हऽक़-ॡঅ-ঌএ-ঐও-নপ-রলশ-হড়-ঢ়য়-ৡৰ-ৱਅ-ਊਏ-ਐਓ-ਨਪ-ਰਲ-ਲ਼ਵ-ਸ਼ਸ-ਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઋઍએ-ઑઓ-નપ-રલ-ળવ-હઽૠଅ-ଌଏ-ଐଓ-ନପ-ରଲ-ଳଶ-ହଽଡ଼-ଢ଼ୟ-ୡஅ-ஊஎ-ஐஒ-கங-சஜஞ-டண-தந-பம-வஷ-ஹఅ-ఌఎ-ఐఒ-నప-ళవ-హౠ-ౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹೞೠ-ೡഅ-ഌഎ-ഐഒ-നപ-ഹൠ-ൡก-ฮะา-ำเ-ๅກ-ຂຄງ-ຈຊຍດ-ທນ-ຟມ-ຣລວສ-ຫອ-ຮະາ-ຳຽເ-ໄཀ-ཇཉ-ཀྵႠ-Ⴥა-ჶᄀᄂ-ᄃᄅ-ᄇᄉᄋ-ᄌᄎ-ᄒᄼᄾᅀᅌᅎᅐᅔ-ᅕᅙᅟ-ᅡᅣᅥᅧᅩᅭ-ᅮᅲ-ᅳᅵᆞᆨᆫᆮ-ᆯᆷ-ᆸᆺᆼ-ᇂᇫᇰᇹḀ-ẛẠ-ỹἀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼΩK-Å℮ↀ-ↂぁ-ゔァ-ヺㄅ-ㄬ가-힣":"A-Za-z",XML10_IDEOGRAPHIC=REGEXP_UNICODE?"一-龥〇〡-〩":"",XML10_COMBINING_CHAR=REGEXP_UNICODE?"̀-͠ͅ-҃͡-֑҆-֣֡-ֹֻ-ֽֿׁ-ׂًׄ-ْٰۖ-ۜ۝-۟۠-ۤۧ-۪ۨ-ۭँ-ः़ा-ौ्॑-॔ॢ-ॣঁ-ঃ়ািী-ৄে-ৈো-্ৗৢ-ৣਂ਼ਾਿੀ-ੂੇ-ੈੋ-੍ੰ-ੱઁ-ઃ઼ા-ૅે-ૉો-્ଁ-ଃ଼ା-ୃେ-ୈୋ-୍ୖ-ୗஂ-ஃா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕ-ౖಂ-ಃಾ-ೄೆ-ೈೊ-್ೕ-ೖം-ഃാ-ൃെ-ൈൊ-്ൗัิ-ฺ็-๎ັິ-ູົ-ຼ່-ໍ༘-༹༙༵༷༾༿ཱ-྄྆-ྋྐ-ྕྗྙ-ྭྱ-ྷྐྵ⃐-〪⃜⃡-゙゚〯":"",XML10_DIGIT=REGEXP_UNICODE?"0-9٠-٩۰-۹०-९০-৯੦-੯૦-૯୦-୯௧-௯౦-౯೦-೯൦-൯๐-๙໐-໙༠-༩":"0-9",XML10_EXTENDER=REGEXP_UNICODE?"·ːˑ·ـๆໆ々〱-〵ゝ-ゞー-ヾ":"",XML10_LETTER=XML10_BASE_CHAR+XML10_IDEOGRAPHIC,XML10_NAME_CHAR=XML10_LETTER+XML10_DIGIT+"\\._:"+XML10_COMBINING_CHAR+XML10_EXTENDER+"-",XML10_NAME="["+XML10_LETTER+"_:]["+XML10_NAME_CHAR+"]*",XML10_ENTITY_REF="&"+XML10_NAME+";",XML10_REFERENCE=XML10_ENTITY_REF+"|"+XML_CHAR_REF,XML10_ATT_VALUE='"(([^<&"]|'+XML10_REFERENCE+')*)"|'+"'(([^<&']|"+XML10_REFERENCE+")*)'",XML10_ATTRIBUTE="("+XML10_NAME+")"+XML_EQ+"("+XML10_ATT_VALUE+")",XML11_VERSION_INFO=XML_S+"version"+XML_EQ+'("1\\.1"|'+"'1\\.1')",XML11_NAME_START_CHAR=REGEXP_UNICODE?":A-Z_a-zÀ-ÖØ-öø-˿Ͱ-ͽͿ-῿‌-‍⁰-↏Ⰰ-⿯、-퟿豈-﷏ﷰ-�":":A-Z_a-z",XML11_NAME_CHAR=XML11_NAME_START_CHAR+(REGEXP_UNICODE?"\\.0-9·̀-ͯ‿-⁀-":"\\.0-9-"),XML11_NAME="["+XML11_NAME_START_CHAR+"]["+XML11_NAME_CHAR+"]*",XML11_ENTITY_REF="&"+XML11_NAME+";",XML11_REFERENCE=XML11_ENTITY_REF+"|"+XML_CHAR_REF,XML11_ATT_VALUE='"(([^<&"]|'+XML11_REFERENCE+')*)"|'+"'(([^<&']|"+XML11_REFERENCE+")*)'",XML11_ATTRIBUTE="("+XML11_NAME+")"+XML_EQ+"("+XML11_ATT_VALUE+")",XML_NC_NAME_CHAR=XML10_LETTER+XML10_DIGIT+"\\._"+XML10_COMBINING_CHAR+XML10_EXTENDER+"-",XML_NC_NAME="["+XML10_LETTER+"_]["+XML_NC_NAME_CHAR+"]*",DOM_ELEMENT_NODE=1,DOM_ATTRIBUTE_NODE=2,DOM_TEXT_NODE=3,DOM_CDATA_SECTION_NODE=4,DOM_ENTITY_REFERENCE_NODE=5,DOM_ENTITY_NODE=6,DOM_PROCESSING_INSTRUCTION_NODE=7,DOM_COMMENT_NODE=8,DOM_DOCUMENT_NODE=9,DOM_DOCUMENT_TYPE_NODE=10,DOM_DOCUMENT_FRAGMENT_NODE=11,DOM_NOTATION_NODE=12,xpathParseCache={};ExprContext.prototype.clone=function(t,e,r){return new ExprContext(t||this.node,e!==void 0?e:this.position,r||this.nodelist,this)},ExprContext.prototype.setVariable=function(t,e){this.variables[t]=e},ExprContext.prototype.getVariable=function(t){return this.variables[t]!==void 0?this.variables[t]:this.parent?this.parent.getVariable(t):null},ExprContext.prototype.setNode=function(t){this.node=this.nodelist[t],this.position=t},ExprContext.prototype.contextSize=function(){return this.nodelist.length},StringValue.prototype.stringValue=function(){return this.value},StringValue.prototype.booleanValue=function(){return this.value.length>0},StringValue.prototype.numberValue=function(){return this.value-0},StringValue.prototype.nodeSetValue=function(){throw this},BooleanValue.prototype.stringValue=function(){return""+this.value},BooleanValue.prototype.booleanValue=function(){return this.value},BooleanValue.prototype.numberValue=function(){return this.value?1:0},BooleanValue.prototype.nodeSetValue=function(){throw this},NumberValue.prototype.stringValue=function(){return""+this.value},NumberValue.prototype.booleanValue=function(){return!!this.value},NumberValue.prototype.numberValue=function(){return this.value-0},NumberValue.prototype.nodeSetValue=function(){throw this},NodeSetValue.prototype.stringValue=function(){return 0==this.value.length?"":xmlValue(this.value[0])},NodeSetValue.prototype.booleanValue=function(){return this.value.length>0},NodeSetValue.prototype.numberValue=function(){return this.stringValue()-0},NodeSetValue.prototype.nodeSetValue=function(){return this.value},TokenExpr.prototype.evaluate=function(){return new StringValue(this.value)},LocationExpr.prototype.appendStep=function(t){this.steps.push(t)},LocationExpr.prototype.prependStep=function(t){var e=this.steps;this.steps=[t];for(var r=0;e.length>r;++r)this.steps.push(e[r])},LocationExpr.prototype.evaluate=function(t){var e;e=this.absolute?t.root:t.node;var r=[];return xPathStep(r,this.steps,0,e,t),new NodeSetValue(r)},StepExpr.prototype.appendPredicate=function(t){this.predicate.push(t)},StepExpr.prototype.evaluate=function(t){var e=t.node,r=[];if(this.axis==xpathAxis.ANCESTOR_OR_SELF){r.push(e);for(var a=e.parentNode;a;a=a.parentNode)r.push(a)}else if(this.axis==xpathAxis.ANCESTOR)for(var a=e.parentNode;a;a=a.parentNode)r.push(a);else if(this.axis==xpathAxis.ATTRIBUTE)copyArray(r,e.attributes);else if(this.axis==xpathAxis.CHILD)copyArray(r,e.childNodes);else if(this.axis==xpathAxis.DESCENDANT_OR_SELF)r.push(e),xpathCollectDescendants(r,e);else if(this.axis==xpathAxis.DESCENDANT)xpathCollectDescendants(r,e);else if(this.axis==xpathAxis.FOLLOWING)for(var a=e;a;a=a.parentNode)for(var n=a.nextSibling;n;n=n.nextSibling)r.push(n),xpathCollectDescendants(r,n);else if(this.axis==xpathAxis.FOLLOWING_SIBLING)for(var a=e.nextSibling;a;a=a.nextSibling)r.push(a);else if(this.axis==xpathAxis.NAMESPACE)alert("not implemented: axis namespace");else if(this.axis==xpathAxis.PARENT)e.parentNode&&r.push(e.parentNode);else if(this.axis==xpathAxis.PRECEDING)for(var a=e;a;a=a.parentNode)for(var n=a.previousSibling;n;n=n.previousSibling)r.push(n),xpathCollectDescendantsReverse(r,n);else if(this.axis==xpathAxis.PRECEDING_SIBLING)for(var a=e.previousSibling;a;a=a.previousSibling)r.push(a);else{if(this.axis!=xpathAxis.SELF)throw"ERROR -- NO SUCH AXIS: "+this.axis;r.push(e)}var i=r;r=[];for(var s=0;i.length>s;++s){var a=i[s];this.nodetest.evaluate(t.clone(a,s,i)).booleanValue()&&r.push(a)}for(var s=0;this.predicate.length>s;++s){var i=r;r=[];for(var o=0;i.length>o;++o){var a=i[o];this.predicate[s].evaluate(t.clone(a,o,i)).booleanValue()&&r.push(a)}}return new NodeSetValue(r)},NodeTestAny.prototype.evaluate=function(){return this.value},NodeTestElementOrAttribute.prototype.evaluate=function(t){return new BooleanValue(t.node.nodeType==DOM_ELEMENT_NODE||t.node.nodeType==DOM_ATTRIBUTE_NODE)},NodeTestText.prototype.evaluate=function(t){return new BooleanValue(t.node.nodeType==DOM_TEXT_NODE)},NodeTestComment.prototype.evaluate=function(t){return new BooleanValue(t.node.nodeType==DOM_COMMENT_NODE)},NodeTestPI.prototype.evaluate=function(t){return new BooleanValue(t.node.nodeType==DOM_PROCESSING_INSTRUCTION_NODE&&(!this.target||t.node.nodeName==this.target))},NodeTestNC.prototype.evaluate=function(t){var e=t.node;return new BooleanValue(this.regex.match(e.nodeName))},NodeTestName.prototype.evaluate=function(t){var e=t.node;return new BooleanValue(e.nodeName==this.name)},PredicateExpr.prototype.evaluate=function(t){var e=this.expr.evaluate(t);return"number"==e.type?new BooleanValue(t.position==e.numberValue()-1):new BooleanValue(e.booleanValue())},FunctionCallExpr.prototype.appendArg=function(t){this.args.push(t)},FunctionCallExpr.prototype.evaluate=function(t){var e=""+this.name.value,r=this.xpathfunctions[e];return r?r.call(this,t):(xpathLog("XPath NO SUCH FUNCTION "+e),new BooleanValue(!1))},FunctionCallExpr.prototype.xpathfunctions={last:function(t){return assert(0==this.args.length),new NumberValue(t.contextSize())},position:function(t){return assert(0==this.args.length),new NumberValue(t.position+1)},count:function(t){assert(1==this.args.length);var e=this.args[0].evaluate(t);return new NumberValue(e.nodeSetValue().length)},id:function(t){assert(1==this.args.length);var e,r=this.args[0].evaluate(t),a=[];if("node-set"==r.type){e=[];for(var n=r.nodeSetValue(),i=0;n.length>i;++i)for(var s=xmlValue(n[i]).split(/\s+/),o=0;s.length>o;++o)e.push(s[o])}else e=r.stringValue().split(/\s+/);for(var p=t.node.ownerDocument,i=0;e.length>i;++i){var l=p.getElementById(e[i]);l&&a.push(l)}return new NodeSetValue(a)},"local-name":function(){alert("not implmented yet: XPath function local-name()")},"namespace-uri":function(){alert("not implmented yet: XPath function namespace-uri()")},name:function(t){assert(1==this.args.length||0==this.args.length);var e;return e=0==this.args.length?[t.node]:this.args[0].evaluate(t).nodeSetValue(),0==e.length?new StringValue(""):new StringValue(e[0].nodeName)},string:function(t){return assert(1==this.args.length||0==this.args.length),0==this.args.length?new StringValue(new NodeSetValue([t.node]).stringValue()):new StringValue(this.args[0].evaluate(t).stringValue())},concat:function(t){for(var e="",r=0;this.args.length>r;++r)e+=this.args[r].evaluate(t).stringValue();return new StringValue(e)},"starts-with":function(t){assert(2==this.args.length);var e=this.args[0].evaluate(t).stringValue(),r=this.args[1].evaluate(t).stringValue();return new BooleanValue(0==e.indexOf(r))},contains:function(t){assert(2==this.args.length);var e=this.args[0].evaluate(t).stringValue(),r=this.args[1].evaluate(t).stringValue();return new BooleanValue(-1!=e.indexOf(r))},"substring-before":function(t){assert(2==this.args.length);var e,r=this.args[0].evaluate(t).stringValue(),a=this.args[1].evaluate(t).stringValue(),n=r.indexOf(a);return e=-1==n?"":r.substr(0,n),new StringValue(e)},"substring-after":function(t){assert(2==this.args.length);var e,r=this.args[0].evaluate(t).stringValue(),a=this.args[1].evaluate(t).stringValue(),n=r.indexOf(a);return e=-1==n?"":r.substr(n+a.length),new StringValue(e)},substring:function(t){assert(2==this.args.length||3==this.args.length);var e,r=this.args[0].evaluate(t).stringValue(),a=this.args[1].evaluate(t).numberValue();if(2==this.args.length){var n=Math.max(0,Math.round(a)-1);e=r.substr(n)}else{var i=this.args[2].evaluate(t).numberValue(),s=Math.round(a)-1,n=Math.max(0,s),o=Math.round(i)-Math.max(0,-s);e=r.substr(n,o)}return new StringValue(e)},"string-length":function(t){var e;return e=this.args.length>0?this.args[0].evaluate(t).stringValue():new NodeSetValue([t.node]).stringValue(),new NumberValue(e.length)},"normalize-space":function(t){var e;return e=this.args.length>0?this.args[0].evaluate(t).stringValue():new NodeSetValue([t.node]).stringValue(),e=e.replace(/^\s*/,"").replace(/\s*$/,"").replace(/\s+/g," "),new StringValue(e)},translate:function(t){assert(3==this.args.length);for(var e=this.args[0].evaluate(t).stringValue(),r=this.args[1].evaluate(t).stringValue(),a=this.args[2].evaluate(t).stringValue(),n=0;r.length>n;++n)e=e.replace(RegExp(r.charAt(n),"g"),a.charAt(n));return new StringValue(e)},"boolean":function(t){return assert(1==this.args.length),new BooleanValue(this.args[0].evaluate(t).booleanValue())},not:function(t){assert(1==this.args.length);var e=!this.args[0].evaluate(t).booleanValue();return new BooleanValue(e)},"true":function(){return assert(0==this.args.length),new BooleanValue(!0)},"false":function(){return assert(0==this.args.length),new BooleanValue(!1)},lang:function(t){assert(1==this.args.length);for(var e,r=this.args[0].evaluate(t).stringValue(),a=t.node;a&&a!=a.parentNode&&!(e=a.getAttribute("xml:lang"));)a=a.parentNode;if(e){var n=RegExp("^"+r+"$","i");return new BooleanValue(e.match(n)||e.replace(/_.*$/,"").match(n))}return new BooleanValue(!1)},number:function(t){return assert(1==this.args.length||0==this.args.length),1==this.args.length?new NumberValue(this.args[0].evaluate(t).numberValue()):new NumberValue(new NodeSetValue([t.node]).numberValue())},sum:function(t){assert(1==this.args.length);for(var e=this.args[0].evaluate(t).nodeSetValue(),r=0,a=0;e.length>a;++a)r+=xmlValue(e[a])-0;return new NumberValue(r)},floor:function(t){assert(1==this.args.length);var e=this.args[0].evaluate(t).numberValue();return new NumberValue(Math.floor(e))},ceiling:function(t){assert(1==this.args.length);var e=this.args[0].evaluate(t).numberValue();return new NumberValue(Math.ceil(e))},round:function(t){assert(1==this.args.length);var e=this.args[0].evaluate(t).numberValue();return new NumberValue(Math.round(e))},"ext-join":function(t){assert(2==this.args.length);for(var e=this.args[0].evaluate(t).nodeSetValue(),r=this.args[1].evaluate(t).stringValue(),a="",n=0;e.length>n;++n)a&&(a+=r),a+=xmlValue(e[n]);return new StringValue(a)},"ext-if":function(t){return assert(3==this.args.length),this.args[0].evaluate(t).booleanValue()?this.args[1].evaluate(t):this.args[2].evaluate(t)},"ext-cardinal":function(t){assert(this.args.length>=1);for(var e=this.args[0].evaluate(t).numberValue(),r=[],a=0;e>a;++a)r.push(t.node);return new NodeSetValue(r)}},UnionExpr.prototype.evaluate=function(t){for(var e=this.expr1.evaluate(t).nodeSetValue(),r=this.expr2.evaluate(t).nodeSetValue(),a=e.length,n=0;r.length>n;++n){for(var i=r[n],s=!1,o=0;a>o;++o)e[o]==i&&(s=!0,o=a);s||e.push(i)}return new NodeSetValue(e)},PathExpr.prototype.evaluate=function(t){for(var e=this.filter.evaluate(t).nodeSetValue(),r=[],a=0;e.length>a;++a)for(var n=this.rel.evaluate(t.clone(e[a],a,e)).nodeSetValue(),i=0;n.length>i;++i)r.push(n[i]);return new NodeSetValue(r)},FilterExpr.prototype.evaluate=function(t){for(var e=this.expr.evaluate(t).nodeSetValue(),r=0;this.predicate.length>r;++r){var a=e;e=[];for(var n=0;a.length>n;++n){var i=a[n];this.predicate[r].evaluate(t.clone(i,n,a)).booleanValue()&&e.push(i)}}return new NodeSetValue(e)},UnaryMinusExpr.prototype.evaluate=function(t){return new NumberValue(-this.expr.evaluate(t).numberValue())},BinaryExpr.prototype.evaluate=function(t){var e;switch(this.op.value){case"or":e=new BooleanValue(this.expr1.evaluate(t).booleanValue()||this.expr2.evaluate(t).booleanValue());break;case"and":e=new BooleanValue(this.expr1.evaluate(t).booleanValue()&&this.expr2.evaluate(t).booleanValue());break;case"+":e=new NumberValue(this.expr1.evaluate(t).numberValue()+this.expr2.evaluate(t).numberValue());break;case"-":e=new NumberValue(this.expr1.evaluate(t).numberValue()-this.expr2.evaluate(t).numberValue());break;case"*":e=new NumberValue(this.expr1.evaluate(t).numberValue()*this.expr2.evaluate(t).numberValue());break;case"mod":e=new NumberValue(this.expr1.evaluate(t).numberValue()%this.expr2.evaluate(t).numberValue());break;case"div":e=new NumberValue(this.expr1.evaluate(t).numberValue()/this.expr2.evaluate(t).numberValue());break;case"=":e=this.compare(t,function(t,e){return t==e});break;case"!=":e=this.compare(t,function(t,e){return t!=e});break;case"<":e=this.compare(t,function(t,e){return e>t});break;case"<=":e=this.compare(t,function(t,e){return e>=t});break;case">":e=this.compare(t,function(t,e){return t>e});break;case">=":e=this.compare(t,function(t,e){return t>=e});break;default:alert("BinaryExpr.evaluate: "+this.op.value)}return e},BinaryExpr.prototype.compare=function(t,e){var r,a=this.expr1.evaluate(t),n=this.expr2.evaluate(t);if("node-set"==a.type&&"node-set"==n.type){var i=a.nodeSetValue(),s=n.nodeSetValue();r=!1;for(var o=0;i.length>o;++o)for(var p=0;s.length>p;++p)e(xmlValue(i[o]),xmlValue(s[p]))&&(r=!0,p=s.length,o=i.length)}else if("node-set"==a.type||"node-set"==n.type)if("number"==a.type){var l=a.numberValue(),u=n.nodeSetValue();r=!1;for(var h=0;u.length>h;++h){var c=xmlValue(u[h])-0;if(e(l,c)){r=!0;break}}}else if("number"==n.type){var u=a.nodeSetValue(),l=n.numberValue();r=!1;for(var h=0;u.length>h;++h){var c=xmlValue(u[h])-0;if(e(c,l)){r=!0;break}}}else if("string"==a.type){var l=a.stringValue(),u=n.nodeSetValue();r=!1;for(var h=0;u.length>h;++h){var c=xmlValue(u[h]);if(e(l,c)){r=!0;break}}}else if("string"==n.type){var u=a.nodeSetValue(),l=n.stringValue();r=!1;for(var h=0;u.length>h;++h){var c=xmlValue(u[h]);if(e(c,l)){r=!0;break}}}else r=e(a.booleanValue(),n.booleanValue());else r="boolean"==a.type||"boolean"==n.type?e(a.booleanValue(),n.booleanValue()):"number"==a.type||"number"==n.type?e(a.numberValue(),n.numberValue()):e(a.stringValue(),n.stringValue());return new BooleanValue(r)},LiteralExpr.prototype.evaluate=function(){return new StringValue(this.value)},NumberExpr.prototype.evaluate=function(){return new NumberValue(this.value)},VariableExpr.prototype.evaluate=function(t){return t.getVariable(this.name)};var xpathAxis={ANCESTOR_OR_SELF:"ancestor-or-self",ANCESTOR:"ancestor",ATTRIBUTE:"attribute",CHILD:"child",DESCENDANT_OR_SELF:"descendant-or-self",DESCENDANT:"descendant",FOLLOWING_SIBLING:"following-sibling",FOLLOWING:"following",NAMESPACE:"namespace",PARENT:"parent",PRECEDING_SIBLING:"preceding-sibling",PRECEDING:"preceding",SELF:"self"},xpathAxesRe=[xpathAxis.ANCESTOR_OR_SELF,xpathAxis.ANCESTOR,xpathAxis.ATTRIBUTE,xpathAxis.CHILD,xpathAxis.DESCENDANT_OR_SELF,xpathAxis.DESCENDANT,xpathAxis.FOLLOWING_SIBLING,xpathAxis.FOLLOWING,xpathAxis.NAMESPACE,xpathAxis.PARENT,xpathAxis.PRECEDING_SIBLING,xpathAxis.PRECEDING,xpathAxis.SELF].join("|"),TOK_PIPE={label:"|",prec:17,re:RegExp("^\\|")},TOK_DSLASH={label:"//",prec:19,re:RegExp("^//")},TOK_SLASH={label:"/",prec:30,re:RegExp("^/")},TOK_AXIS={label:"::",prec:20,re:RegExp("^::")},TOK_COLON={label:":",prec:1e3,re:RegExp("^:")},TOK_AXISNAME={label:"[axis]",re:RegExp("^("+xpathAxesRe+")")},TOK_PARENO={label:"(",prec:34,re:RegExp("^\\(")},TOK_PARENC={label:")",re:RegExp("^\\)")},TOK_DDOT={label:"..",prec:34,re:RegExp("^\\.\\.")},TOK_DOT={label:".",prec:34,re:RegExp("^\\.")},TOK_AT={label:"@",prec:34,re:RegExp("^@")},TOK_COMMA={label:",",re:RegExp("^,")},TOK_OR={label:"or",prec:10,re:RegExp("^or\\b")},TOK_AND={label:"and",prec:11,re:RegExp("^and\\b")},TOK_EQ={label:"=",prec:12,re:RegExp("^=")},TOK_NEQ={label:"!=",prec:12,re:RegExp("^!=")},TOK_GE={label:">=",prec:13,re:RegExp("^>=")},TOK_GT={label:">",prec:13,re:RegExp("^>")},TOK_LE={label:"<=",prec:13,re:RegExp("^<=")},TOK_LT={label:"<",prec:13,re:RegExp("^<")},TOK_PLUS={label:"+",prec:14,re:RegExp("^\\+"),left:!0},TOK_MINUS={label:"-",prec:14,re:RegExp("^\\-"),left:!0},TOK_DIV={label:"div",prec:15,re:RegExp("^div\\b"),left:!0},TOK_MOD={label:"mod",prec:15,re:RegExp("^mod\\b"),left:!0},TOK_BRACKO={label:"[",prec:32,re:RegExp("^\\[")},TOK_BRACKC={label:"]",re:RegExp("^\\]")},TOK_DOLLAR={label:"$",re:RegExp("^\\$")},TOK_NCNAME={label:"[ncname]",re:RegExp("^"+XML_NC_NAME)},TOK_ASTERISK={label:"*",prec:15,re:RegExp("^\\*"),left:!0},TOK_LITERALQ={label:"[litq]",prec:20,re:RegExp("^'[^\\']*'")},TOK_LITERALQQ={label:"[litqq]",prec:20,re:RegExp('^"[^\\"]*"')},TOK_NUMBER={label:"[number]",prec:35,re:RegExp("^\\d+(\\.\\d*)?")},TOK_QNAME={label:"[qname]",re:RegExp("^("+XML_NC_NAME+":)?"+XML_NC_NAME)},TOK_NODEO={label:"[nodetest-start]",re:RegExp("^(processing-instruction|comment|text|node)\\(")},xpathTokenRules=[TOK_DSLASH,TOK_SLASH,TOK_DDOT,TOK_DOT,TOK_AXIS,TOK_COLON,TOK_AXISNAME,TOK_NODEO,TOK_PARENO,TOK_PARENC,TOK_BRACKO,TOK_BRACKC,TOK_AT,TOK_COMMA,TOK_OR,TOK_AND,TOK_NEQ,TOK_EQ,TOK_GE,TOK_GT,TOK_LE,TOK_LT,TOK_PLUS,TOK_MINUS,TOK_ASTERISK,TOK_PIPE,TOK_MOD,TOK_DIV,TOK_LITERALQ,TOK_LITERALQQ,TOK_NUMBER,TOK_QNAME,TOK_NCNAME,TOK_DOLLAR],XPathLocationPath={label:"LocationPath"},XPathRelativeLocationPath={label:"RelativeLocationPath"},XPathAbsoluteLocationPath={label:"AbsoluteLocationPath"},XPathStep={label:"Step"},XPathNodeTest={label:"NodeTest"},XPathPredicate={label:"Predicate"},XPathLiteral={label:"Literal"},XPathExpr={label:"Expr"},XPathPrimaryExpr={label:"PrimaryExpr"},XPathVariableReference={label:"Variablereference"},XPathNumber={label:"Number"},XPathFunctionCall={label:"FunctionCall"},XPathArgumentRemainder={label:"ArgumentRemainder"},XPathPathExpr={label:"PathExpr"},XPathUnionExpr={label:"UnionExpr"},XPathFilterExpr={label:"FilterExpr"},XPathDigits={label:"Digits"},xpathNonTerminals=[XPathLocationPath,XPathRelativeLocationPath,XPathAbsoluteLocationPath,XPathStep,XPathNodeTest,XPathPredicate,XPathLiteral,XPathExpr,XPathPrimaryExpr,XPathVariableReference,XPathNumber,XPathFunctionCall,XPathArgumentRemainder,XPathPathExpr,XPathUnionExpr,XPathFilterExpr,XPathDigits],Q_01={label:"?"},Q_MM={label:"*"},Q_1M={label:"+"},ASSOC_LEFT=!0,xpathGrammarRules=[[XPathLocationPath,[XPathRelativeLocationPath],18,passExpr],[XPathLocationPath,[XPathAbsoluteLocationPath],18,passExpr],[XPathAbsoluteLocationPath,[TOK_SLASH,XPathRelativeLocationPath],18,makeLocationExpr1],[XPathAbsoluteLocationPath,[TOK_DSLASH,XPathRelativeLocationPath],18,makeLocationExpr2],[XPathAbsoluteLocationPath,[TOK_SLASH],0,makeLocationExpr3],[XPathAbsoluteLocationPath,[TOK_DSLASH],0,makeLocationExpr4],[XPathRelativeLocationPath,[XPathStep],31,makeLocationExpr5],[XPathRelativeLocationPath,[XPathRelativeLocationPath,TOK_SLASH,XPathStep],31,makeLocationExpr6],[XPathRelativeLocationPath,[XPathRelativeLocationPath,TOK_DSLASH,XPathStep],31,makeLocationExpr7],[XPathStep,[TOK_DOT],33,makeStepExpr1],[XPathStep,[TOK_DDOT],33,makeStepExpr2],[XPathStep,[TOK_AXISNAME,TOK_AXIS,XPathNodeTest],33,makeStepExpr3],[XPathStep,[TOK_AT,XPathNodeTest],33,makeStepExpr4],[XPathStep,[XPathNodeTest],33,makeStepExpr5],[XPathStep,[XPathStep,XPathPredicate],33,makeStepExpr6],[XPathNodeTest,[TOK_ASTERISK],33,makeNodeTestExpr1],[XPathNodeTest,[TOK_NCNAME,TOK_COLON,TOK_ASTERISK],33,makeNodeTestExpr2],[XPathNodeTest,[TOK_QNAME],33,makeNodeTestExpr3],[XPathNodeTest,[TOK_NODEO,TOK_PARENC],33,makeNodeTestExpr4],[XPathNodeTest,[TOK_NODEO,XPathLiteral,TOK_PARENC],33,makeNodeTestExpr5],[XPathPredicate,[TOK_BRACKO,XPathExpr,TOK_BRACKC],33,makePredicateExpr],[XPathPrimaryExpr,[XPathVariableReference],33,passExpr],[XPathPrimaryExpr,[TOK_PARENO,XPathExpr,TOK_PARENC],33,makePrimaryExpr],[XPathPrimaryExpr,[XPathLiteral],30,passExpr],[XPathPrimaryExpr,[XPathNumber],30,passExpr],[XPathPrimaryExpr,[XPathFunctionCall],30,passExpr],[XPathFunctionCall,[TOK_QNAME,TOK_PARENO,TOK_PARENC],-1,makeFunctionCallExpr1],[XPathFunctionCall,[TOK_QNAME,TOK_PARENO,XPathExpr,XPathArgumentRemainder,Q_MM,TOK_PARENC],-1,makeFunctionCallExpr2],[XPathArgumentRemainder,[TOK_COMMA,XPathExpr],-1,makeArgumentExpr],[XPathUnionExpr,[XPathPathExpr],20,passExpr],[XPathUnionExpr,[XPathUnionExpr,TOK_PIPE,XPathPathExpr],20,makeUnionExpr],[XPathPathExpr,[XPathLocationPath],20,passExpr],[XPathPathExpr,[XPathFilterExpr],19,passExpr],[XPathPathExpr,[XPathFilterExpr,TOK_SLASH,XPathRelativeLocationPath],20,makePathExpr1],[XPathPathExpr,[XPathFilterExpr,TOK_DSLASH,XPathRelativeLocationPath],20,makePathExpr2],[XPathFilterExpr,[XPathPrimaryExpr,XPathPredicate,Q_MM],20,makeFilterExpr],[XPathExpr,[XPathPrimaryExpr],16,passExpr],[XPathExpr,[XPathUnionExpr],16,passExpr],[XPathExpr,[TOK_MINUS,XPathExpr],-1,makeUnaryMinusExpr],[XPathExpr,[XPathExpr,TOK_OR,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_AND,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_EQ,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_NEQ,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_LT,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_LE,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_GT,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_GE,XPathExpr],-1,makeBinaryExpr],[XPathExpr,[XPathExpr,TOK_PLUS,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_MINUS,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_ASTERISK,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_DIV,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathExpr,[XPathExpr,TOK_MOD,XPathExpr],-1,makeBinaryExpr,ASSOC_LEFT],[XPathLiteral,[TOK_LITERALQ],-1,makeLiteralExpr],[XPathLiteral,[TOK_LITERALQQ],-1,makeLiteralExpr],[XPathNumber,[TOK_NUMBER],-1,makeNumberExpr],[XPathVariableReference,[TOK_DOLLAR,TOK_QNAME],200,makeVariableReference]],xpathRules=[];